# Prompt 2: Update Solver SDK Types

## Goal
Update the solver SDK type definitions to match the new contract interfaces.

## Changes Required

### 1. Update `solver-sdk/src/types/intent.ts`

**Status Enum Changes:**
```typescript
// OLD
export enum IntentStatus {
  PENDING = 'PENDING',
  PARTIALLY_FILLED = 'PARTIALLY_FILLED',
  FILLED = 'FILLED',
  CANCELLED = 'CANCELLED',
  EXPIRED = 'EXPIRED',
}

// NEW
export enum IntentStatus {
  ACTIVE = 'ACTIVE',           // Changed from PENDING
  FILLED = 'FILLED',
  CANCELLED = 'CANCELLED',
  EXPIRED = 'EXPIRED',
}
// Note: PARTIALLY_FILLED is no longer a separate status - use escrow_remaining > 0 with ACTIVE
```

**Add new types:**
```typescript
// Fill record for tracking partial fills
export interface Fill {
  solver: string;
  inputAmount: bigint;
  outputAmount: bigint;
  filledAt: number;
}

// Bid for sealed-bid auctions
export interface Bid {
  solver: string;
  outputAmount: bigint;
  submittedAt: number;
}

// Auction state
export enum AuctionType {
  NONE = 'NONE',
  SEALED_BID_ACTIVE = 'SEALED_BID_ACTIVE',
  SEALED_BID_COMPLETED = 'SEALED_BID_COMPLETED',
  DUTCH_ACTIVE = 'DUTCH_ACTIVE',
  DUTCH_ACCEPTED = 'DUTCH_ACCEPTED',
  FAILED = 'FAILED',
}

export interface AuctionState {
  type: AuctionType;
  endTime?: number;
  bids?: Bid[];
  winner?: string;
  winningBid?: bigint;
  fillDeadline?: number;
  startPrice?: bigint;
  endPrice?: bigint;
  acceptedPrice?: bigint;
}
```

**Update Intent interfaces:**
```typescript
export interface IntentRecord {
  id: number;
  user: string;
  createdAt: number;
  intent: Intent;
  auction: AuctionState;
  status: IntentStatus;
  escrowRemaining: bigint;
  totalOutputReceived: bigint;
  fills: Fill[];
  chunksExecuted: number;   // For TWAP/DCA
  nextExecution: number;    // For TWAP/DCA
}
```

### 2. Update `solver-sdk/src/types/solution.ts`

Update solution types to match new fill function parameters:
```typescript
export interface FillParams {
  intentId: number;
  fillInput: bigint;      // New: amount to fill (for partial fills)
  outputAmount: bigint;
}

// TWAP/DCA don't need fillInput since chunk size is fixed
export interface ChunkFillParams {
  intentId: number;
  outputAmount: bigint;
}
```

### 3. Update `solver-sdk/src/types/events.ts`

Add new event types:
```typescript
export interface IntentFilledEvent {
  intentId: number;
  user: string;
  solver: string;
  inputAmount: bigint;
  outputAmount: bigint;
  isPartial: boolean;
  fillNumber: number;
  protocolFee: bigint;
  filledAt: number;
}

export interface ChunkExecutedEvent {
  intentId: number;
  chunkNumber: number;
  totalChunks: number;
  solver: string;
  inputAmount: bigint;
  outputAmount: bigint;
  executedAt: number;
}

export interface ProtocolFeeCollectedEvent {
  intentId: number;
  token: string;
  amount: bigint;
  treasury: string;
}
```

## Verification
- [ ] IntentStatus uses ACTIVE instead of PENDING
- [ ] Fill and Bid types added
- [ ] AuctionState properly typed
- [ ] IntentRecord includes all new fields
- [ ] Event types match contract events
