# Prompt 1: Update Dutch Auction Contract with Quadratic Curve

## Goal
Update the Move smart contract to use **quadratic price decay** instead of linear decay for Dutch auctions. The contract MUST validate that solvers accept at the correct price for the current timestamp.

## Current Implementation (Linear)
```move
// lines 351-354 in auction.move
let decay = (price_range * elapsed) / dutch.duration;
let current_price = dutch.start_price - decay;
```

## New Implementation (Quadratic)
The curve formula: `price = start_price - price_range * (elapsed/duration)^2`

This creates a curve that:
- Starts slow (price stays high longer at the beginning)
- Accelerates downward as time progresses
- Matches the reference image shape

## Changes Required

### 1. Update `accept_dutch_auction` function (lines 321-369)
Replace the linear price calculation with quadratic:
```move
// Calculate current price using QUADRATIC decay
// Formula: price = start_price - price_range * (elapsed/duration)^2
// Using integer math: decay = price_range * elapsed * elapsed / (duration * duration)
let elapsed = now - dutch.start_time;
let elapsed_squared = elapsed * elapsed;
let duration_squared = dutch.duration * dutch.duration;
let price_range = dutch.start_price - dutch.end_price;
let decay = (price_range * elapsed_squared) / duration_squared;
let current_price = dutch.start_price - decay;
```

### 2. Update `get_dutch_price` view function (lines 557-575)
Use the same quadratic formula:
```move
let elapsed_squared = elapsed * elapsed;
let duration_squared = dutch.duration * dutch.duration;
let decay = (price_range * elapsed_squared) / duration_squared;
```

### 3. Add helper function for quadratic calculation
Create a reusable function:
```move
/// Calculate Dutch auction price at given elapsed time (quadratic decay)
fun calculate_dutch_price(start_price: u64, end_price: u64, elapsed: u64, duration: u64): u64 {
    if (elapsed >= duration) {
        return end_price
    };

    let price_range = start_price - end_price;
    let elapsed_squared = elapsed * elapsed;
    let duration_squared = duration * duration;
    let decay = (price_range * elapsed_squared) / duration_squared;

    start_price - decay
}
```

## Validation Requirements
- The contract must use the exact timestamp when accepting to calculate price
- No tolerance for price differences - solver must accept at the curve price
- Add assertion to ensure price calculation matches timestamp

## Testing
After changes, run:
```bash
cd contracts && movement move test --filter dutch
```

## File to Modify
- `contracts/sources/auction.move`
