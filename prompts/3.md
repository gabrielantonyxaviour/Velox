# Prompt 3: Update Solver SDK VeloxSolver Class

## Goal
Update the VeloxSolver class to use the new contract function names, parameters, and view functions.

## Changes Required

### 1. Update Function Names

**Settlement Functions (OLD → NEW):**
```typescript
// OLD                              // NEW
settlement::solve_swap          →   settlement::fill_swap
settlement::solve_limit_order   →   settlement::fill_limit_order
settlement::solve_twap_chunk    →   settlement::fill_twap_chunk
settlement::solve_dca_period    →   settlement::fill_dca_period
```

### 2. Update Function Parameters

**fill_swap now requires:**
```typescript
{
  function: `${VELOX_ADDRESS}::settlement::fill_swap`,
  type_arguments: [],
  arguments: [
    registryAddr,     // address
    feeConfigAddr,    // address (NEW - same as registryAddr for now)
    intentId,         // u64
    fillInput,        // u64 (NEW - amount to fill)
    outputAmount      // u64
  ]
}
```

**fill_limit_order now requires:**
```typescript
{
  function: `${VELOX_ADDRESS}::settlement::fill_limit_order`,
  type_arguments: [],
  arguments: [
    registryAddr,
    feeConfigAddr,    // NEW
    intentId,
    fillInput,        // NEW
    outputAmount
  ]
}
```

**fill_twap_chunk now requires:**
```typescript
{
  function: `${VELOX_ADDRESS}::settlement::fill_twap_chunk`,
  type_arguments: [],
  arguments: [
    registryAddr,
    feeConfigAddr,    // NEW
    intentId,
    outputAmount
  ]
}
```

**fill_dca_period now requires:**
```typescript
{
  function: `${VELOX_ADDRESS}::settlement::fill_dca_period`,
  type_arguments: [],
  arguments: [
    registryAddr,
    feeConfigAddr,    // NEW
    intentId,
    outputAmount
  ]
}
```

### 3. Remove Scheduled Module References

The `scheduled` module no longer exists. Remove:
```typescript
// DELETE these calls:
scheduled::is_ready_for_execution
scheduled::get_next_execution
scheduled::get_remaining_chunks
```

**Replace with:**
```typescript
// Use IntentRecord fields directly:
record.nextExecution    // when next chunk/period is ready
record.chunksExecuted   // how many done
// Calculate remaining from intent params
```

### 4. Update View Function Calls

**Intent fetching:**
```typescript
// submission::get_intent returns IntentRecord directly
const record = await this.client.view({
  function: `${VELOX_ADDRESS}::submission::get_intent`,
  arguments: [registryAddr, intentId]
});
// Parse the full IntentRecord structure
```

**New view functions available:**
```typescript
// Get auction state
submission::get_auction_state(registry_addr, intent_id)

// Check if solver can fill (includes auction check)
settlement::can_fill(registry_addr, intent_id, solver)

// Get current Dutch auction price
auction::get_current_dutch_price(registry_addr, intent_id)

// Get bids for sealed-bid auction
auction::get_bids(registry_addr, intent_id)

// Check auction winner
auction::get_winner(registry_addr, intent_id)

// Calculate min output for partial fill
settlement::calculate_min_output_for_fill(registry_addr, intent_id, fill_input)
```

### 5. Update parseIntent Method

The IntentRecord structure from contracts now includes:
- `id`, `user`, `created_at`
- `intent` (the Intent enum: Swap/LimitOrder/TWAP/DCA)
- `auction` (AuctionState enum)
- `status` (IntentStatus enum)
- `escrow_remaining`, `total_output_received`
- `fills` (vector of Fill)
- `chunks_executed`, `next_execution`

### 6. Add feeConfigAddr to SolverConfig

```typescript
interface SolverConfig {
  // ... existing
  feeConfigAddr?: string;  // Defaults to registryAddr
}
```

## File Changes
- `solver-sdk/src/VeloxSolver.ts`: Main class updates
- `solver-sdk/src/config/SolverConfig.ts`: Add feeConfigAddr

## Verification
- [ ] All function names changed from solve_* to fill_*
- [ ] feeConfigAddr added to all fill transactions
- [ ] fillInput parameter added to swap/limit fills
- [ ] scheduled module references removed
- [ ] View function calls updated
- [ ] IntentRecord parsing updated
