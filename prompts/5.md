# Prompt 5: Update Frontend Transaction Functions

## Goal
Update frontend transaction functions to use the new contract function names and parameters.

## Changes Required

### 1. Update `frontend/app/lib/velox/transactions.ts`

**Submission Functions - Remove partialFillAllowed parameter:**

```typescript
// OLD
export async function submitLimitOrder(
  ...,
  partialFillAllowed: boolean  // REMOVE THIS
) { ... }

// NEW
export async function submitLimitOrder(
  client: Aptos,
  registryAddr: string,
  inputToken: string,
  outputToken: string,
  amountIn: bigint,
  limitPrice: bigint,
  expiry: number
) {
  // partialFillAllowed is always true now, not a parameter
}
```

**Swap Submission Functions - Rename for clarity:**

```typescript
// These map to contract functions:
submit_swap                → submitSwap (no auction)
submit_swap_sealed_bid     → submitSwapSealedBid
submit_swap_dutch          → submitSwapDutch
```

**Transaction Payloads:**

```typescript
// Submit swap with sealed-bid auction
export function buildSubmitSwapSealedBid(
  registryAddr: string,
  inputToken: string,
  outputToken: string,
  amountIn: bigint,
  minAmountOut: bigint,
  deadline: number,
  auctionDuration: number
): InputTransactionData {
  return {
    data: {
      function: `${VELOX_ADDRESS}::submission::submit_swap_sealed_bid`,
      typeArguments: [],
      functionArguments: [
        registryAddr,
        inputToken,
        outputToken,
        amountIn.toString(),
        minAmountOut.toString(),
        deadline.toString(),
        auctionDuration.toString()
      ]
    }
  };
}

// Submit swap with Dutch auction
export function buildSubmitSwapDutch(
  registryAddr: string,
  inputToken: string,
  outputToken: string,
  amountIn: bigint,
  minAmountOut: bigint,
  startPrice: bigint,
  auctionDuration: number
): InputTransactionData {
  return {
    data: {
      function: `${VELOX_ADDRESS}::submission::submit_swap_dutch`,
      typeArguments: [],
      functionArguments: [
        registryAddr,
        inputToken,
        outputToken,
        amountIn.toString(),
        minAmountOut.toString(),
        startPrice.toString(),
        auctionDuration.toString()
      ]
    }
  };
}
```

### 2. Update View Function Calls

**Get intent with full record:**
```typescript
export async function getIntent(
  client: Aptos,
  registryAddr: string,
  intentId: number
): Promise<IntentRecord> {
  const result = await client.view({
    payload: {
      function: `${VELOX_ADDRESS}::submission::get_intent`,
      typeArguments: [],
      functionArguments: [registryAddr, intentId.toString()]
    }
  });
  return parseIntentRecord(result[0]);
}
```

**Get auction state:**
```typescript
export async function getAuctionState(
  client: Aptos,
  registryAddr: string,
  intentId: number
): Promise<AuctionState> {
  const result = await client.view({
    payload: {
      function: `${VELOX_ADDRESS}::submission::get_auction_state`,
      typeArguments: [],
      functionArguments: [registryAddr, intentId.toString()]
    }
  });
  return parseAuctionState(result[0]);
}
```

**Get Dutch auction current price:**
```typescript
export async function getDutchAuctionPrice(
  client: Aptos,
  registryAddr: string,
  intentId: number
): Promise<bigint> {
  const result = await client.view({
    payload: {
      function: `${VELOX_ADDRESS}::auction::get_current_dutch_price`,
      typeArguments: [],
      functionArguments: [registryAddr, intentId.toString()]
    }
  });
  return BigInt(result[0]);
}
```

**Get fee configuration:**
```typescript
export async function getFeeBps(
  client: Aptos,
  configAddr: string
): Promise<number> {
  const result = await client.view({
    payload: {
      function: `${VELOX_ADDRESS}::settlement::get_fee_bps`,
      typeArguments: [],
      functionArguments: [configAddr]
    }
  });
  return Number(result[0]);
}

export async function getTotalCollected(
  client: Aptos,
  configAddr: string
): Promise<bigint> {
  const result = await client.view({
    payload: {
      function: `${VELOX_ADDRESS}::settlement::get_total_collected`,
      typeArguments: [],
      functionArguments: [configAddr]
    }
  });
  return BigInt(result[0]);
}
```

### 3. Add Missing View Functions

```typescript
// Get escrow address (for token approvals)
export async function getEscrowAddress(
  client: Aptos,
  registryAddr: string
): Promise<string> {
  const result = await client.view({
    payload: {
      function: `${VELOX_ADDRESS}::submission::get_escrow_addr`,
      typeArguments: [],
      functionArguments: [registryAddr]
    }
  });
  return result[0] as string;
}

// Check if intent can be filled
export async function canFill(
  client: Aptos,
  registryAddr: string,
  intentId: number,
  solver: string
): Promise<boolean> {
  const result = await client.view({
    payload: {
      function: `${VELOX_ADDRESS}::settlement::can_fill`,
      typeArguments: [],
      functionArguments: [registryAddr, intentId.toString(), solver]
    }
  });
  return result[0] as boolean;
}

// Get auction winner
export async function getAuctionWinner(
  client: Aptos,
  registryAddr: string,
  intentId: number
): Promise<{ hasWinner: boolean; winner: string }> {
  const result = await client.view({
    payload: {
      function: `${VELOX_ADDRESS}::auction::get_winner`,
      typeArguments: [],
      functionArguments: [registryAddr, intentId.toString()]
    }
  });
  return {
    hasWinner: result[0] as boolean,
    winner: result[1] as string
  };
}
```

## Verification
- [ ] partialFillAllowed parameter removed from limit orders
- [ ] Swap auction submission functions added
- [ ] View functions return properly parsed types
- [ ] All new view functions added
- [ ] Transaction payloads match contract signatures
