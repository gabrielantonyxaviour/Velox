# Prompt 4: Update Frontend Types

## Goal
Update frontend type definitions to match the new contract interfaces and enable rich data display.

## Changes Required

### 1. Update `frontend/app/lib/velox/types.ts`

**Status enum update:**
```typescript
// OLD
export type IntentStatus = 'pending' | 'partially_filled' | 'filled' | 'cancelled' | 'expired';

// NEW
export type IntentStatus = 'active' | 'filled' | 'cancelled' | 'expired';
// Note: Partial fills are tracked via escrowRemaining > 0 with 'active' status
```

**Add Fill type:**
```typescript
export interface Fill {
  solver: string;
  inputAmount: bigint;
  outputAmount: bigint;
  filledAt: number;
}
```

**Add Bid type:**
```typescript
export interface Bid {
  solver: string;
  outputAmount: bigint;
  submittedAt: number;
}
```

**Update AuctionState:**
```typescript
export type AuctionType =
  | 'none'
  | 'sealed_bid_active'
  | 'sealed_bid_completed'
  | 'dutch_active'
  | 'dutch_accepted'
  | 'failed';

export interface AuctionState {
  type: AuctionType;
  endTime?: number;
  bids?: Bid[];
  winner?: string;
  winningBid?: bigint;
  fillDeadline?: number;
  startPrice?: bigint;
  endPrice?: bigint;
  acceptedPrice?: bigint;
}
```

**Update IntentRecord:**
```typescript
export interface IntentRecord {
  id: number;
  user: string;
  createdAt: number;
  intent: Intent;
  auction: AuctionState;
  status: IntentStatus;
  escrowRemaining: bigint;
  totalOutputReceived: bigint;
  fills: Fill[];
  chunksExecuted: number;
  nextExecution: number;
}
```

**Add helper functions:**
```typescript
// Check if intent is partially filled
export function isPartiallyFilled(record: IntentRecord): boolean {
  const totalAmount = getIntentTotalAmount(record.intent);
  return record.status === 'active' && record.escrowRemaining < totalAmount;
}

// Get fill percentage
export function getFillPercentage(record: IntentRecord): number {
  const totalAmount = getIntentTotalAmount(record.intent);
  const filled = totalAmount - record.escrowRemaining;
  return Number((filled * 100n) / totalAmount);
}

// Get human-readable auction status
export function getAuctionStatusText(auction: AuctionState): string {
  switch (auction.type) {
    case 'sealed_bid_active': return 'Bidding Open';
    case 'sealed_bid_completed': return `Winner: ${shortenAddress(auction.winner!)}`;
    case 'dutch_active': return 'Dutch Auction Active';
    case 'dutch_accepted': return `Accepted by ${shortenAddress(auction.winner!)}`;
    case 'failed': return 'Auction Failed';
    default: return 'No Auction';
  }
}
```

### 2. Update `parseIntentStatus` function

```typescript
// OLD
export function parseIntentStatus(status: number): IntentStatus {
  switch (status) {
    case 0: return 'pending';
    case 1: return 'partially_filled';
    case 2: return 'filled';
    case 3: return 'cancelled';
    case 4: return 'expired';
    default: return 'pending';
  }
}

// NEW
export function parseIntentStatus(statusVariant: { type: string }): IntentStatus {
  // Contract returns enum variants
  const type = statusVariant.type.toLowerCase();
  if (type.includes('active')) return 'active';
  if (type.includes('filled')) return 'filled';
  if (type.includes('cancelled')) return 'cancelled';
  if (type.includes('expired')) return 'expired';
  return 'active';
}
```

### 3. Update parsing helpers for contract data

```typescript
export function parseIntentRecord(data: any): IntentRecord {
  return {
    id: Number(data.id),
    user: data.user,
    createdAt: Number(data.created_at),
    intent: parseIntent(data.intent),
    auction: parseAuctionState(data.auction),
    status: parseIntentStatus(data.status),
    escrowRemaining: BigInt(data.escrow_remaining),
    totalOutputReceived: BigInt(data.total_output_received),
    fills: data.fills.map(parseFill),
    chunksExecuted: Number(data.chunks_executed),
    nextExecution: Number(data.next_execution),
  };
}

export function parseAuctionState(data: any): AuctionState {
  // Handle Move enum variants
  if (data.type?.includes('None') || !data.type) {
    return { type: 'none' };
  }
  // ... handle other variants
}

export function parseFill(data: any): Fill {
  return {
    solver: data.solver,
    inputAmount: BigInt(data.input_amount),
    outputAmount: BigInt(data.output_amount),
    filledAt: Number(data.filled_at),
  };
}
```

## Verification
- [ ] IntentStatus uses 'active' instead of 'pending'
- [ ] Fill type defined with all fields
- [ ] AuctionState properly typed
- [ ] IntentRecord includes all new fields
- [ ] Helper functions added for common operations
- [ ] Parsing functions handle Move enum variants
