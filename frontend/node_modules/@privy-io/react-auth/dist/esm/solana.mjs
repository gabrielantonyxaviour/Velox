import{useCallback as e}from"react";import{b as t,i as s,S as i,j as n,p as r,e as o,f as l}from"./usePrivy-BWtc2XF-.mjs";import{u as c}from"./context-DRLoVlsO.mjs";import{a as d}from"./events-context-CI0iqAXA.mjs";import{u as h}from"./internal-context-e-Eni5bG.mjs";import{u as p}from"./get-is-unified-wallet-gMDXpX6C.mjs";import{pipe as f,createTransactionMessage as g,setTransactionMessageFeePayerSigner as v,setTransactionMessageLifetimeUsingBlockhash as m,appendTransactionMessageInstructions as y,compileTransaction as w,getTransactionEncoder as b,address as j,setTransactionMessageFeePayer as _,blockhash as P,getTransactionDecoder as O}from"@solana/kit";import{f as S,s as T,g as A}from"./useSolanaRpcClient-Brcjny8C.mjs";import{S as W,g as C}from"./useWallets-D4IJeaog.mjs";export{a as useStandardWallets,u as useWallets}from"./useWallets-D4IJeaog.mjs";import{base58 as E,base64 as M}from"@scure/base";import{getAddMemoInstruction as k}from"@solana-program/memo";export{a as useExportWallet,u as useFundWallet}from"./use-export-wallet-B1YnjTpb.mjs";import{S as U,W as x}from"./prepareFundingModalData-BVTcQcmw.mjs";import{getWallets as F}from"@wallet-standard/app";import{UniversalProvider as R}from"@walletconnect/universal-provider";import{isMobile as K}from"react-device-detect";import"react/jsx-runtime";import"@privy-io/js-sdk-core";import"./useWallets-kObl6ZLS.mjs";import"tinycolor2";import"ofetch";import"viem";import"eventemitter3";import"./use-sign-with-user-signer-eEm9Olt_.mjs";const q=e=>{let t,{get:s,on:i}=F(),n=e?.shouldAutoConnect??!0,a=new U(new Me,n),r=new Map,o=[];function l(...e){e.forEach((e=>{!(e.features["privy:"]&&"isPrivyWallet"in e&&e.isPrivyWallet||r.has(e.name))&&e.chains.some((e=>"string"==typeof e&&e.startsWith("solana:")))&&r.set(e.name,e)})),o=Array.from(r.values()).map((e=>new U(e,n))).concat(a),t?.(o)}function c(...e){Array.from(r.values()).forEach((t=>!e.includes(t)&&r.delete(t.name))),o=Array.from(r.values()).map((e=>new U(e,n))).concat(a),t?.(o)}let d=[i("register",l),i("unregister",c)];return l(...s()),{_setOnConnectorsUpdated:e=>{t=e},onMount:()=>{d[0]||(d[0]=i("register",l)),d[1]||(d[1]=i("unregister",c))},onUnmount:()=>{let e=d.pop();for(;e;)e(),e=d.pop()},get:()=>o}};function V(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var I=0;function D(e){return"__private_"+I+++"_"+e}var z=/*#__PURE__*/D("_address"),B=/*#__PURE__*/D("_publicKey"),J=/*#__PURE__*/D("_chains"),N=/*#__PURE__*/D("_features"),L=/*#__PURE__*/D("_label"),Y=/*#__PURE__*/D("_icon");class H{get address(){return V(this,z)[z]}get publicKey(){return V(this,B)[B].slice()}get chains(){return V(this,J)[J].slice()}get features(){return V(this,N)[N].slice()}get label(){return V(this,L)[L]}get icon(){return V(this,Y)[Y]}constructor({address:e,publicKey:t,label:s,icon:i}){Object.defineProperty(this,z,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:void 0}),Object.defineProperty(this,J,{writable:!0,value:void 0}),Object.defineProperty(this,N,{writable:!0,value:void 0}),Object.defineProperty(this,L,{writable:!0,value:void 0}),Object.defineProperty(this,Y,{writable:!0,value:void 0}),V(this,z)[z]=e,V(this,B)[B]=t,V(this,J)[J]=W,V(this,N)[N]=["solana:signAndSendTransaction","solana:signTransaction","solana:signMessage"],V(this,L)[L]=s,V(this,Y)[Y]=i}}function G(e){if("string"==typeof e)return E.decode(e);if(e instanceof Uint8Array)return e;let t=e.signature;return"string"==typeof t?E.decode(t):t}function Z(e){if("string"==typeof e){try{return E.decode(e)}catch{}return M.decode(e)}if(e instanceof Uint8Array)return e;let t=e.transaction??e.signature;if(!t)throw Error("Invalid result from signTransaction or signAndSendTransaction attempt");if("string"==typeof t){try{return E.decode(t)}catch{}return M.decode(t)}return t}function $(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var Q=0;function X(e){return"__private_"+Q+++"_"+e}let ee="solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",te="solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1";var se=/*#__PURE__*/X("_listeners"),ie=/*#__PURE__*/X("_version"),ne=/*#__PURE__*/X("_name"),ae=/*#__PURE__*/X("_icon"),re=/*#__PURE__*/X("_provider"),oe=/*#__PURE__*/X("_accounts"),le=/*#__PURE__*/X("_privyAppName"),ce=/*#__PURE__*/X("_walletConnectCloudProjectId"),de=/*#__PURE__*/X("_walletEntry"),he=/*#__PURE__*/X("_onDisplayUriCallback"),ue=/*#__PURE__*/X("_providerEventListeners"),pe=/*#__PURE__*/X("_on"),fe=/*#__PURE__*/X("_emit"),ge=/*#__PURE__*/X("_off"),ve=/*#__PURE__*/X("_connected"),me=/*#__PURE__*/X("_disconnected"),ye=/*#__PURE__*/X("_connect"),we=/*#__PURE__*/X("_disconnect"),be=/*#__PURE__*/X("_signMessage"),je=/*#__PURE__*/X("_signAndSendTransaction"),_e=/*#__PURE__*/X("_signTransaction"),Pe=/*#__PURE__*/X("_getOrCreateProvider"),Oe=/*#__PURE__*/X("_getOrCreateSession"),Se=/*#__PURE__*/X("_restoreSession"),Te=/*#__PURE__*/X("_addProviderEventListener"),Ae=/*#__PURE__*/X("_destroySession"),We=/*#__PURE__*/X("_makeRpcRequest"),Ce=/*#__PURE__*/X("_onDisplayUri"),Ee=/*#__PURE__*/X("_onSessionDelete");class Me{get version(){return $(this,ie)[ie]}get name(){return $(this,ne)[ne]}get icon(){return $(this,ae)[ae]}get chains(){return W.slice()}get features(){return{"standard:connect":{version:"1.0.0",connect:$(this,ye)[ye]},"standard:disconnect":{version:"1.0.0",disconnect:$(this,we)[we]},"standard:events":{version:"1.0.0",on:$(this,pe)[pe]},"solana:signAndSendTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signAndSendTransaction:$(this,je)[je]},"solana:signTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signTransaction:$(this,_e)[_e]},"solana:signMessage":{version:"1.0.0",signMessage:$(this,be)[be]}}}get accounts(){return $(this,oe)[oe].slice()}get isWalletConnectSolana(){return!0}async initialize({walletConnectCloudProjectId:e,privyAppName:t}){$(this,ce)[ce]=e,$(this,le)[le]=t,await $(this,Pe)[Pe](),await $(this,Se)[Se]()}setWalletEntry(e,t){$(this,de)[de]=e,$(this,he)[he]=t}constructor(){Object.defineProperty(this,fe,{value:ke}),Object.defineProperty(this,ge,{value:Ue}),Object.defineProperty(this,se,{writable:!0,value:void 0}),Object.defineProperty(this,ie,{writable:!0,value:void 0}),Object.defineProperty(this,ne,{writable:!0,value:void 0}),Object.defineProperty(this,ae,{writable:!0,value:void 0}),Object.defineProperty(this,re,{writable:!0,value:void 0}),Object.defineProperty(this,oe,{writable:!0,value:void 0}),Object.defineProperty(this,le,{writable:!0,value:void 0}),Object.defineProperty(this,ce,{writable:!0,value:void 0}),Object.defineProperty(this,de,{writable:!0,value:void 0}),Object.defineProperty(this,he,{writable:!0,value:void 0}),Object.defineProperty(this,ue,{writable:!0,value:void 0}),Object.defineProperty(this,pe,{writable:!0,value:void 0}),Object.defineProperty(this,ve,{writable:!0,value:void 0}),Object.defineProperty(this,me,{writable:!0,value:void 0}),Object.defineProperty(this,ye,{writable:!0,value:void 0}),Object.defineProperty(this,we,{writable:!0,value:void 0}),Object.defineProperty(this,be,{writable:!0,value:void 0}),Object.defineProperty(this,je,{writable:!0,value:void 0}),Object.defineProperty(this,_e,{writable:!0,value:void 0}),Object.defineProperty(this,Pe,{writable:!0,value:void 0}),Object.defineProperty(this,Oe,{writable:!0,value:void 0}),Object.defineProperty(this,Se,{writable:!0,value:void 0}),Object.defineProperty(this,Te,{writable:!0,value:void 0}),Object.defineProperty(this,Ae,{writable:!0,value:void 0}),Object.defineProperty(this,We,{writable:!0,value:void 0}),Object.defineProperty(this,Ce,{writable:!0,value:void 0}),Object.defineProperty(this,Ee,{writable:!0,value:void 0}),$(this,se)[se]={},$(this,ie)[ie]="1.0.0",$(this,ne)[ne]="WalletConnect",$(this,ae)[ae]=x,$(this,re)[re]=null,$(this,oe)[oe]=[],$(this,le)[le]="",$(this,ce)[ce]="",$(this,ue)[ue]=new Map,$(this,pe)[pe]=(e,t)=>($(this,se)[se][e]?.push(t)||($(this,se)[se][e]=[t]),()=>$(this,ge)[ge](e,t)),$(this,ve)[ve]=e=>{$(this,ne)[ne]=$(this,re)[re]?.session?.peer?.metadata?.name||$(this,de)[de]?.name||"WalletConnect",$(this,ae)[ae]=$(this,re)[re]?.session?.peer?.metadata?.icons?.[0]||$(this,de)[de]?.image_url?.sm||$(this,ae)[ae],$(this,oe)[oe]=e.map((e=>new H({address:e,publicKey:E.decode(e),label:$(this,ne)[ne],icon:$(this,ae)[ae]}))),$(this,fe)[fe]("change",{accounts:this.accounts})},$(this,me)[me]=()=>{$(this,oe)[oe]=[],$(this,fe)[fe]("change",{accounts:this.accounts})},$(this,ye)[ye]=async()=>(this.accounts.length||await $(this,Oe)[Oe](),{accounts:this.accounts}),$(this,we)[we]=async()=>{await $(this,Ae)[Ae](),$(this,fe)[fe]("change",{accounts:this.accounts})},$(this,be)[be]=async(...e)=>{let t=[];for(let{account:s,message:i}of e){let e=E.encode(i);try{let n=await $(this,We)[We]("solana_signMessage",{message:e,pubkey:s.address},Fe("solana:mainnet"));t.push({signedMessage:i,signature:G(n)})}catch(n){if(n?.message?.includes("Missing or invalid")){let n=await $(this,We)[We]("solana:signMessage",{message:e,pubkey:s.address},Fe("solana:mainnet"));t.push({signedMessage:i,signature:G(n)})}throw n}}return t},$(this,je)[je]=async(...e)=>{let t=[];for(let{account:s,chain:i,transaction:n,options:a}of e){let e=M.encode(n);try{let n=await $(this,We)[We]("solana_signAndSendTransaction",{transaction:e,pubkey:s.address,sendOptions:a},Fe(i));t.push({signature:G(n)})}catch(n){if(n?.message?.includes("Missing or invalid")){let n=await $(this,We)[We]("solana:signAndSendTransaction",{transaction:e,pubkey:s.address,sendOptions:a},Fe(i));t.push({signature:G(n)})}}}return t},$(this,_e)[_e]=async(...e)=>{let t=[];for(let{account:s,chain:i,transaction:n}of e){let e=M.encode(n);try{let n=await $(this,We)[We]("solana_signTransaction",{transaction:e,pubkey:s.address},Fe(i||"solana:mainnet"));t.push({signedTransaction:Z(n)})}catch(n){if(n?.message?.includes("Missing or invalid")){let n=await $(this,We)[We]("solana:signTransaction",{transaction:e,pubkey:s.address},Fe(i||"solana:mainnet"));t.push({signedTransaction:Z(n)})}}}return t},$(this,Pe)[Pe]=async()=>{if($(this,re)[re])return $(this,re)[re];if(!$(this,ce)[ce])throw Error("WalletConnect Cloud Project ID is required");return $(this,re)[re]=await R.init({projectId:$(this,ce)[ce],metadata:{name:$(this,le)[le],description:$(this,le)[le],url:window.location.origin,icons:[]},relayUrl:"wss://relay.walletconnect.com",telemetryEnabled:!1}),$(this,Te)[Te]("display_uri",$(this,Ce)[Ce]),$(this,Te)[Te]("session_delete",$(this,Ee)[Ee]),$(this,Te)[Te]("session_ping",(()=>{})),$(this,Te)[Te]("session_event",(()=>{})),$(this,Te)[Te]("session_update",(()=>{})),$(this,re)[re]},$(this,Oe)[Oe]=async()=>{if(!$(this,re)[re])throw Error("WalletConnectSolana: Failed to get or create session. Provider not initialized");if($(this,re)[re].session)return $(this,re)[re].session;let e=await $(this,re)[re].connect({optionalNamespaces:{solana:{chains:[ee,te],methods:["solana_signMessage","solana_signTransaction","solana_signAndSendTransaction"],events:[]}}});if(!e)throw Error("WalletConnectSolana: Failed to create new session");return $(this,ve)[ve](xe(e)),e},$(this,Se)[Se]=async()=>{let e=$(this,re)[re]?.session;if(e){if(!e.namespaces?.solana)return await($(this,re)[re]?.disconnect().catch((e=>console.error("WalletConnectSolana: Error disconnecting session",e)))),void($(this,re)[re].session=void 0);$(this,ve)[ve](xe(e))}},$(this,Te)[Te]=(e,t)=>{let s=$(this,ue)[ue].get(e);s&&($(this,re)[re]?.off(e,s),$(this,ue)[ue].delete(e)),$(this,re)[re]?.on(e,t),$(this,ue)[ue].set(e,t)},$(this,Ae)[Ae]=async()=>{try{if($(this,re)[re]?.session&&await($(this,re)[re]?.disconnect().catch((e=>console.error("WalletConnectSolana: Error disconnecting session",e)))),$(this,re)[re]?.client){let e=$(this,re)[re].client.proposal.getAll();await Promise.allSettled(e.map((e=>$(this,re)[re]?.client.proposal.delete(e.id,{code:6e3,message:"User disconnected"}))));let t=$(this,re)[re].client.pairing.getAll();await Promise.allSettled(t.map((e=>$(this,re)[re]?.client.pairing.delete(e.topic,{code:6e3,message:"User disconnected"}))))}$(this,me)[me]()}catch(e){console.error("WalletConnectSolana: Error destroying session",e)}},$(this,We)[We]=async(e,t,s)=>{try{return await $(this,re)[re].request({method:e,params:t},s)}catch(t){if(console.error(`WalletConnectSolana: RPC Error - ${e}:`,t),t?.message?.includes("without any listeners")&&t.result)return t.result;if(t?.message?.includes("session topic does not exist in keychain"))throw Error("WalletConnectSolana: Wallet connection lost. Please reconnect.");throw t}},$(this,Ce)[Ce]=e=>{if(K&&$(this,de)[de]){let{redirect:s}=t(e,$(this,de)[de]);null==$(this,he)[he]||$(this,he)[he].call(this,{native:s,universal:s})}else null==$(this,he)[he]||$(this,he)[he].call(this,{native:e,universal:void 0})},$(this,Ee)[Ee]=()=>{$(this,me)[me]()}}}function ke(e,...t){$(this,se)[se][e]?.forEach((e=>e.apply(null,t)))}function Ue(e,t){$(this,se)[se][e]=$(this,se)[se][e]?.filter((e=>t!==e))}function xe(e){return e.namespaces.solana.accounts.reduce(((e,t)=>{let s=t.split(":").at(-1);return e.includes(s)||e.push(s),e}),[])}function Fe(e){switch(e){case"solana:mainnet":return ee;case"solana:devnet":return te;default:return e}}const Re=()=>{let{user:t}=p(),{client:i,refreshSessionAndUser:n,initializeWalletProxy:a}=h(),r=d(),o=c();return{importWallet:e((({privateKey:e,additionalSigners:l})=>s({getAccessToken:()=>i.getAccessToken(),user:t,initializeWalletProxy:a,refreshSessionAndUser:n,emitPrivyEvent:r,appConfig:o},{privateKey:e,chainType:"solana",additionalSigners:l})),[t,i,n,a,r,o])}};var Ke={id:i,getSolanaRpcClient:A,createTransactionFromRelayQuote:async function({solanaClient:e,quote:t,source:s}){let i=t.steps[0]?.items?.[0];if(!i)throw Error("Invalid quote");let n=i.data.instructions.map((({keys:e,programId:t,data:s})=>({accounts:e.map((({pubkey:e,isSigner:t,isWritable:s})=>({address:e,role:t&&s?3:t&&!s?2:!t&&s?1:0}))),programAddress:t,data:new Uint8Array(Buffer.from(s,"hex"))}))),{value:a}=await e.rpc.getLatestBlockhash().send(),r=f(g({version:0}),(e=>v({address:s},e)),(e=>m(a,e)),(e=>y(n,e)),(e=>w(e)));return new Uint8Array(b().encode(r))},simulateTransaction:T,getAddressFromBuffer:C,fetchTransactionEstimatedFees:S},qe=()=>n(Ke);var Ve={id:o,createSiwsMemoTransaction:({address:e,nonce:t})=>{let s=k({memo:r({address:j(e),nonce:t})});return f(g({version:"legacy"}),(t=>_(j(e),t)),(e=>m({blockhash:P("GfVcyD5fWFJ6hRm8bsy7CoVPsLSoJhtJKRJYk8T2VVFN"),lastValidBlockHeight:0n},e)),(e=>y([s],e)),(e=>w(e)),(e=>M.encode(Uint8Array.from(b().encode(e)))))},getSignatureFromTransaction:(e,t)=>{let s=O().decode(e).signatures[t];if(!s)throw Error(`Missing transaction signature for address: ${t}`);return M.encode(s)}},Ie=()=>n(Ve);function De(){let{create:e}=l();return{createWallet:async t=>{t&&"target"in t&&t&&(t=void 0);let{account:s}=await e({chainType:"solana",options:t});return{wallet:s}}}}function ze(){return{signMessage:async function(...e){let t=[];for(let s of e)t.push(await s.wallet.signMessage({...s,options:s.options}));return 1===e.length?t[0]:[...t]}}}function Be(){return{signTransaction:async function(...e){let t=[];for(let s of e)t.push(await s.wallet.signTransaction({...s,chain:s.chain||"solana:mainnet"}));return 1===e.length?t[0]:[...t]}}}function Je(){return{signAndSendTransaction:async function(...e){let t=[];for(let s of e)t.push(await s.wallet.signAndSendTransaction({...s,chain:s.chain||"solana:mainnet"}));return 1===e.length?t[0]:[...t]}}}export{U as SolanaAdapterConnector,q as toSolanaWalletConnectors,De as useCreateWallet,Re as useImportWallet,Je as useSignAndSendTransaction,ze as useSignMessage,Be as useSignTransaction,qe as useSolanaFundingPlugin,Ie as useSolanaLedgerPlugin};
