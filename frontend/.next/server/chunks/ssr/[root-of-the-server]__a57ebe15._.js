module.exports=[130146,(a,b,c)=>{b.exports=a.x("pino-28069d5257187539",()=>require("pino-28069d5257187539"))},39647,31620,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l;var m,n,o,p,q,r,s=a.i(427699),t=a.i(241958),u=a.i(996840),v=a.i(130146),w=a.i(920275);let x="custom_context";class y{constructor(a){this.nodeValue=a,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class z{constructor(a){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=a,this.sizeInBytes=0}append(a){let b=new y(a);if(b.size>this.maxSizeInBytes)throw Error(`[LinkedList] Value too big to insert into list: ${a} with size ${b.size}`);for(;this.size+b.size>this.maxSizeInBytes;)this.shift();this.head?this.tail&&(this.tail.next=b):this.head=b,this.tail=b,this.lengthInNodes++,this.sizeInBytes+=b.size}shift(){if(!this.head)return;let a=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=a.size}toArray(){let a=[],b=this.head;for(;null!==b;)a.push(b.value),b=b.next;return a}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let a=this.head;return{next:()=>{if(!a)return{done:!0,value:null};let b=a.value;return a=a.next,{done:!1,value:b}}}}}class A{constructor(a,b=1024e3){this.level=a??"error",this.levelValue=v.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=b,this.logs=new z(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(a,b){b===v.levels.values.error?console.error(a):b===v.levels.values.warn?console.warn(a):b===v.levels.values.debug?console.debug(a):b===v.levels.values.trace?console.trace(a):console.log(a)}appendToLogs(a){this.logs.append((0,w.safeJsonStringify)({timestamp:new Date().toISOString(),log:a}));let b="string"==typeof a?JSON.parse(a).level:a.level;b>=this.levelValue&&this.forwardToConsole(a,b)}getLogs(){return this.logs}clearLogs(){this.logs=new z(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(a){let b=this.getLogArray();return b.push((0,w.safeJsonStringify)({extraMetadata:a})),new Blob(b,{type:"application/json"})}}class B{constructor(a,b=1024e3){this.baseChunkLogger=new A(a,b)}write(a){this.baseChunkLogger.appendToLogs(a)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(a){return this.baseChunkLogger.logsToBlob(a)}}var C=Object.defineProperty,D=Object.defineProperties,E=Object.getOwnPropertyDescriptors,F=Object.getOwnPropertySymbols,G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,I=(a,b,c)=>b in a?C(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,J=(a,b)=>{for(var c in b||(b={}))G.call(b,c)&&I(a,c,b[c]);if(F)for(var c of F(b))H.call(b,c)&&I(a,c,b[c]);return a};function K(a){return D(J({},a),E({level:a?.level||"info"}))}function L(a,b=x){return typeof a.bindings>"u"?function(a,b=x){return a[b]||""}(a,b):a.bindings().context||""}function M(a,b,c=x){let d=function(a,b,c=x){let d=L(a,c);return d.trim()?`${d}/${b}`:b}(a,b,c);return function(a,b,c=x){return a[c]=b,a}(a.child({context:d}),d,c)}function N(a){var b;let c;return"u">typeof a.loggerOverride&&"string"!=typeof a.loggerOverride?{logger:a.loggerOverride,chunkLoggerController:null}:(c=new B(null==(b=a.opts)?void 0:b.level,a.maxSizeInBytes),{logger:(0,v.default)(D(J({},a.opts),E({level:"trace"})),c),chunkLoggerController:c})}a.s(["generateChildLogger",()=>M,"generatePlatformLogger",()=>N,"getDefaultLoggerOptions",()=>K,"getLoggerContext",()=>L],31620);var O=v;a.i(157938);var P=a.i(693172),Q=Object.defineProperty,R=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?Q(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class S extends P.IEvents{constructor(a){super(),this.opts=a,R(this,"protocol","wc"),R(this,"version",2)}}var T=Object.defineProperty;class U extends P.IEvents{constructor(a,b){super(),this.core=a,this.logger=b,((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?T(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"records",new Map)}}class V{constructor(a,b){this.logger=a,this.core=b}}class W extends P.IEvents{constructor(a,b){super(),this.relayer=a,this.logger=b}}class X extends P.IEvents{constructor(a){super()}}class Y{constructor(a,b,c,d){this.core=a,this.logger=b,this.name=c}}class Z extends P.IEvents{constructor(a,b){super(),this.relayer=a,this.logger=b}}class $ extends P.IEvents{constructor(a,b){super(),this.core=a,this.logger=b}}class _{constructor(a,b,c){this.core=a,this.logger=b,this.store=c}}class aa{constructor(a,b){this.projectId=a,this.logger=b}}class ab{constructor(a,b,c){this.core=a,this.logger=b,this.telemetryEnabled=c}}s.default,s.EventEmitter;var ac=a.i(673620),ad=a.i(832819),ae=a.i(15388),af=a.i(679628),ag=a.i(741721),ah=a.i(993953),ai=a.i(130934),aj=a.i(165782),ak=a.i(934008),al=a.i(501060);a.i(78125);var am=a.i(282800),an=a.i(864671),ao=a.i(60611),ap=a.i(73915),aq=a.i(572696);Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;let ar="react-native",as="node",at="browser";function au(){return"u">typeof process&&"u">typeof process.versions&&"u">typeof process.versions.node}function av(){return!(0,af.getDocument)()&&!!(0,af.getNavigator)()&&"ReactNative"===navigator.product}function aw(){return!au()&&!!(0,af.getNavigator)()&&!!(0,af.getDocument)()}function ax(){return av()?ar:au()?as:aw()?at:"unknown"}function ay(){var b;try{return av()&&"u">typeof(null==a.g?void 0:a.g.Application)?null==(b=a.g.Application)?void 0:b.applicationId:void 0}catch{return}}function az(b,c,d){var e;let f,g=function(){if(ax()===ar&&"u">typeof(null==a.g?void 0:a.g.Platform)){let{OS:b,Version:c}=a.g.Platform;return[b,c].join("-")}let b=(0,ae.detect)();if(null===b)return"unknown";let c=b.os?b.os.replace(" ","").toLowerCase():"unknown";return"browser"===b.type?[c,b.name,b.version].join("-"):[c,b.version].join("-")}(),h=(f=ax())===at?[f,(null==(e=(0,af.getLocation)())?void 0:e.host)||"unknown"].join(":"):f;return[[b,c].join("-"),["js",d].join("-"),g,h].join("/")}function aA(a){return Object.fromEntries(a.entries())}function aB(a){return new Map(Object.entries(a))}function aC(a,b,c){return new Promise(async(d,e)=>{let f=setTimeout(()=>e(Error(c)),b);try{let b=await a;d(b)}catch(a){e(a)}clearTimeout(f)})}function aD(a,b){if("string"==typeof b&&b.startsWith(`${a}:`))return b;if("topic"===a.toLowerCase()){if("string"!=typeof b)throw Error('Value must be "string" for expirer target type: topic');return`topic:${b}`}if("id"===a.toLowerCase()){if("number"!=typeof b)throw Error('Value must be "number" for expirer target type: id');return`id:${b}`}throw Error(`Unknown expirer target type: ${a}`)}function aE(a,b){return(0,ac.fromMiliseconds)((b||Date.now())+(0,ac.toMiliseconds)(a))}function aF(a){return Date.now()>=(0,ac.toMiliseconds)(a)}function aG(a,b){return`${a}${b?`:${b}`:""}`}function aH(){return"u">typeof crypto&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}function aI(){return"u">typeof process&&"true"===process.env.IS_VITEST}function aJ(a){return Buffer.from(a,"base64").toString("utf-8")}let aK=BigInt(0x100000000-1),aL=BigInt(32);function aM(a,b=!1){return b?{h:Number(a&aK),l:Number(a>>aL&aK)}:{h:0|Number(a>>aL&aK),l:0|Number(a&aK)}}function aN(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=aM(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}let aO=(a,b,c)=>a>>>c,aP=(a,b,c)=>a<<32-c|b>>>c,aQ=(a,b,c)=>a>>>c|b<<32-c,aR=(a,b,c)=>a<<32-c|b>>>c,aS=(a,b,c)=>a<<64-c|b>>>c-32,aT=(a,b,c)=>a>>>c-32|b<<64-c;function aU(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}}let aV=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),aW=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,aX=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),aY=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,aZ=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),a$=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,a_="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function a0(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function a1(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function a2(a,...b){if(!a0(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function a3(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");a1(a.outputLen),a1(a.blockLen)}function a4(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function a5(a,b){a2(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}function a6(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function a7(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function a8(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function a9(a,b){return a<<32-b|a>>>b}let ba=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function bb(a){return a<<24&0xff000000|a<<8&0xff0000|a>>>8&65280|a>>>24&255}let bc=ba?a=>a:a=>bb(a),bd=ba?a=>a:function(a){for(let b=0;b<a.length;b++)a[b]=bb(a[b]);return a},be="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,bf=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function bg(a){if(a2(a),be)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=bf[a[c]];return b}function bh(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function bi(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(be)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=bh(a.charCodeAt(e)),f=bh(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function bj(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}function bk(a){return"string"==typeof a&&(a=bj(a)),a2(a),a}function bl(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];a2(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}class bm{}function bn(a){let b=b=>a().update(bk(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function bo(a=32){if(a_&&"function"==typeof a_.getRandomValues)return a_.getRandomValues(new Uint8Array(a));if(a_&&"function"==typeof a_.randomBytes)return Uint8Array.from(a_.randomBytes(a));throw Error("crypto.getRandomValues must be defined")}let bp=BigInt(0),bq=BigInt(1),br=BigInt(2),bs=BigInt(7),bt=BigInt(256),bu=BigInt(113),bv=[],bw=[],bx=[];for(let a=0,b=bq,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],bv.push(2*(5*d+c)),bw.push((a+1)*(a+2)/2%64);let e=bp;for(let a=0;a<7;a++)(b=(b<<bq^(b>>bs)*bu)%bt)&br&&(e^=bq<<(bq<<BigInt(a))-bq);bx.push(e)}let by=aN(bx,!0),bz=by[0],bA=by[1],bB=(a,b,c)=>c>32?b<<c-32|a>>>64-c:a<<c|b>>>32-c,bC=(a,b,c)=>c>32?a<<c-32|b>>>64-c:b<<c|a>>>32-c;class bD extends bm{constructor(a,b,c,d=!1,e=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,a1(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=a6(this.state)}clone(){return this._cloneInto()}keccak(){bd(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=bB(f,g,1)^c[d],i=bC(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=bw[c],f=bB(b,e,d),g=bC(b,e,d),h=bv[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=bz[d],a[1]^=bA[d]}a7(c)}(this.state32,this.rounds),bd(this.state32),this.posOut=0,this.pos=0}update(a){a4(this),a2(a=bk(a));let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){a4(this,!1),a2(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return a1(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(a5(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,a7(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new bD(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}bn(()=>new bD(136,1,32));class bE extends bm{constructor(a,b,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=a8(this.buffer)}update(a){a4(this),a2(a=bk(a));let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=a8(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){a4(this),a5(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,a7(this.buffer.subarray(f)),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=a8(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let bF=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),bG=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),bH=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),bI=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),bJ=new Uint32Array(64);class bK extends bE{constructor(a=32){super(64,a,8,!1),this.A=0|bF[0],this.B=0|bF[1],this.C=0|bF[2],this.D=0|bF[3],this.E=0|bF[4],this.F=0|bF[5],this.G=0|bF[6],this.H=0|bF[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)bJ[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=bJ[a-15],c=bJ[a-2],d=a9(b,7)^a9(b,18)^b>>>3,e=a9(c,17)^a9(c,19)^c>>>10;bJ[a]=e+bJ[a-7]+d+bJ[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(a9(g,6)^a9(g,11)^a9(g,25))+((k=g)&h^~k&i)+bI[a]+bJ[a]|0,o=(a9(c,2)^a9(c,13)^a9(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){a7(bJ)}destroy(){this.set(0,0,0,0,0,0,0,0),a7(this.buffer)}}let bL=aN(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),bM=bL[0],bN=bL[1],bO=new Uint32Array(80),bP=new Uint32Array(80);class bQ extends bE{constructor(a=64){super(128,a,16,!1),this.Ah=0|bH[0],this.Al=0|bH[1],this.Bh=0|bH[2],this.Bl=0|bH[3],this.Ch=0|bH[4],this.Cl=0|bH[5],this.Dh=0|bH[6],this.Dl=0|bH[7],this.Eh=0|bH[8],this.El=0|bH[9],this.Fh=0|bH[10],this.Fl=0|bH[11],this.Gh=0|bH[12],this.Gl=0|bH[13],this.Hh=0|bH[14],this.Hl=0|bH[15]}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:n,Hh:o,Hl:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|n,this.Hh=0|o,this.Hl=0|p}process(a,b){for(let c=0;c<16;c++,b+=4)bO[c]=a.getUint32(b),bP[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|bO[a-15],c=0|bP[a-15],d=aQ(b,c,1)^aQ(b,c,8)^aO(b,c,7),e=aR(b,c,1)^aR(b,c,8)^aP(b,c,7),f=0|bO[a-2],g=0|bP[a-2],h=aQ(f,g,19)^aS(f,g,61)^aO(f,g,6),i=aX(e,aR(f,g,19)^aT(f,g,61)^aP(f,g,6),bP[a-7],bP[a-16]),j=aY(i,d,h,bO[a-7],bO[a-16]);bO[a]=0|j,bP[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:n,Gh:o,Gl:p,Hh:q,Hl:r}=this;for(let a=0;a<80;a++){let b=aQ(k,l,14)^aQ(k,l,18)^aS(k,l,41),s=aR(k,l,14)^aR(k,l,18)^aT(k,l,41),t=k&m^~k&o,u=aZ(r,s,l&n^~l&p,bN[a],bP[a]),v=a$(u,q,b,t,bM[a],bO[a]),w=0|u,x=aQ(c,d,28)^aS(c,d,34)^aS(c,d,39),y=aR(c,d,28)^aT(c,d,34)^aT(c,d,39),z=c&e^c&g^e&g,A=d&f^d&h^f&h;q=0|o,r=0|p,o=0|m,p=0|n,m=0|k,n=0|l,({h:k,l:l}=aU(0|i,0|j,0|v,0|w)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let B=aV(w,y,A);c=aW(B,v,x,z),d=0|B}({h:c,l:d}=aU(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=aU(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=aU(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=aU(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=aU(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:n}=aU(0|this.Fh,0|this.Fl,0|m,0|n)),({h:o,l:p}=aU(0|this.Gh,0|this.Gl,0|o,0|p)),({h:q,l:r}=aU(0|this.Hh,0|this.Hl,0|q,0|r)),this.set(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r)}roundClean(){a7(bO,bP)}destroy(){a7(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class bR extends bQ{constructor(){super(48),this.Ah=0|bG[0],this.Al=0|bG[1],this.Bh=0|bG[2],this.Bl=0|bG[3],this.Ch=0|bG[4],this.Cl=0|bG[5],this.Dh=0|bG[6],this.Dl=0|bG[7],this.Eh=0|bG[8],this.El=0|bG[9],this.Fh=0|bG[10],this.Fl=0|bG[11],this.Gh=0|bG[12],this.Gl=0|bG[13],this.Hh=0|bG[14],this.Hl=0|bG[15]}}let bS=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class bT extends bQ{constructor(){super(32),this.Ah=0|bS[0],this.Al=0|bS[1],this.Bh=0|bS[2],this.Bl=0|bS[3],this.Ch=0|bS[4],this.Cl=0|bS[5],this.Dh=0|bS[6],this.Dl=0|bS[7],this.Eh=0|bS[8],this.El=0|bS[9],this.Fh=0|bS[10],this.Fl=0|bS[11],this.Gh=0|bS[12],this.Gl=0|bS[13],this.Hh=0|bS[14],this.Hl=0|bS[15]}}let bU=bn(()=>new bK),bV=bn(()=>new bQ),bW=bn(()=>new bR),bX=(bn(()=>new bT),Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9])),bY=Uint32Array.from([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),bZ=new Uint32Array(32);function b$(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=bZ[2*a],j=bZ[2*a+1],k=bZ[2*b],l=bZ[2*b+1],m=bZ[2*c],n=bZ[2*c+1],o=bZ[2*d],p=bZ[2*d+1],q=aV(i,k,g);j=aW(q,j,l,h),i=0|q,({Dh:p,Dl:o}={Dh:p^j,Dl:o^i}),({Dh:p,Dl:o}={Dh:o,Dl:p}),({h:n,l:m}=aU(n,m,p,o)),({Bh:l,Bl:k}={Bh:l^n,Bl:k^m}),({Bh:l,Bl:k}={Bh:aQ(l,k,24),Bl:aR(l,k,24)}),bZ[2*a]=i,bZ[2*a+1]=j,bZ[2*b]=k,bZ[2*b+1]=l,bZ[2*c]=m,bZ[2*c+1]=n,bZ[2*d]=o,bZ[2*d+1]=p}function b_(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=bZ[2*a],j=bZ[2*a+1],k=bZ[2*b],l=bZ[2*b+1],m=bZ[2*c],n=bZ[2*c+1],o=bZ[2*d],p=bZ[2*d+1],q=aV(i,k,g);j=aW(q,j,l,h),i=0|q,({Dh:p,Dl:o}={Dh:p^j,Dl:o^i}),({Dh:p,Dl:o}={Dh:aQ(p,o,16),Dl:aR(p,o,16)}),({h:n,l:m}=aU(n,m,p,o)),({Bh:l,Bl:k}={Bh:l^n,Bl:k^m}),({Bh:l,Bl:k}={Bh:aS(l,k,63),Bl:aT(l,k,63)}),bZ[2*a]=i,bZ[2*a+1]=j,bZ[2*b]=k,bZ[2*b+1]=l,bZ[2*c]=m,bZ[2*c+1]=n,bZ[2*d]=o,bZ[2*d+1]=p}class b0 extends bm{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,a1(a),a1(b),this.blockLen=a,this.outputLen=b,this.buffer=new Uint8Array(a),this.buffer32=a6(this.buffer)}update(a){a4(this),a2(a=bk(a));let{blockLen:b,buffer:c,buffer32:d}=this,e=a.length,f=a.byteOffset,g=a.buffer;for(let h=0;h<e;){this.pos===b&&(bd(d),this.compress(d,0,!1),bd(d),this.pos=0);let i=Math.min(b-this.pos,e-h),j=f+h;if(i===b&&!(j%4)&&h+i<e){let a=new Uint32Array(g,j,Math.floor((e-h)/4));bd(a);for(let c=0;h+b<e;c+=d.length,h+=b)this.length+=b,this.compress(a,c,!1);bd(a);continue}c.set(a.subarray(h,h+i),this.pos),this.pos+=i,this.length+=i,h+=i}return this}digestInto(a){a4(this),a5(a,this);let{pos:b,buffer32:c}=this;this.finished=!0,a7(this.buffer.subarray(b)),bd(c),this.compress(c,0,!0),bd(c);let d=a6(a);this.get().forEach((a,b)=>d[b]=bc(a))}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){let{buffer:b,length:c,finished:d,destroyed:e,outputLen:f,pos:g}=this;return a||(a=new this.constructor({dkLen:f})),a.set(...this.get()),a.buffer.set(b),a.destroyed=e,a.finished=d,a.length=c,a.pos=g,a.outputLen=f,a}clone(){return this._cloneInto()}}class b1 extends b0{constructor(a={}){const b=void 0===a.dkLen?64:a.dkLen;super(128,b),this.v0l=0|bY[0],this.v0h=0|bY[1],this.v1l=0|bY[2],this.v1h=0|bY[3],this.v2l=0|bY[4],this.v2h=0|bY[5],this.v3l=0|bY[6],this.v3h=0|bY[7],this.v4l=0|bY[8],this.v4h=0|bY[9],this.v5l=0|bY[10],this.v5h=0|bY[11],this.v6l=0|bY[12],this.v6h=0|bY[13],this.v7l=0|bY[14],this.v7h=0|bY[15],function(a,b={},c,d,e){if(a1(64),a<0||a>64)throw Error("outputLen bigger than keyLen");let{key:f,salt:g,personalization:h}=b;if(void 0!==f&&(f.length<1||f.length>64))throw Error("key length must be undefined or 1..64");if(void 0!==g&&16!==g.length)throw Error("salt must be undefined or 16");if(void 0!==h&&16!==h.length)throw Error("personalization must be undefined or 16")}(b,a,0,0,0);let{key:c,personalization:d,salt:e}=a,f=0;if(void 0!==c&&(f=(c=bk(c)).length),this.v0l^=this.outputLen|f<<8|0x1010000,void 0!==e){const a=a6(e=bk(e));this.v4l^=bc(a[0]),this.v4h^=bc(a[1]),this.v5l^=bc(a[2]),this.v5h^=bc(a[3])}if(void 0!==d){const a=a6(d=bk(d));this.v6l^=bc(a[0]),this.v6h^=bc(a[1]),this.v7l^=bc(a[2]),this.v7h^=bc(a[3])}if(void 0!==c){const a=new Uint8Array(this.blockLen);a.set(c),this.update(a)}}get(){let{v0l:a,v0h:b,v1l:c,v1h:d,v2l:e,v2h:f,v3l:g,v3h:h,v4l:i,v4h:j,v5l:k,v5h:l,v6l:m,v6h:n,v7l:o,v7h:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.v0l=0|a,this.v0h=0|b,this.v1l=0|c,this.v1h=0|d,this.v2l=0|e,this.v2h=0|f,this.v3l=0|g,this.v3h=0|h,this.v4l=0|i,this.v4h=0|j,this.v5l=0|k,this.v5h=0|l,this.v6l=0|m,this.v6h=0|n,this.v7l=0|o,this.v7h=0|p}compress(a,b,c){this.get().forEach((a,b)=>bZ[b]=a),bZ.set(bY,16);let{h:d,l:e}=aM(BigInt(this.length));bZ[24]=bY[8]^e,bZ[25]=bY[9]^d,c&&(bZ[28]=~bZ[28],bZ[29]=~bZ[29]);let f=0;for(let c=0;c<12;c++)b$(0,4,8,12,a,b+2*bX[f++]),b_(0,4,8,12,a,b+2*bX[f++]),b$(1,5,9,13,a,b+2*bX[f++]),b_(1,5,9,13,a,b+2*bX[f++]),b$(2,6,10,14,a,b+2*bX[f++]),b_(2,6,10,14,a,b+2*bX[f++]),b$(3,7,11,15,a,b+2*bX[f++]),b_(3,7,11,15,a,b+2*bX[f++]),b$(0,5,10,15,a,b+2*bX[f++]),b_(0,5,10,15,a,b+2*bX[f++]),b$(1,6,11,12,a,b+2*bX[f++]),b_(1,6,11,12,a,b+2*bX[f++]),b$(2,7,8,13,a,b+2*bX[f++]),b_(2,7,8,13,a,b+2*bX[f++]),b$(3,4,9,14,a,b+2*bX[f++]),b_(3,4,9,14,a,b+2*bX[f++]);this.v0l^=bZ[0]^bZ[16],this.v0h^=bZ[1]^bZ[17],this.v1l^=bZ[2]^bZ[18],this.v1h^=bZ[3]^bZ[19],this.v2l^=bZ[4]^bZ[20],this.v2h^=bZ[5]^bZ[21],this.v3l^=bZ[6]^bZ[22],this.v3h^=bZ[7]^bZ[23],this.v4l^=bZ[8]^bZ[24],this.v4h^=bZ[9]^bZ[25],this.v5l^=bZ[10]^bZ[26],this.v5h^=bZ[11]^bZ[27],this.v6l^=bZ[12]^bZ[28],this.v6h^=bZ[13]^bZ[29],this.v7l^=bZ[14]^bZ[30],this.v7h^=bZ[15]^bZ[31],a7(bZ)}destroy(){this.destroyed=!0,a7(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}function b2(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function b3(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function b4(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function b5(a,...b){if(!b2(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function b6(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function b7(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function b8(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}o=a=>new b1(a),(c=(a,b)=>o(b).update(bk(a)).digest()).outputLen=(d=o({})).outputLen,c.blockLen=d.blockLen,c.create=a=>o(a),Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;let b9=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function ca(a){if("string"==typeof a)a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a);else if(b2(a))a=cd(a);else throw Error("Uint8Array expected, got "+typeof a);return a}function cb(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error("invalid output length, expected "+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function cc(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function cd(a){return Uint8Array.from(a)}let ce=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),cf=ce("expand 16-byte k"),cg=ce("expand 32-byte k"),ch=b7(cf),ci=b7(cg);function cj(a,b){return a<<b|a>>>32-b}function ck(a){return a.byteOffset%4==0}let cl=0x100000000-1,cm=new Uint32Array,cn=(a,b)=>255&a[b++]|(255&a[b++])<<8;class co{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,b5(a=ca(a),32);const b=cn(a,0),c=cn(a,2),d=cn(a,4),e=cn(a,6),f=cn(a,8),g=cn(a,10),h=cn(a,12),i=cn(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=cn(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=cn(a,b+0),q=cn(a,b+2),r=cn(a,b+4),s=cn(a,b+6),t=cn(a,b+8),u=cn(a,b+10),v=cn(a,b+12),w=cn(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;b8(c)}update(a){b6(this),b5(a=ca(a));let{buffer:b,blockLen:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){b8(this.h,this.r,this.buffer,this.pad)}digestInto(a){b6(this),function(a,b){b5(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,h:c}=this,{pos:d}=this;if(d){for(b[d++]=1;d<16;d++)b[d]=0;this.process(b,0,!0)}this.finalize();let e=0;for(let b=0;b<8;b++)a[e++]=c[b]>>>0,a[e++]=c[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let cp=(p=a=>new co(a),(e=(a,b)=>p(b).update(ca(a)).digest()).outputLen=(f=p(new Uint8Array(32))).outputLen,e.blockLen=f.blockLen,e.create=a=>p(a),e),cq=function(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return b4(e),b4(g),b3(f),b3(c),(b,h,i,j,k=0)=>{b5(b),b5(h),b5(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),b5(j),b4(k),k<0||k>=cl)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],n=b.length,o,p;if(32===n)m.push(o=cd(b)),p=ci;else if(16===n&&c)(o=new Uint8Array(32)).set(b),o.set(b,16),p=ch,m.push(o);else throw Error(`arx: invalid 32-byte key, got length=${n}`);ck(h)||m.push(h=cd(h));let q=b7(o);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(p,q,b7(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=b7(j),l=ck(e)&&ck(f),m=l?b7(e):cm,n=l?b7(f):cm;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=cl)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,p,q,b7(h),i,j,k,g),b8(...m),j}}(function(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=cj(H^(v=v+z|0),16))|0,v=v+(z=cj(z^D,12))|0,D=D+(H=cj(H^v,8))|0,z=cj(z^D,7),E=E+(I=cj(I^(w=w+A|0),16))|0,w=w+(A=cj(A^E,12))|0,E=E+(I=cj(I^w,8))|0,A=cj(A^E,7),F=F+(J=cj(J^(x=x+B|0),16))|0,x=x+(B=cj(B^F,12))|0,F=F+(J=cj(J^x,8))|0,B=cj(B^F,7),G=G+(K=cj(K^(y=y+C|0),16))|0,y=y+(C=cj(C^G,12))|0,G=G+(K=cj(K^y,8))|0,C=cj(C^G,7),F=F+(K=cj(K^(v=v+A|0),16))|0,v=v+(A=cj(A^F,12))|0,F=F+(K=cj(K^v,8))|0,A=cj(A^F,7),G=G+(H=cj(H^(w=w+B|0),16))|0,w=w+(B=cj(B^G,12))|0,G=G+(H=cj(H^w,8))|0,B=cj(B^G,7),D=D+(I=cj(I^(x=x+C|0),16))|0,x=x+(C=cj(C^D,12))|0,D=D+(I=cj(I^x,8))|0,C=cj(C^D,7),E=E+(J=cj(J^(y=y+z|0),16))|0,y=y+(z=cj(z^E,12))|0,E=E+(J=cj(J^y,8))|0,z=cj(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),cr=new Uint8Array(16),cs=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(cr.subarray(c))},ct=new Uint8Array(32);function cu(a,b,c,d,e){var f,g;let h,i,j=a(b,c,ct),k=cp.create(j);e&&cs(k,e),cs(k,d);let l=(f=d.length,g=e?e.length:0,b3(!0),cc(i=new DataView((h=new Uint8Array(16)).buffer,h.byteOffset,h.byteLength),0,BigInt(g),!0),cc(i,8,BigInt(f),!0),h);k.update(l);let m=k.digest();return b8(j,l),m}let cv=((a,b)=>{function c(d,...e){if(b5(d),!b9)throw Error("Non little-endian hardware is not yet supported");if(void 0!==a.nonceLength){let b=e[0];if(!b)throw Error("nonce / iv required");a.varSizeNonce?b5(b):b5(b,a.nonceLength)}let f=a.tagLength;f&&void 0!==e[1]&&b5(e[1]);let g=b(d,...e),h=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");b5(b)}},i=!1;return{encrypt(a,b){if(i)throw Error("cannot encrypt() twice with same key + nonce");return i=!0,b5(a),h(g.encrypt.length,b),g.encrypt(a,b)},decrypt(a,b){if(b5(a),f&&a.length<f)throw Error("invalid ciphertext length: smaller than tagLength="+f);return h(g.decrypt.length,b),g.decrypt(a,b)}}}return Object.assign(c,a),c})({blockSize:64,nonceLength:12,tagLength:16},(a,b,c)=>({encrypt(d,e){let f=d.length;(e=cb(f+16,e,!1)).set(d);let g=e.subarray(0,-16);cq(a,b,g,g,1);let h=cu(cq,a,b,g,c);return e.set(h,f),b8(h),e},decrypt(d,e){e=cb(d.length-16,e,!1);let f=d.subarray(0,-16),g=d.subarray(-16),h=cu(cq,a,b,f,c);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(g,h))throw Error("invalid tag");return e.set(d.subarray(0,-16)),cq(a,b,e,e,1),b8(h),e}}));class cw extends bm{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,a3(a);const c=bk(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),a7(e)}update(a){return a4(this),this.iHash.update(a),this}digestInto(a){a4(this),a2(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let cx=(a,b,c)=>new cw(a,b).update(c).digest();cx.create=(a,b)=>new cw(a,b);let cy=Uint8Array.from([0]),cz=Uint8Array.of(),cA=BigInt(0),cB=BigInt(1);function cC(a,b=""){if("boolean"!=typeof a)throw Error((b&&`"${b}"`)+"expected boolean, got type="+typeof a);return a}function cD(a,b,c=""){let d=a0(a),e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function cE(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function cF(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?cA:BigInt("0x"+a)}function cG(a){return a2(a),cF(bg(Uint8Array.from(a).reverse()))}function cH(a,b){return bi(a.toString(16).padStart(2*b,"0"))}function cI(a,b){return cH(a,b).reverse()}function cJ(a,b,c){let d;if("string"==typeof b)try{d=bi(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(a0(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}let cK=a=>"bigint"==typeof a&&cA<=a;function cL(a,b,c,d){if(!(cK(b)&&cK(c)&&cK(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}function cM(a){let b;for(b=0;a>cA;a>>=cB,b+=1);return b}let cN=a=>(cB<<BigInt(a))-cB;function cO(a,b,c={}){if(!a||"object"!=typeof a)throw Error("expected valid options object");function d(b,c,d){let e=a[b];if(d&&void 0===e)return;let f=typeof e;if(f!==c||null===e)throw Error(`param "${b}" is invalid: expected ${c}, got ${f}`)}Object.entries(b).forEach(([a,b])=>d(a,b,!1)),Object.entries(c).forEach(([a,b])=>d(a,b,!0))}function cP(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let cQ=BigInt(0),cR=BigInt(1),cS=BigInt(2),cT=BigInt(3),cU=BigInt(4),cV=BigInt(5),cW=BigInt(7),cX=BigInt(8),cY=BigInt(9),cZ=BigInt(16);function c$(a,b){let c=a%b;return c>=cQ?c:b+c}function c_(a,b,c){let d=a;for(;b-- >cQ;)d*=d,d%=c;return d}function c0(a,b){if(a===cQ)throw Error("invert: expected non-zero number");if(b<=cQ)throw Error("invert: expected positive modulus, got "+b);let c=c$(a,b),d=b,e=cQ,f=cR;for(;c!==cQ;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==cR)throw Error("invert: does not exist");return c$(e,b)}function c1(a,b,c){if(!a.eql(a.sqr(b),c))throw Error("Cannot find square root")}function c2(a,b){let c=(a.ORDER+cR)/cU,d=a.pow(b,c);return c1(a,d,b),d}function c3(a,b){let c=(a.ORDER-cV)/cX,d=a.mul(b,cS),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,cS),e),h=a.mul(f,a.sub(g,a.ONE));return c1(a,h,b),h}function c4(a){if(a<cT)throw Error("sqrt is not defined for small field");let b=a-cR,c=0;for(;b%cS===cQ;)b/=cS,c++;let d=cS,e=c9(a);for(;1===c7(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return c2;let f=e.pow(d,b),g=(b+cR)/cS;return function(a,d){if(a.is0(d))return d;if(1!==c7(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=cR<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}let c5=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function c6(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function c7(a,b){let c=(a.ORDER-cR)/cS,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function c8(a,b){void 0!==b&&a1(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function c9(a,b,c=!1,d={}){let e;if(a<=cQ)throw Error("invalid field: expected ORDER > 0, got "+a);let f,g,h=!1,i;if("object"==typeof b&&null!=b){if(d.sqrt||c)throw Error("cannot specify opts in two arguments");b.BITS&&(f=b.BITS),b.sqrt&&(g=b.sqrt),"boolean"==typeof b.isLE&&(c=b.isLE),"boolean"==typeof b.modFromBytes&&(h=b.modFromBytes),i=b.allowedLengths}else"number"==typeof b&&(f=b),d.sqrt&&(g=d.sqrt);let{nBitLength:j,nByteLength:k}=c8(a,f);if(k>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let l=Object.freeze({ORDER:a,isLE:c,BITS:j,BYTES:k,MASK:cN(j),ZERO:cQ,ONE:cR,allowedLengths:i,create:b=>c$(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return cQ<=b&&b<a},is0:a=>a===cQ,isValidNot0:a=>!l.is0(a)&&l.isValid(a),isOdd:a=>(a&cR)===cR,neg:b=>c$(-b,a),eql:(a,b)=>a===b,sqr:b=>c$(b*b,a),add:(b,c)=>c$(b+c,a),sub:(b,c)=>c$(b-c,a),mul:(b,c)=>c$(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<cQ)throw Error("invalid exponent, negatives unsupported");if(c===cQ)return a.ONE;if(c===cR)return b;let d=a.ONE,e=b;for(;c>cQ;)c&cR&&(d=a.mul(d,e)),e=a.sqr(e),c>>=cR;return d})(l,a,b),div:(b,c)=>c$(b*c0(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>c0(b,a),sqrt:g||(b=>{let c,d,f,g,h,i;return e||(e=a%cU===cT?c2:a%cX===cV?c3:a%cZ===cY?(c=c9(a),f=(d=c4(a))(c,c.neg(c.ONE)),g=d(c,f),h=d(c,c.neg(f)),i=(a+cW)/cZ,(a,b)=>{let c=a.pow(b,i),d=a.mul(c,f),e=a.mul(c,g),j=a.mul(c,h),k=a.eql(a.sqr(d),b),l=a.eql(a.sqr(e),b);c=a.cmov(c,d,k),d=a.cmov(j,e,l);let m=a.eql(a.sqr(d),b),n=a.cmov(c,d,m);return c1(a,n,b),n}):c4(a)),e(l,b)}),toBytes:a=>c?cI(a,k):cH(a,k),fromBytes:(b,d=!0)=>{if(i){if(!i.includes(b.length)||b.length>k)throw Error("Field.fromBytes: expected "+i+" bytes, got "+b.length);let a=new Uint8Array(k);a.set(b,c?0:a.length-b.length),b=a}if(b.length!==k)throw Error("Field.fromBytes: expected "+k+" bytes, got "+b.length);let e=c?cG(b):cF(bg(b));if(h&&(e=c$(e,a)),!d&&!l.isValid(e))throw Error("invalid field element: outside of range 0..ORDER");return e},invertBatch:a=>c6(l,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(l)}function da(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function db(a){let b=da(a);return b+Math.ceil(b/2)}let dc=BigInt(0),dd=BigInt(1);function de(a,b){let c=b.negate();return a?c:b}function df(a,b){let c=c6(a.Fp,b.map(a=>a.Z));return b.map((b,d)=>a.fromAffine(b.toAffine(c[d])))}function dg(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function dh(a,b){dg(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:cN(a),maxNumber:e,shiftBy:BigInt(a)}}function di(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=dd);let j=b*d;return{nextN:i,offset:j+Math.abs(h)-1,isZero:0===h,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let dj=new WeakMap,dk=new WeakMap;function dl(a){return dk.get(a)||1}function dm(a){if(a!==dc)throw Error("invalid wNAF")}class dn{constructor(a,b){this.BASE=a.BASE,this.ZERO=a.ZERO,this.Fn=a.Fn,this.bits=b}_unsafeLadder(a,b,c=this.ZERO){let d=a;for(;b>dc;)b&dd&&(c=c.add(d)),d=d.double(),b>>=dd;return c}precomputeWindow(a,b){let{windows:c,windowSize:d}=dh(b,this.bits),e=[],f=a,g=f;for(let a=0;a<c;a++){g=f,e.push(g);for(let a=1;a<d;a++)g=g.add(f),e.push(g);f=g.double()}return e}wNAF(a,b,c){if(!this.Fn.isValid(c))throw Error("invalid scalar");let d=this.ZERO,e=this.BASE,f=dh(a,this.bits);for(let a=0;a<f.windows;a++){let{nextN:g,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=di(c,a,f);c=g,i?e=e.add(de(k,b[l])):d=d.add(de(j,b[h]))}return dm(c),{p:d,f:e}}wNAFUnsafe(a,b,c,d=this.ZERO){let e=dh(a,this.bits);for(let a=0;a<e.windows&&c!==dc;a++){let{nextN:f,offset:g,isZero:h,isNeg:i}=di(c,a,e);if(c=f,!h){let a=b[g];d=d.add(i?a.negate():a)}}return dm(c),d}getPrecomputes(a,b,c){let d=dj.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&("function"==typeof c&&(d=c(d)),dj.set(b,d))),d}cached(a,b,c){let d=dl(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)}unsafe(a,b,c,d){let e=dl(a);return 1===e?this._unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)}createCache(a,b){dg(b,this.bits),dk.set(a,b),dj.delete(a)}hasCache(a){return 1!==dl(a)}}function dp(a,b,c){if(!b)return c9(a,{isLE:c});if(b.ORDER!==a)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return cO(b,c5.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),b}BigInt(0),BigInt(1),BigInt(2),BigInt(8),bj("HashToScalar-");let dq=BigInt(0),dr=BigInt(1),ds=BigInt(2),dt=BigInt(1),du=BigInt(2),dv=BigInt(3),dw=BigInt(5),dx=BigInt(8),dy=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),dz={p:dy,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:dx,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")},dA=function(a){let{P:b,type:c,adjustScalarBytes:d,powPminus2:e,randomBytes:f}=(cO(a,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...a})),g="x25519"===c;if(!g&&"x448"!==c)throw Error("invalid type");let h=f||bo,i=g?255:448,j=g?32:56,k=BigInt(g?9:5),l=BigInt(g?121665:39081),m=g?ds**BigInt(254):ds**BigInt(447),n=m+(g?BigInt(8)*ds**BigInt(251)-dr:BigInt(4)*ds**BigInt(445)-dr)+dr,o=a=>c$(a,b),p=cI(o(k),j);function q(a,c){let f,h=function(a,c){cL("u",a,dq,b),cL("scalar",c,m,n);let d=dr,f=dq,g=a,h=dr,j=dq;for(let b=BigInt(i-1);b>=dq;b--){let e=c>>b&dr;j^=e,({x_2:d,x_3:g}=s(j,d,g)),({x_2:f,x_3:h}=s(j,f,h)),j=e;let i=d+f,k=o(i*i),m=d-f,n=o(m*m),p=k-n,q=g+h,r=o((g-h)*i),t=o(q*m),u=r+t,v=r-t;g=o(u*u),h=o(a*o(v*v)),d=o(k*n),f=o(p*(k+o(l*p)))}return{x_2:d,x_3:g}=s(j,d,g),{x_2:f,x_3:h}=s(j,f,h),o(d*e(f))}((f=cJ("u coordinate",c,j),g&&(f[31]&=127),o(cG(f))),cG(d(cJ("scalar",a,j))));if(h===dq)throw Error("invalid private or public key received");return cI(o(h),j)}function r(a){return q(a,p)}function s(a,b,c){let d=o(a*(b-c));return{x_2:b=o(b-d),x_3:c=o(c+d)}}let t={secretKey:j,publicKey:j,seed:j},u=(a=h(j))=>(a2(a,t.seed),a);return{keygen:function(a){let b=u(a);return{secretKey:b,publicKey:r(b)}},getSharedSecret:(a,b)=>q(a,b),getPublicKey:a=>r(a),scalarMult:q,scalarMultBase:r,utils:{randomSecretKey:u,randomPrivateKey:u},GuBytes:p.slice(),lengths:t}}({P:g=c9(dz.p,{isLE:!0}).ORDER,type:"x25519",powPminus2:a=>{let b,c,d,e,f,h,i,j,k,l,m,n,o,p,{pow_p_5_8:q,b2:r}=(b=BigInt(10),c=BigInt(20),d=BigInt(40),e=BigInt(80),h=c_(f=a*a%dy*a%dy,du,dy)*f%dy,i=c_(h,dt,dy)*a%dy,j=c_(i,dw,dy)*i%dy,k=c_(j,b,dy)*j%dy,l=c_(k,c,dy)*k%dy,m=c_(l,d,dy)*l%dy,n=c_(m,e,dy)*m%dy,o=c_(n,e,dy)*m%dy,p=c_(o,b,dy)*j%dy,{pow_p_5_8:c_(p,du,dy)*a%dy,b2:f});return c$(c_(q,dv,g)*r,g)},adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a}}),dB=(a,b)=>(a+(a>=0?b:-b)/dH)/b;function dC(a){if(!["compact","recovered","der"].includes(a))throw Error('Signature format must be "compact", "recovered", or "der"');return a}function dD(a,b){let c={};for(let d of Object.keys(b))c[d]=void 0===a[d]?b[d]:a[d];return cC(c.lowS,"lowS"),cC(c.prehash,"prehash"),void 0!==c.format&&dC(c.format),c}let dE={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=dE;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=cE(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?cE(e.length/2|128):"";return cE(a)+f+e+b},decode(a,b){let{Err:c}=dE,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=dE;if(a<dF)throw new b("integer: negative integers are not allowed");let c=cE(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=dE;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return cF(bg(a))}},toSig(a){let{Err:b,_int:c,_tlv:d}=dE,e=cJ("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=dE,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},dF=BigInt(0),dG=BigInt(1),dH=BigInt(2),dI=BigInt(3),dJ=BigInt(4);function dK(a,b){let c,{BYTES:d}=a;if("bigint"==typeof b)c=b;else{let e=cJ("private key",b);try{c=a.fromBytes(e)}catch{throw Error(`invalid private key: expected ui8a of size ${d}, got ${typeof b}`)}}if(!a.isValidNot0(c))throw Error("invalid private key: out of range [1..N-1]");return c}function dL(a){return Uint8Array.of(a?2:3)}function dM(a,b){return{secretKey:b.BYTES,publicKey:1+a.BYTES,publicKeyUncompressed:1+2*a.BYTES,publicKeyHasPrefix:!0,signature:2*b.BYTES}}function dN(a,b){let c=b=>(function(a){let b,{CURVE:c,curveOpts:d,hash:e,ecdsaOpts:f}=function(a){let b,c,d,e,{CURVE:f,curveOpts:g}=(b={a:a.a,b:a.b,p:a.Fp.ORDER,n:a.n,h:a.h,Gx:a.Gx,Gy:a.Gy},c=a.Fp,d=a.allowedPrivateKeyLengths?Array.from(new Set(a.allowedPrivateKeyLengths.map(a=>Math.ceil(a/2)))):void 0,e={Fp:c,Fn:c9(b.n,{BITS:a.nBitLength,allowedLengths:d,modFromBytes:a.wrapPrivateKey}),allowInfinityPoint:a.allowInfinityPoint,endo:a.endo,isTorsionFree:a.isTorsionFree,clearCofactor:a.clearCofactor,fromBytes:a.fromBytes,toBytes:a.toBytes},{CURVE:b,curveOpts:e}),h={hmac:a.hmac,randomBytes:a.randomBytes,lowS:a.lowS,bits2int:a.bits2int,bits2int_modN:a.bits2int_modN};return{CURVE:f,curveOpts:g,hash:a.hash,ecdsaOpts:h}}(a),g=function(a,b,c={}){a3(b),cO(c,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let d=c.randomBytes||bo,e=c.hmac||((a,...c)=>cx(b,a,bl(...c))),{Fp:f,Fn:g}=a,{ORDER:h,BITS:i}=g,{keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:n}=function(a,b={}){let{Fn:c}=a,d=b.randomBytes||bo,e=Object.assign(dM(a.Fp,c),{seed:db(c.ORDER)});function f(a){try{return!!dK(c,a)}catch{return!1}}function g(a=d(e.seed)){return function(a,b,c=!1){let d=a.length,e=da(b),f=db(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=c$(c?cG(a):cF(bg(a)),b-cR)+cR;return c?cI(g,e):cH(g,e)}(cD(a,e.seed,"seed"),c.ORDER)}function h(b,d=!0){return a.BASE.multiply(dK(c,b)).toBytes(d)}function i(b){if("bigint"==typeof b)return!1;if(b instanceof a)return!0;let{secretKey:d,publicKey:f,publicKeyUncompressed:g}=e;if(c.allowedLengths||d===f)return;let h=cJ("key",b).length;return h===f||h===g}return Object.freeze({getPublicKey:h,getSharedSecret:function(b,d,e=!0){if(!0===i(b))throw Error("first arg must be private key");if(!1===i(d))throw Error("second arg must be public key");let f=dK(c,b);return a.fromHex(d).multiply(f).toBytes(e)},keygen:function(a){let b=g(a);return{secretKey:b,publicKey:h(b)}},Point:a,utils:{isValidSecretKey:f,isValidPublicKey:function(b,c){let{publicKey:d,publicKeyUncompressed:f}=e;try{let e=b.length;return(!0!==c||e===d)&&(!1!==c||e===f)&&!!a.fromBytes(b)}catch{return!1}},randomSecretKey:g,isValidPrivateKey:f,randomPrivateKey:g,normPrivateKeyToScalar:a=>dK(c,a),precompute:(b=8,c=a.BASE)=>c.precompute(b,!1)},lengths:e})}(a,c),o={prehash:!1,lowS:"boolean"==typeof c.lowS&&c.lowS,format:void 0,extraEntropy:!1},p="compact";function q(a,b){if(!g.isValidNot0(b))throw Error(`invalid signature ${a}: out of range 1..Point.Fn.ORDER`);return b}class r{constructor(a,b,c){this.r=q("r",a),this.s=q("s",b),null!=c&&(this.recovery=c),Object.freeze(this)}static fromBytes(a,b=p){var c,d;let e,f;if(c=a,dC(d=b),f=n.signature,cD(c,"compact"===d?f:"recovered"===d?f+1:void 0,`${d} signature`),"der"===b){let{r:b,s:c}=dE.toSig(cD(a));return new r(b,c)}"recovered"===b&&(e=a[0],b="compact",a=a.subarray(1));let h=g.BYTES,i=a.subarray(0,h),j=a.subarray(h,2*h);return new r(g.fromBytes(i),g.fromBytes(j),e)}static fromHex(a,b){return this.fromBytes(bi(a),b)}addRecoveryBit(a){return new r(this.r,this.s,a)}recoverPublicKey(b){let c=f.ORDER,{r:d,s:e,recovery:i}=this;if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");if(h*dH<c&&i>1)throw Error("recovery id is ambiguous for h>1 curve");let j=2===i||3===i?d+h:d;if(!f.isValid(j))throw Error("recovery id 2 or 3 invalid");let k=f.toBytes(j),l=a.fromBytes(bl(dL((1&i)==0),k)),m=g.inv(j),n=t(cJ("msgHash",b)),o=g.create(-n*m),p=g.create(e*m),q=a.BASE.multiplyUnsafe(o).add(l.multiplyUnsafe(p));if(q.is0())throw Error("point at infinify");return q.assertValidity(),q}hasHighS(){return this.s>h>>dG}toBytes(a=p){if(dC(a),"der"===a)return bi(dE.hexFromSig(this));let b=g.toBytes(this.r),c=g.toBytes(this.s);if("recovered"===a){if(null==this.recovery)throw Error("recovery bit must be present");return bl(Uint8Array.of(this.recovery),b,c)}return bl(b,c)}toHex(a){return bg(this.toBytes(a))}assertValidity(){}static fromCompact(a){return r.fromBytes(cJ("sig",a),"compact")}static fromDER(a){return r.fromBytes(cJ("sig",a),"der")}normalizeS(){return this.hasHighS()?new r(this.r,g.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return bg(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return bg(this.toBytes("compact"))}}let s=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=cF(bg(a)),c=8*a.length-i;return c>0?b>>BigInt(c):b},t=c.bits2int_modN||function(a){return g.create(s(a))},u=cN(i);function v(a){return cL("num < 2^"+i,a,dF,u),g.toBytes(a)}function w(a,c){return cD(a,void 0,"message"),c?cD(b(a),void 0,"prehashed message"):a}return Object.freeze({keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:n,Point:a,sign:function(c,f,i={}){let{seed:j,k2sig:k}=function(b,c,e){if(["recovered","canonical"].some(a=>a in e))throw Error("sign() legacy options not supported");let{lowS:f,prehash:i,extraEntropy:j}=dD(e,o),k=t(b=w(b,i)),l=dK(g,c),m=[v(l),v(k)];if(null!=j&&!1!==j){let a=!0===j?d(n.secretKey):j;m.push(cJ("extraEntropy",a))}return{seed:bl(...m),k2sig:function(b){let c=s(b);if(!g.isValidNot0(c))return;let d=g.inv(c),e=a.BASE.multiply(c).toAffine(),i=g.create(e.x);if(i===dF)return;let j=g.create(d*g.create(k+i*l));if(j===dF)return;let m=2*(e.x!==i)|Number(e.y&dG),n=j;return f&&j>h>>dG&&(n=g.neg(j),m^=1),new r(i,n,m)}}}(c=cJ("message",c),f,i);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=a=>new Uint8Array(a),e=d(a),f=d(a),g=0,h=()=>{e.fill(1),f.fill(0),g=0},i=(...a)=>c(f,e,...a),j=(a=d(0))=>{f=i(Uint8Array.of(0),a),e=i(),0!==a.length&&(f=i(Uint8Array.of(1),a),e=i())},k=()=>{if(g++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(e=i()).slice();c.push(b),a+=e.length}return bl(...c)};return(a,b)=>{let c;for(h(),j(a);!(c=b(k()));)j();return h(),c}})(b.outputLen,g.BYTES,e)(j,k)},verify:function(b,c,d,e={}){let{lowS:f,prehash:h,format:i}=dD(e,o);if(d=cJ("publicKey",d),c=w(cJ("message",c),h),"strict"in e)throw Error("options.strict was renamed to lowS");let j=void 0===i?function(a){let b,c="string"==typeof a||a0(a),d=!c&&null!==a&&"object"==typeof a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!c&&!d)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(d)b=new r(a.r,a.s);else if(c){try{b=r.fromBytes(cJ("sig",a),"der")}catch(a){if(!(a instanceof dE.Err))throw a}if(!b)try{b=r.fromBytes(cJ("sig",a),"compact")}catch{return!1}}return b||!1}(b):r.fromBytes(cJ("sig",b),i);if(!1===j)return!1;try{let b=a.fromBytes(d);if(f&&j.hasHighS())return!1;let{r:e,s:h}=j,i=t(c),k=g.inv(h),l=g.create(i*k),m=g.create(e*k),n=a.BASE.multiplyUnsafe(l).add(b.multiplyUnsafe(m));return!n.is0()&&g.create(n.x)===e}catch{return!1}},recoverPublicKey:function(a,b,c={}){let{prehash:d}=dD(c,o);return b=w(b,d),r.fromBytes(a,"recovered").recoverPublicKey(b).toBytes()},Signature:r,hash:b})}(function(a,b={}){let c=function(a,b,c={},d){if(void 0===d&&(d="edwards"===a),!b||"object"!=typeof b)throw Error(`expected valid ${a} CURVE object`);for(let a of["p","n","h"]){let c=b[a];if(!("bigint"==typeof c&&c>dc))throw Error(`CURVE.${a} must be positive bigint`)}let e=dp(b.p,c.Fp,d),f=dp(b.n,c.Fn,d);for(let c of["Gx","Gy","a","weierstrass"===a?"b":"d"])if(!e.isValid(b[c]))throw Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return{CURVE:b=Object.freeze(Object.assign({},b)),Fp:e,Fn:f}}("weierstrass",a,b),{Fp:d,Fn:e}=c,f=c.CURVE,{h:g,n:h}=f;cO(b,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:i}=b;if(i&&(!d.is0(f.a)||"bigint"!=typeof i.beta||!Array.isArray(i.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let j=dM(d,e);function k(){if(!d.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let l=b.toBytes||function(a,b,c){let{x:e,y:f}=b.toAffine(),g=d.toBytes(e);return(cC(c,"isCompressed"),c)?(k(),bl(dL(!d.isOdd(f)),g)):bl(Uint8Array.of(4),g,d.toBytes(f))},m=b.fromBytes||function(a){cD(a,void 0,"Point");let{publicKey:b,publicKeyUncompressed:c}=j,e=a.length,f=a[0],g=a.subarray(1);if(e===b&&(2===f||3===f)){let a,b=d.fromBytes(g);if(!d.isValid(b))throw Error("bad point: is not on curve, wrong x");let c=n(b);try{a=d.sqrt(c)}catch(a){throw Error("bad point: is not on curve, sqrt error"+(a instanceof Error?": "+a.message:""))}return k(),(1&f)==1!==d.isOdd(a)&&(a=d.neg(a)),{x:b,y:a}}if(e===c&&4===f){let a=d.BYTES,b=d.fromBytes(g.subarray(0,a)),c=d.fromBytes(g.subarray(a,2*a));if(!o(b,c))throw Error("bad point: is not on curve");return{x:b,y:c}}throw Error(`bad point: got length ${e}, expected compressed=${b} or uncompressed=${c}`)};function n(a){let b=d.sqr(a),c=d.mul(b,a);return d.add(d.add(c,d.mul(a,f.a)),f.b)}function o(a,b){let c=d.sqr(b),e=n(a);return d.eql(c,e)}if(!o(f.Gx,f.Gy))throw Error("bad curve params: generator point");let p=d.mul(d.pow(f.a,dI),dJ),q=d.mul(d.sqr(f.b),BigInt(27));if(d.is0(d.add(p,q)))throw Error("bad curve params: a or b");function r(a,b,c=!1){if(!d.isValid(b)||c&&d.is0(b))throw Error(`bad point coordinate ${a}`);return b}function s(a){if(!(a instanceof x))throw Error("ProjectivePoint expected")}function t(a){if(!i||!i.basises)throw Error("no endo");return function(a,b,c){let[[d,e],[f,g]]=b,h=dB(g*a,c),i=dB(-e*a,c),j=a-h*d-i*f,k=-h*e-i*g,l=j<dF,m=k<dF;l&&(j=-j),m&&(k=-k);let n=cN(Math.ceil(cM(c)/2))+dG;if(j<dF||j>=n||k<dF||k>=n)throw Error("splitScalar (endomorphism): failed, k="+a);return{k1neg:l,k1:j,k2neg:m,k2:k}}(a,i.basises,e.ORDER)}let u=cP((a,b)=>{let{X:c,Y:e,Z:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),v=cP(a=>{if(a.is0()){if(b.allowInfinityPoint&&!d.is0(a.Y))return;throw Error("bad point: ZERO")}let{x:c,y:e}=a.toAffine();if(!d.isValid(c)||!d.isValid(e))throw Error("bad point: x or y not field elements");if(!o(c,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function w(a,b,c,e,f){return c=new x(d.mul(c.X,a),c.Y,c.Z),b=de(e,b),c=de(f,c),b.add(c)}class x{constructor(a,b,c){this.X=r("x",a),this.Y=r("y",b,!0),this.Z=r("z",c),Object.freeze(this)}static CURVE(){return f}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof x)throw Error("projective point not allowed");return d.is0(b)&&d.is0(c)?x.ZERO:new x(b,c,d.ONE)}static fromBytes(a){let b=x.fromAffine(m(cD(a,void 0,"point")));return b.assertValidity(),b}static fromHex(a){return x.fromBytes(cJ("pointHex",a))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(a=8,b=!0){return z.createCache(this,a),b||this.multiply(dI),this}assertValidity(){v(this)}hasEvenY(){let{y:a}=this.toAffine();if(!d.isOdd)throw Error("Field doesn't support isOdd");return!d.isOdd(a)}equals(a){s(a);let{X:b,Y:c,Z:e}=this,{X:f,Y:g,Z:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new x(this.X,d.neg(this.Y),this.Z)}double(){let{a:a,b}=f,c=d.mul(b,dI),{X:e,Y:g,Z:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(e,e),m=d.mul(g,g),n=d.mul(h,h),o=d.mul(e,g);return o=d.add(o,o),k=d.mul(e,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(c,n),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(o,i),k=d.mul(c,k),n=d.mul(a,n),o=d.sub(l,n),o=d.mul(a,o),o=d.add(o,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,n),l=d.mul(l,o),j=d.add(j,l),n=d.mul(g,h),n=d.add(n,n),l=d.mul(n,o),i=d.sub(i,l),k=d.mul(n,m),k=d.add(k,k),new x(i,j,k=d.add(k,k))}add(a){s(a);let{X:b,Y:c,Z:e}=this,{X:g,Y:h,Z:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,m=f.a,n=d.mul(f.b,dI),o=d.mul(b,g),p=d.mul(c,h),q=d.mul(e,i),r=d.add(b,c),t=d.add(g,h);r=d.mul(r,t),t=d.add(o,p),r=d.sub(r,t),t=d.add(b,e);let u=d.add(g,i);return t=d.mul(t,u),u=d.add(o,q),t=d.sub(t,u),u=d.add(c,e),j=d.add(h,i),u=d.mul(u,j),j=d.add(p,q),u=d.sub(u,j),l=d.mul(m,t),j=d.mul(n,q),l=d.add(j,l),j=d.sub(p,l),l=d.add(p,l),k=d.mul(j,l),p=d.add(o,o),p=d.add(p,o),q=d.mul(m,q),t=d.mul(n,t),p=d.add(p,q),q=d.sub(o,q),q=d.mul(m,q),t=d.add(t,q),o=d.mul(p,t),k=d.add(k,o),o=d.mul(u,t),j=d.mul(r,j),j=d.sub(j,o),o=d.mul(r,p),l=d.mul(u,l),new x(j,k,l=d.add(l,o))}subtract(a){return this.add(a.negate())}is0(){return this.equals(x.ZERO)}multiply(a){let c,d,{endo:f}=b;if(!e.isValidNot0(a))throw Error("invalid scalar: out of range");let g=a=>z.cached(this,a,a=>df(x,a));if(f){let{k1neg:b,k1:e,k2neg:h,k2:i}=t(a),{p:j,f:k}=g(e),{p:l,f:m}=g(i);d=k.add(m),c=w(f.beta,j,l,b,h)}else{let{p:b,f:e}=g(a);c=b,d=e}return df(x,[c,d])[0]}multiplyUnsafe(a){let{endo:c}=b;if(!e.isValid(a))throw Error("invalid scalar: out of range");if(a===dF||this.is0())return x.ZERO;if(a===dG)return this;if(z.hasCache(this))return this.multiply(a);if(!c)return z.unsafe(this,a);{let{k1neg:b,k1:d,k2neg:e,k2:f}=t(a),{p1:g,p2:h}=function(a,b,c,d){let e=b,f=a.ZERO,g=a.ZERO;for(;c>dc||d>dc;)c&dd&&(f=f.add(e)),d&dd&&(g=g.add(e)),e=e.double(),c>>=dd,d>>=dd;return{p1:f,p2:g}}(x,this,d,f);return w(c.beta,g,h,b,e)}}multiplyAndAddUnsafe(a,b,c){let d=this.multiplyUnsafe(b).add(a.multiplyUnsafe(c));return d.is0()?void 0:d}toAffine(a){return u(this,a)}isTorsionFree(){let{isTorsionFree:a}=b;return g===dG||(a?a(x,this):z.unsafe(this,h).is0())}clearCofactor(){let{clearCofactor:a}=b;return g===dG?this:a?a(x,this):this.multiplyUnsafe(g)}isSmallOrder(){return this.multiplyUnsafe(g).is0()}toBytes(a=!0){return cC(a,"isCompressed"),this.assertValidity(),l(x,this,a)}toHex(a=!0){return bg(this.toBytes(a))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(a=!0){return this.toBytes(a)}_setWindowSize(a){this.precompute(a)}static normalizeZ(a){return df(x,a)}static msm(a,b){return function(a,b,c,d){(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})})(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b);let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=cM(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=cN(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(x,e,a,b)}static fromPrivateKey(a){return x.BASE.multiply(dK(e,a))}}x.BASE=new x(f.Gx,f.Gy,d.ONE),x.ZERO=new x(d.ZERO,d.ONE,d.ZERO),x.Fp=d,x.Fn=e;let y=e.BITS,z=new dn(x,b.endo?Math.ceil(y/2):y);return x.BASE.precompute(8),x}(c,d),e,f);return b=g.Point,Object.assign({},g,{ProjectivePoint:b,CURVE:Object.assign({},a,c8(b.Fn.ORDER,b.Fn.BITS))})})({...a,hash:b});return{...c(b),create:c}}let dO={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},dP={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},dQ={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},dR=c9(dO.p),dS=c9(dP.p),dT=c9(dQ.p),dU=dN({...dO,Fp:dR,lowS:!1},bU);dN({...dP,Fp:dS,lowS:!1},bW),dN({...dQ,Fp:dT,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},bV);let dV="base10",dW="base16",dX="base64pad",dY="base64url",dZ="utf8";function d$(){let a=bo(32);return(0,am.toString)(a,dW)}function d_(a){let b=bU((0,an.fromString)(a,dZ));return(0,am.toString)(b,dW)}function d0(a){return(0,an.fromString)(`${a}`,dV)}function d1(a){return Number((0,am.toString)(a,dV))}function d2(a){return a.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function d3(a){let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=(4-b.length%4)%4;return b+"=".repeat(c)}function d4(a){if(2===d1(a.type))return(0,am.toString)((0,ao.concat)([a.type,a.sealed]),dX);if(1===d1(a.type)){if(typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");return(0,am.toString)((0,ao.concat)([a.type,a.senderPublicKey,a.iv,a.sealed]),dX)}return(0,am.toString)((0,ao.concat)([a.type,a.iv,a.sealed]),dX)}function d5(a){let b=(a.encoding||dX)===dY?d3(a.encoded):a.encoded,c=(0,an.fromString)(b,dX),d=c.slice(0,1);if(1===d1(d)){let a=c.slice(1,33),b=c.slice(33,45);return{type:d,sealed:c.slice(45),iv:b,senderPublicKey:a}}if(2===d1(d))return{type:d,sealed:c.slice(1),iv:bo(12)};let e=c.slice(1,13);return{type:d,sealed:c.slice(13),iv:e}}function d6(a){let b=a?.type||0;if(1===b){if(typeof a?.senderPublicKey>"u")throw Error("missing sender public key");if(typeof a?.receiverPublicKey>"u")throw Error("missing receiver public key")}return{type:b,senderPublicKey:a?.senderPublicKey,receiverPublicKey:a?.receiverPublicKey}}function d7(a){return 1===a.type&&"string"==typeof a.senderPublicKey&&"string"==typeof a.receiverPublicKey}function d8(a){return a?.relay||{protocol:"irn"}}function d9(a){let b=ap.RELAY_JSONRPC[a];if(typeof b>"u")throw Error(`Relay Protocol not supported: ${a}`);return b}var ea=Object.defineProperty,eb=Object.defineProperties,ec=Object.getOwnPropertyDescriptors,ed=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,ef=Object.prototype.propertyIsEnumerable,eg=(a,b,c)=>b in a?ea(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,eh=(a,b)=>{for(var c in b||(b={}))ee.call(b,c)&&eg(a,c,b[c]);if(ed)for(var c of ed(b))ef.call(b,c)&&eg(a,c,b[c]);return a};function ei(a){var b;if(!a.includes("wc:")){let b=aJ(a);null!=b&&b.includes("wc:")&&(a=b)}let c=(a=(a=a.includes("wc://")?a.replace("wc://",""):a).includes("wc:")?a.replace("wc:",""):a).indexOf(":"),d=-1!==a.indexOf("?")?a.indexOf("?"):void 0,e=a.substring(0,c),f=a.substring(c+1,d).split("@"),g=Object.fromEntries(new URLSearchParams("u">typeof d?a.substring(d):"").entries()),h="string"==typeof g.methods?g.methods.split(","):void 0;return{protocol:e,topic:(b=f[0]).startsWith("//")?b.substring(2):b,version:parseInt(f[1],10),symKey:g.symKey,relay:function(a,b="-"){let c={},d="relay"+b;return Object.keys(a).forEach(b=>{if(b.startsWith(d)){let e=b.replace(d,""),f=a[b];c[e]=f}}),c}(g),methods:h,expiryTimestamp:g.expiryTimestamp?parseInt(g.expiryTimestamp,10):void 0}}function ej(a){let b=new URLSearchParams;return Object.entries(eh(eh(eb(eh({},function(a,b="-"){let c={};return Object.keys(a).forEach(d=>{a[d]&&(c["relay"+b+d]=a[d])}),c}(a.relay)),ec({symKey:a.symKey})),a.expiryTimestamp&&{expiryTimestamp:a.expiryTimestamp.toString()}),a.methods&&{methods:a.methods.join(",")})).sort(([a],[b])=>a.localeCompare(b)).forEach(([a,c])=>{void 0!==c&&b.append(a,String(c))}),`${a.protocol}:${a.topic}@${a.version}?${b}`}Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;let ek={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},el={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function em(a,b){let{message:c,code:d}=el[a];return{message:b?`${c} ${b}`:c,code:d}}function en(a,b){let{message:c,code:d}=ek[a];return{message:b?`${c} ${b}`:c,code:d}}function eo(a){return typeof a>"u"}function ep(a,b){return!!(b&&eo(a))||"string"==typeof a&&!!a.trim().length}function eq(a){return"u">typeof a}function er(){let a=ax();return new Promise(b=>{switch(a){case at:b(aw()&&navigator?.onLine);break;case ar:b(es());break;default:b(!0)}})}async function es(){if(av()&&null!=a.g&&a.g.NetInfo){let b=await (null==a.g?void 0:a.g.NetInfo.fetch());return b?.isConnected}return!0}var et=a.i(271137);a.i(258910);var eu=a.i(499963),ev=a.i(517992),ew=a.i(901631);let ex="core",ey=`wc@2:${ex}:`,ez={database:":memory:"},eA="client_ed25519_seed",eB=ac.ONE_DAY,eC=ac.SIX_HOURS,eD="wss://relay.walletconnect.org",eE="relayer_message",eF="relayer_message_ack",eG="relayer_connection_stalled",eH="relayer_publish",eI="payload",eJ="connect",eK="disconnect",eL="error",eM="2.21.9",eN="link_mode",eO="relay",eP="inbound",eQ="WALLETCONNECT_LINK_MODE_APPS",eR="subscription_created",eS="subscription_deleted",eT=(ac.THIRTY_DAYS,ac.FIVE_SECONDS,ac.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:ac.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ac.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ac.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ac.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ac.ONE_DAY,prompt:!1,tag:0},res:{ttl:ac.ONE_DAY,prompt:!1,tag:0}}}),eU="pairing_create",eV="pairing_delete",eW="history_created",eX="history_updated",eY="history_deleted",eZ="expirer_created",e$="expirer_deleted",e_="expirer_expired",e0=(ac.ONE_DAY,"https://verify.walletconnect.org"),e1=`${e0}/v3`,e2=["https://verify.walletconnect.com",e0],e3="malformed_pairing_uri",e4="session_approve_started";var e5=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let e6=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class e7{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class e8{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return fa(this,a)}}class e9{constructor(a){this.decoders=a}or(a){return fa(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let fa=(a,b)=>new e9({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class fb{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new e7(a,b,c),this.decoder=new e8(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let fc=({name:a,prefix:b,encode:c,decode:d})=>new fb(a,b,c,d),fd=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=e5(c,b);return fc({prefix:a,name:b,encode:d,decode:a=>e6(e(a))})},fe=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>fc({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var ff=Object.freeze({__proto__:null,identity:fc({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),fg=Object.freeze({__proto__:null,base2:fe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),fh=Object.freeze({__proto__:null,base8:fe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),fi=Object.freeze({__proto__:null,base10:fd({prefix:"9",name:"base10",alphabet:"0123456789"})}),fj=Object.freeze({__proto__:null,base16:fe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:fe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),fk=Object.freeze({__proto__:null,base32:fe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:fe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:fe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:fe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:fe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:fe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:fe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:fe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:fe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),fl=Object.freeze({__proto__:null,base36:fd({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:fd({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),fm=Object.freeze({__proto__:null,base58btc:fd({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:fd({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),fn=Object.freeze({__proto__:null,base64:fe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:fe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:fe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:fe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let fo=Array.from(""),fp=fo.reduce((a,b,c)=>(a[c]=b,a),[]),fq=fo.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var fr=Object.freeze({__proto__:null,base256emoji:fc({prefix:"",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=fp[b],"")},decode:function(a){let b=[];for(let c of a){let a=fq[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function fs(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,fs.bytes=c-d+1,b}var ft=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};let fu=(a,b,c=0)=>(fs(a,b,c),b),fv=(a,b)=>{let c=b.byteLength,d=ft(a),e=d+ft(c),f=new Uint8Array(e+c);return fu(a,f,0),fu(c,f,d),f.set(b,e),new fw(a,c,b,f)};class fw{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let fx=({name:a,code:b,encode:c})=>new fy(a,b,c);class fy{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?fv(this.code,b):b.then(a=>fv(this.code,a))}throw Error("Unknown type, must be binary type")}}let fz=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var fA=Object.freeze({__proto__:null,sha256:fx({name:"sha2-256",code:18,encode:fz("SHA-256")}),sha512:fx({name:"sha2-512",code:19,encode:fz("SHA-512")})}),fB=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:e6,digest:a=>fv(0,e6(a))}});new TextEncoder,new TextDecoder;let fC={...ff,...fg,...fh,...fi,...fj,...fk,...fl,...fm,...fn,...fr};function fD(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function fE(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...fA,...fB});let fF=fE("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),fG=fE("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=function(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?fD(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),fH={utf8:fF,"utf-8":fF,hex:fC.base16,latin1:fG,ascii:fG,binary:fG,...fC};var fI=Object.defineProperty,fJ=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?fI(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class fK{constructor(a,b){this.core=a,this.logger=b,fJ(this,"keychain",new Map),fJ(this,"name","keychain"),fJ(this,"version","0.3"),fJ(this,"initialized",!1),fJ(this,"storagePrefix",ey),fJ(this,"init",async()=>{if(!this.initialized){let a=await this.getKeyChain();"u">typeof a&&(this.keychain=a),this.initialized=!0}}),fJ(this,"has",a=>(this.isInitialized(),this.keychain.has(a))),fJ(this,"set",async(a,b)=>{this.isInitialized(),this.keychain.set(a,b),await this.persist()}),fJ(this,"get",a=>{this.isInitialized();let b=this.keychain.get(a);if(typeof b>"u"){let{message:b}=em("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}),fJ(this,"del",async a=>{this.isInitialized(),this.keychain.delete(a),await this.persist()}),this.core=a,this.logger=M(b,this.name)}get context(){return L(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(a){await this.core.storage.setItem(this.storageKey,aA(a))}async getKeyChain(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?aB(a):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:a}=em("NOT_INITIALIZED",this.name);throw Error(a)}}}var fL=Object.defineProperty,fM=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?fL(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class fN{constructor(a,b,c){this.core=a,this.logger=b,fM(this,"name","crypto"),fM(this,"keychain"),fM(this,"randomSessionIdentifier",d$()),fM(this,"initialized",!1),fM(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),fM(this,"hasKeys",a=>(this.isInitialized(),this.keychain.has(a))),fM(this,"getClientId",async()=>{this.isInitialized();let a=await this.getClientSeed(),b=ad.generateKeyPair(a);return ad.encodeIss(b.publicKey)}),fM(this,"generateKeyPair",()=>{let a,b;this.isInitialized();let c=(a=dA.utils.randomPrivateKey(),b=dA.getPublicKey(a),{privateKey:(0,am.toString)(a,dW),publicKey:(0,am.toString)(b,dW)});return this.setPrivateKey(c.publicKey,c.privateKey)}),fM(this,"signJWT",async a=>{this.isInitialized();let b=await this.getClientSeed(),c=ad.generateKeyPair(b),d=this.randomSessionIdentifier;return await ad.signJWT(d,a,eB,c)}),fM(this,"generateSharedKey",(a,b,c)=>{var d,e,f;let g,h;this.isInitialized();let i=(d=this.getPrivateKey(a),g=dA.getSharedSecret((0,an.fromString)(d,dW),(0,an.fromString)(b,dW)),e=void 0,h=function(a,b,c,d=32){a3(a),a1(d);let e=a.outputLen;if(d>255*e)throw Error("Length should be <= 255*HashLen");let f=Math.ceil(d/e);void 0===c&&(c=cz);let g=new Uint8Array(f*e),h=cx.create(a,b),i=h._cloneInto(),j=new Uint8Array(h.outputLen);for(let a=0;a<f;a++)cy[0]=a+1,i.update(0===a?cz:j).update(c).update(cy).digestInto(j),g.set(j,e*a),h._cloneInto(i);return h.destroy(),i.destroy(),a7(j,cy),g.slice(0,d)}(bU,(f=void 0,a3(bU),void 0===f&&(f=new Uint8Array(bU.outputLen)),cx(bU,bk(f),bk(g))),e,32),(0,am.toString)(h,dW));return this.setSymKey(i,c)}),fM(this,"setSymKey",async(a,b)=>{let c;this.isInitialized();let d=b||(c=bU((0,an.fromString)(a,dW)),(0,am.toString)(c,dW));return await this.keychain.set(d,a),d}),fM(this,"deleteKeyPair",async a=>{this.isInitialized(),await this.keychain.del(a)}),fM(this,"deleteSymKey",async a=>{this.isInitialized(),await this.keychain.del(a)}),fM(this,"encode",async(a,b,c)=>{this.isInitialized();let d=d6(c),e=(0,w.safeJsonStringify)(b);if(2===d.type){var f;let a,b,d;return f=c?.encoding,a=d0(2),b=bo(12),d=d4({type:a,sealed:(0,an.fromString)(e,dZ),iv:b}),f===dY?d2(d):d}if(d7(d)){let b=d.senderPublicKey,c=d.receiverPublicKey;a=await this.generateSharedKey(b,c)}let g=this.getSymKey(a),{type:h,senderPublicKey:i}=d;return function(a){let b=d0("u">typeof a.type?a.type:0);if(1===d1(b)&&typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");let c="u">typeof a.senderPublicKey?(0,an.fromString)(a.senderPublicKey,dW):void 0,d="u">typeof a.iv?(0,an.fromString)(a.iv,dW):bo(12),e=d4({type:b,sealed:cv((0,an.fromString)(a.symKey,dW),d).encrypt((0,an.fromString)(a.message,dZ)),iv:d,senderPublicKey:c});return a.encoding===dY?d2(e):e}({type:h,symKey:g,message:e,senderPublicKey:i,encoding:c?.encoding})}),fM(this,"decode",async(a,b,c)=>{let d;this.isInitialized();let e=d6({type:d1((d=d5({encoded:b,encoding:c?.encoding})).type),senderPublicKey:"u">typeof d.senderPublicKey?(0,am.toString)(d.senderPublicKey,dW):void 0,receiverPublicKey:c?.receiverPublicKey});if(2===e.type){let a=function(a,b){let{sealed:c}=d5({encoded:a,encoding:b});return(0,am.toString)(c,dZ)}(b,c?.encoding);return(0,w.safeJsonParse)(a)}if(d7(e)){let b=e.receiverPublicKey,c=e.senderPublicKey;a=await this.generateSharedKey(b,c)}try{let d=this.getSymKey(a),e=function(a){let b=(0,an.fromString)(a.symKey,dW),{sealed:c,iv:d}=d5({encoded:a.encoded,encoding:a.encoding}),e=cv(b,d).decrypt(c);if(null===e)throw Error("Failed to decrypt");return(0,am.toString)(e,dZ)}({symKey:d,encoded:b,encoding:c?.encoding});return(0,w.safeJsonParse)(e)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}}),fM(this,"getPayloadType",(a,b=dX)=>d1(d5({encoded:a,encoding:b}).type)),fM(this,"getPayloadSenderPublicKey",(a,b=dX)=>{let c=d5({encoded:a,encoding:b});return c.senderPublicKey?(0,am.toString)(c.senderPublicKey,dW):void 0}),this.core=a,this.logger=M(b,this.name),this.keychain=c||new fK(this.core,this.logger)}get context(){return L(this.logger)}async setPrivateKey(a,b){return await this.keychain.set(a,b),a}getPrivateKey(a){return this.keychain.get(a)}async getClientSeed(){let a="";try{a=this.keychain.get(eA)}catch{a=d$(),await this.keychain.set(eA,a)}return function(a,b="utf8"){let c=fH[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?fD(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}(a,"base16")}getSymKey(a){return this.keychain.get(a)}isInitialized(){if(!this.initialized){let{message:a}=em("NOT_INITIALIZED",this.name);throw Error(a)}}}var fO=Object.defineProperty,fP=Object.defineProperties,fQ=Object.getOwnPropertyDescriptors,fR=Object.getOwnPropertySymbols,fS=Object.prototype.hasOwnProperty,fT=Object.prototype.propertyIsEnumerable,fU=(a,b,c)=>b in a?fO(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,fV=(a,b,c)=>fU(a,"symbol"!=typeof b?b+"":b,c);class fW extends V{constructor(a,b){super(a,b),this.logger=a,this.core=b,fV(this,"messages",new Map),fV(this,"messagesWithoutClientAck",new Map),fV(this,"name","messages"),fV(this,"version","0.3"),fV(this,"initialized",!1),fV(this,"storagePrefix",ey),fV(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let a=await this.getRelayerMessages();"u">typeof a&&(this.messages=a);let b=await this.getRelayerMessagesWithoutClientAck();"u">typeof b&&(this.messagesWithoutClientAck=b),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}finally{this.initialized=!0}}}),fV(this,"set",async(a,b,c)=>{this.isInitialized();let d=d_(b),e=this.messages.get(a);if(typeof e>"u"&&(e={}),"u">typeof e[d])return d;if(e[d]=b,this.messages.set(a,e),c===eP){let c=this.messagesWithoutClientAck.get(a)||{};this.messagesWithoutClientAck.set(a,fP(((a,b)=>{for(var c in b||(b={}))fS.call(b,c)&&fU(a,c,b[c]);if(fR)for(var c of fR(b))fT.call(b,c)&&fU(a,c,b[c]);return a})({},c),fQ({[d]:b})))}return await this.persist(),d}),fV(this,"get",a=>{this.isInitialized();let b=this.messages.get(a);return typeof b>"u"&&(b={}),b}),fV(this,"getWithoutAck",a=>{this.isInitialized();let b={};for(let c of a){let a=this.messagesWithoutClientAck.get(c)||{};b[c]=Object.values(a)}return b}),fV(this,"has",(a,b)=>(this.isInitialized(),"u">typeof this.get(a)[d_(b)])),fV(this,"ack",async(a,b)=>{this.isInitialized();let c=this.messagesWithoutClientAck.get(a);if(typeof c>"u")return;let d=d_(b);delete c[d],0===Object.keys(c).length?this.messagesWithoutClientAck.delete(a):this.messagesWithoutClientAck.set(a,c),await this.persist()}),fV(this,"del",async a=>{this.isInitialized(),this.messages.delete(a),this.messagesWithoutClientAck.delete(a),await this.persist()}),this.logger=M(a,this.name),this.core=b}get context(){return L(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(a){await this.core.storage.setItem(this.storageKey,aA(a))}async setRelayerMessagesWithoutClientAck(a){await this.core.storage.setItem(this.storageKeyWithoutClientAck,aA(a))}async getRelayerMessages(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?aB(a):void 0}async getRelayerMessagesWithoutClientAck(){let a=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return"u">typeof a?aB(a):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:a}=em("NOT_INITIALIZED",this.name);throw Error(a)}}}var fX=Object.defineProperty,fY=Object.defineProperties,fZ=Object.getOwnPropertyDescriptors,f$=Object.getOwnPropertySymbols,f_=Object.prototype.hasOwnProperty,f0=Object.prototype.propertyIsEnumerable,f1=(a,b,c)=>b in a?fX(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,f2=(a,b)=>{for(var c in b||(b={}))f_.call(b,c)&&f1(a,c,b[c]);if(f$)for(var c of f$(b))f0.call(b,c)&&f1(a,c,b[c]);return a},f3=(a,b,c)=>f1(a,"symbol"!=typeof b?b+"":b,c);class f4 extends W{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,f3(this,"events",new s.EventEmitter),f3(this,"name","publisher"),f3(this,"queue",new Map),f3(this,"publishTimeout",(0,ac.toMiliseconds)(ac.ONE_MINUTE)),f3(this,"initialPublishTimeout",(0,ac.toMiliseconds)(15*ac.ONE_SECOND)),f3(this,"needsTransportRestart",!1),f3(this,"publish",async(a,b,c)=>{var d,e,f,g,h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:a,message:b,opts:c}});let i=c?.ttl||eC,j=c?.prompt||!1,k=c?.tag||0,l=c?.id||(0,eu.getBigIntRpcId)().toString(),m=d9(d8().protocol),n={id:l,method:c?.publishMethod||m.publish,params:f2({topic:a,message:b,ttl:i,prompt:j,tag:k,attestation:c?.attestation},c?.tvf)},o=`Failed to publish payload, please try again. id:${l} tag:${k}`;try{eo(null==(d=n.params)?void 0:d.prompt)&&(null==(e=n.params)||delete e.prompt),eo(null==(f=n.params)?void 0:f.tag)&&(null==(g=n.params)||delete g.tag);let h=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=n.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(eH,b),a())};this.relayer.events.on(eH,b);let d=aC(new Promise((a,b)=>{this.rpcPublish(n,c).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${k}`);try{await d,this.events.removeListener(eH,b)}catch(a){this.queue.set(l,{request:n,opts:c,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:a,message:b,opts:c}}),await aC(h,this.publishTimeout,o)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(h=c?.internal)&&h.throwOnFailedPublish)throw a}finally{this.queue.delete(l)}}),f3(this,"publishCustom",async a=>{var b,c,d,e,f;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:a});let{payload:g,opts:h={}}=a,{attestation:i,tvf:j,publishMethod:k,prompt:l,tag:m,ttl:n=ac.FIVE_MINUTES}=h,o=h.id||(0,eu.getBigIntRpcId)().toString(),p=d9(d8().protocol),q=k||p.publish,r={id:o,method:q,params:f2(fY(f2({},g),fZ({ttl:n,prompt:l,tag:m,attestation:i})),j)},s=`Failed to publish custom payload, please try again. id:${o} tag:${m}`;try{eo(null==(b=r.params)?void 0:b.prompt)&&(null==(c=r.params)||delete c.prompt),eo(null==(d=r.params)?void 0:d.tag)&&(null==(e=r.params)||delete e.tag);let a=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=r.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(eH,b),a())};this.relayer.events.on(eH,b);let c=aC(new Promise((a,b)=>{this.rpcPublish(r,h).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${q} id:${o} tag:${m}`);try{await c,this.events.removeListener(eH,b)}catch(a){this.queue.set(o,{request:r,opts:h,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:o,payload:g,opts:h}}),await aC(a,this.publishTimeout,s)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(f=h?.internal)&&f.throwOnFailedPublish)throw a}finally{this.queue.delete(o)}}),f3(this,"on",(a,b)=>{this.events.on(a,b)}),f3(this,"once",(a,b)=>{this.events.once(a,b)}),f3(this,"off",(a,b)=>{this.events.off(a,b)}),f3(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.relayer=a,this.logger=M(b,this.name),this.registerEventListeners()}get context(){return L(this.logger)}async rpcPublish(a,b){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:a});let c=await this.relayer.request(a);return this.relayer.events.emit(eH,f2(f2({},a),b)),this.logger.debug("Successfully Published Payload"),c}removeRequestFromQueue(a){this.queue.delete(a)}checkQueue(){this.queue.forEach(async(a,b)=>{var c;let d=a.attempt+1;this.queue.set(b,fY(f2({},a),fZ({attempt:d}))),this.logger.warn({},`Publisher: queue->publishing: ${a.request.id}, tag: ${null==(c=a.request.params)?void 0:c.tag}, attempt: ${d}`),await this.rpcPublish(a.request,a.opts),this.logger.warn({},`Publisher: queue->published: ${a.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(t.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(eG);return}this.checkQueue()}),this.relayer.on(eF,a=>{this.removeRequestFromQueue(a.id.toString())})}}var f5=Object.defineProperty,f6=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?f5(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class f7{constructor(){f6(this,"map",new Map),f6(this,"set",(a,b)=>{let c=this.get(a);this.exists(a,b)||this.map.set(a,[...c,b])}),f6(this,"get",a=>this.map.get(a)||[]),f6(this,"exists",(a,b)=>this.get(a).includes(b)),f6(this,"delete",(a,b)=>{if(typeof b>"u")return void this.map.delete(a);if(!this.map.has(a))return;let c=this.get(a);if(!this.exists(a,b))return;let d=c.filter(a=>a!==b);d.length?this.map.set(a,d):this.map.delete(a)}),f6(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var f8=Object.defineProperty,f9=Object.defineProperties,ga=Object.getOwnPropertyDescriptors,gb=Object.getOwnPropertySymbols,gc=Object.prototype.hasOwnProperty,gd=Object.prototype.propertyIsEnumerable,ge=(a,b,c)=>b in a?f8(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,gf=(a,b)=>{for(var c in b||(b={}))gc.call(b,c)&&ge(a,c,b[c]);if(gb)for(var c of gb(b))gd.call(b,c)&&ge(a,c,b[c]);return a},gg=(a,b,c)=>ge(a,"symbol"!=typeof b?b+"":b,c);class gh extends Z{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,gg(this,"subscriptions",new Map),gg(this,"topicMap",new f7),gg(this,"events",new s.EventEmitter),gg(this,"name","subscription"),gg(this,"version","0.3"),gg(this,"pending",new Map),gg(this,"cached",[]),gg(this,"initialized",!1),gg(this,"storagePrefix",ey),gg(this,"subscribeTimeout",(0,ac.toMiliseconds)(ac.ONE_MINUTE)),gg(this,"initialSubscribeTimeout",(0,ac.toMiliseconds)(15*ac.ONE_SECOND)),gg(this,"clientId"),gg(this,"batchSubscribeTopicsLimit",500),gg(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),gg(this,"subscribe",async(a,b)=>{var c;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}});try{let d=d8(b),e={topic:a,relay:d,transportType:b?.transportType};null!=(c=b?.internal)&&c.skipSubscribe||this.pending.set(a,e);let f=await this.rpcSubscribe(a,d,b);return"string"==typeof f&&(this.onSubscribe(f,e),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}})),f}catch(a){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(a),a}}),gg(this,"unsubscribe",async(a,b)=>{this.isInitialized(),"u">typeof b?.id?await this.unsubscribeById(a,b.id,b):await this.unsubscribeByTopic(a,b)}),gg(this,"isSubscribed",a=>new Promise(b=>{b(this.topicMap.topics.includes(a))})),gg(this,"isKnownTopic",a=>new Promise(b=>{b(this.topicMap.topics.includes(a)||this.pending.has(a)||this.cached.some(b=>b.topic===a))})),gg(this,"on",(a,b)=>{this.events.on(a,b)}),gg(this,"once",(a,b)=>{this.events.once(a,b)}),gg(this,"off",(a,b)=>{this.events.off(a,b)}),gg(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),gg(this,"start",async()=>{await this.onConnect()}),gg(this,"stop",async()=>{await this.onDisconnect()}),gg(this,"restart",async()=>{await this.restore(),await this.onRestart()}),gg(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;let a=[];this.pending.forEach(b=>{a.push(b)}),await this.batchSubscribe(a)}),gg(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(t.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(eR,async a=>{this.logger.info(`Emitting ${eR}`),this.logger.debug({type:"event",event:eR,data:a}),await this.persist()}),this.events.on(eS,async a=>{this.logger.info(`Emitting ${eS}`),this.logger.debug({type:"event",event:eS,data:a}),await this.persist()})}),this.relayer=a,this.logger=M(b,this.name),this.clientId=""}get context(){return L(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(a,b){let c=!1;try{c=this.getSubscription(a).topic===b}catch{}return c}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(a,b){let c=this.topicMap.get(a);await Promise.all(c.map(async c=>await this.unsubscribeById(a,c,b)))}async unsubscribeById(a,b,c){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}});try{let d=d8(c);await this.restartToComplete({topic:a,id:b,relay:d}),await this.rpcUnsubscribe(a,b,d);let e=en("USER_DISCONNECTED",`${this.name}, ${a}`);await this.onUnsubscribe(a,b,e),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(a,b,c){var d,e;let f=await this.getSubscriptionId(a);if(null!=(d=c?.internal)&&d.skipSubscribe)return f;c&&c?.transportType!==eO||await this.restartToComplete({topic:a,id:a,relay:b});let g={method:d9(b.protocol).subscribe,params:{topic:a}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:g});let h=null==(e=c?.internal)?void 0:e.throwOnFailedPublish;try{if(c?.transportType===eN)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(g).catch(a=>this.logger.warn(a))},(0,ac.toMiliseconds)(ac.ONE_SECOND)),f;let b=new Promise(async b=>{let c=d=>{d.topic===a&&(this.events.removeListener(eR,c),b(d.id))};this.events.on(eR,c);try{let d=await aC(new Promise((a,b)=>{this.relayer.request(g).catch(a=>{this.logger.warn(a,a?.message),b(a)}).then(a)}),this.initialSubscribeTimeout,`Subscribing to ${a} failed, please try again`);this.events.removeListener(eR,c),b(d)}catch{}}),d=await aC(b,this.subscribeTimeout,`Subscribing to ${a} failed, please try again`);if(!d&&h)throw Error(`Subscribing to ${a} failed, please try again`);return d?f:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(eG),h)throw a}return null}async rpcBatchSubscribe(a){if(!a.length)return;let b={method:d9(a[0].relay.protocol).batchSubscribe,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:b});try{await await aC(new Promise(a=>{this.relayer.request(b).catch(a=>this.logger.warn(a)).then(a)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(eG)}}async rpcBatchFetchMessages(a){let b;if(!a.length)return;let c={method:d9(a[0].relay.protocol).batchFetchMessages,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:c});try{b=await await aC(new Promise((a,b)=>{this.relayer.request(c).catch(a=>{this.logger.warn(a),b(a)}).then(a)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(eG)}return b}rpcUnsubscribe(a,b,c){let d={method:d9(c.protocol).unsubscribe,params:{topic:a,id:b}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:d}),this.relayer.request(d)}onSubscribe(a,b){this.setSubscription(a,f9(gf({},b),ga({id:a}))),this.pending.delete(b.topic)}onBatchSubscribe(a){a.length&&a.forEach(a=>{this.setSubscription(a.id,gf({},a)),this.pending.delete(a.topic)})}async onUnsubscribe(a,b,c){this.events.removeAllListeners(b),this.hasSubscription(b,a)&&this.deleteSubscription(b,c),await this.relayer.messages.del(a)}async setRelayerSubscriptions(a){await this.relayer.core.storage.setItem(this.storageKey,a)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(a,b){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:a,subscription:b}),this.addSubscription(a,b)}addSubscription(a,b){this.subscriptions.set(a,gf({},b)),this.topicMap.set(b.topic,a),this.events.emit(eR,b)}getSubscription(a){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:a});let b=this.subscriptions.get(a);if(!b){let{message:b}=em("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}deleteSubscription(a,b){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:a,reason:b});let c=this.getSubscription(a);this.subscriptions.delete(a),this.topicMap.delete(c.topic,a),this.events.emit(eS,f9(gf({},c),ga({reason:b})))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit("subscription_sync")}async onRestart(){if(this.cached.length){let a=[...this.cached],b=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let c=0;c<b;c++){let b=a.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(b)}}this.events.emit("subscription_resubscribed")}async restore(){try{let a=await this.getRelayerSubscriptions();if(typeof a>"u"||!a.length)return;if(this.subscriptions.size&&!a.every(a=>{var b;return a.topic===(null==(b=this.subscriptions.get(a.id))?void 0:b.topic)})){let{message:a}=em("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(a){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(a)}}async batchSubscribe(a){a.length&&(await this.rpcBatchSubscribe(a),this.onBatchSubscribe(await Promise.all(a.map(async a=>f9(gf({},a),ga({id:await this.getSubscriptionId(a.topic)}))))))}async batchFetchMessages(a){var b;if(!a.length)return;this.logger.trace(`Fetching batch messages for ${a.length} subscriptions`);let c=await this.rpcBatchFetchMessages(a);c&&c.messages&&(await (b=(0,ac.toMiliseconds)(ac.ONE_SECOND),new Promise(a=>setTimeout(a,b))),await this.relayer.handleBatchMessageEvents(c.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:a}=em("NOT_INITIALIZED",this.name);throw Error(a)}}async restartToComplete(a){this.relayer.connected||this.relayer.connecting||(this.cached.push(a),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(a){return d_(a+await this.getClientId())}}var gi=Object.defineProperty,gj=Object.getOwnPropertySymbols,gk=Object.prototype.hasOwnProperty,gl=Object.prototype.propertyIsEnumerable,gm=(a,b,c)=>b in a?gi(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,gn=(a,b)=>{for(var c in b||(b={}))gk.call(b,c)&&gm(a,c,b[c]);if(gj)for(var c of gj(b))gl.call(b,c)&&gm(a,c,b[c]);return a},go=(a,b,c)=>gm(a,"symbol"!=typeof b?b+"":b,c);class gp extends X{constructor(b){super(b),go(this,"protocol","wc"),go(this,"version",2),go(this,"core"),go(this,"logger"),go(this,"events",new s.EventEmitter),go(this,"provider"),go(this,"messages"),go(this,"subscriber"),go(this,"publisher"),go(this,"name","relayer"),go(this,"transportExplicitlyClosed",!1),go(this,"initialized",!1),go(this,"connectionAttemptInProgress",!1),go(this,"relayUrl"),go(this,"projectId"),go(this,"packageName"),go(this,"bundleId"),go(this,"hasExperiencedNetworkDisruption",!1),go(this,"pingTimeout"),go(this,"heartBeatTimeout",(0,ac.toMiliseconds)(ac.THIRTY_SECONDS+ac.FIVE_SECONDS)),go(this,"reconnectTimeout"),go(this,"connectPromise"),go(this,"reconnectInProgress",!1),go(this,"requestsInFlight",[]),go(this,"connectTimeout",(0,ac.toMiliseconds)(15*ac.ONE_SECOND)),go(this,"request",async a=>{var b,c;this.logger.debug("Publishing Request Payload");let d=a.id||(0,eu.getBigIntRpcId)().toString();await this.toEstablishConnection();try{this.logger.trace({id:d,method:a.method,topic:null==(b=a.params)?void 0:b.topic},"relayer.request - publishing...");let e=`${d}:${(null==(c=a.params)?void 0:c.tag)||""}`;this.requestsInFlight.push(e);let f=await this.provider.request(a);return this.requestsInFlight=this.requestsInFlight.filter(a=>a!==e),f}catch(a){throw this.logger.debug(`Failed to Publish Request: ${d}`),a}}),go(this,"resetPingTimeout",()=>{au()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var a,b,c,d;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(d=null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.terminate)||d.call(c)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),go(this,"onPayloadHandler",a=>{this.onProviderPayload(a),this.resetPingTimeout()}),go(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit("relayer_connect")}),go(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),go(this,"onProviderErrorHandler",a=>{this.logger.fatal(`Fatal socket error: ${a.message}`),this.events.emit("relayer_error",a),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),go(this,"registerProviderListeners",()=>{this.provider.on(eI,this.onPayloadHandler),this.provider.on(eJ,this.onConnectHandler),this.provider.on(eK,this.onDisconnectHandler),this.provider.on(eL,this.onProviderErrorHandler)}),this.core=b.core,this.logger="u">typeof b.logger&&"string"!=typeof b.logger?M(b.logger,this.name):(0,O.default)(K({level:b.logger||"error"})),this.messages=new fW(this.logger,b.core),this.subscriber=new gh(this,this.logger),this.publisher=new f4(this,this.logger),this.projectId=b?.projectId,this.relayUrl=b?.relayUrl||eD,av()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="android"?this.packageName=ay():av()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="ios"&&(this.bundleId=ay()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(a=>this.logger.warn(a,a?.message))}get context(){return L(this.logger)}get connected(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===1}get connecting(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===0||void 0!==this.connectPromise}async publish(a,b,c){this.isInitialized(),await this.publisher.publish(a,b,c),await this.recordMessageEvent({topic:a,message:b,publishedAt:Date.now(),transportType:eO},"outbound")}async publishCustom(a){this.isInitialized(),await this.publisher.publishCustom(a)}async subscribe(a,b){var c,d,e;this.isInitialized(),null!=b&&b.transportType&&b?.transportType!=="relay"||await this.toEstablishConnection();let f=typeof(null==(c=b?.internal)?void 0:c.throwOnFailedPublish)>"u"||(null==(d=b?.internal)?void 0:d.throwOnFailedPublish),g=(null==(e=this.subscriber.topicMap.get(a))?void 0:e[0])||"",h,i=b=>{b.topic===a&&(this.subscriber.off(eR,i),h())};return await Promise.all([new Promise(a=>{h=a,this.subscriber.on(eR,i)}),new Promise(async(c,d)=>{g=await this.subscriber.subscribe(a,gn({internal:{throwOnFailedPublish:f}},b)).catch(a=>{f&&d(a)})||g,c()})]),g}async unsubscribe(a,b){this.isInitialized(),await this.subscriber.unsubscribe(a,b)}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await aC(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(a){if(!this.subscriber.hasAnyTopics)return void this.logger.info("Starting WS connection skipped because the client has no topics to work with.");if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(b,c)=>{await this.connect(a).then(b).catch(c).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(a){this.logger.debug({},"Restarting transport..."),this.connectionAttemptInProgress||(this.relayUrl=a||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await er())throw Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(a){if(a?.length===0)return void this.logger.trace("Batch message events is empty. Ignoring...");let b=a.sort((a,b)=>a.publishedAt-b.publishedAt);for(let a of(this.logger.debug(`Batch of ${b.length} message events sorted`),b))try{await this.onMessageEvent(a)}catch(a){this.logger.warn(a,"Error while processing batch message event: "+a?.message)}this.logger.trace(`Batch of ${b.length} message events processed`)}async onLinkMessageEvent(a,b){let{topic:c}=a;if(!b.sessionExists){let a=aE(ac.FIVE_MINUTES);await this.core.pairing.pairings.set(c,{topic:c,expiry:a,relay:{protocol:"irn"},active:!1})}this.events.emit(eE,a),await this.recordMessageEvent(a,eP)}async connect(a){await this.confirmOnlineStateOrThrow(),a&&a!==this.relayUrl&&(this.relayUrl=a,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let b=1;for(;b<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${b}...`),await this.createProvider(),await new Promise(async(a,b)=>{let c=()=>{b(Error("Connection interrupted while trying to connect"))};this.provider.once(eK,c),await aC(new Promise((a,b)=>{this.provider.connect().then(a).catch(b)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>{b(a)}).finally(()=>{this.provider.off(eK,c),clearTimeout(this.reconnectTimeout)}),await new Promise(async(a,c)=>{let d=()=>{b(Error("Connection interrupted while trying to subscribe"))};this.provider.once(eK,d),await this.subscriber.start().then(a).catch(c).finally(()=>{this.provider.off(eK,d)})}),this.hasExperiencedNetworkDisruption=!1,a()})}catch(a){await this.subscriber.stop(),this.logger.warn({},a.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${b}`);break}await new Promise(a=>setTimeout(a,(0,ac.toMiliseconds)(+b))),b++}}startPingTimeout(){var a,b,c,d,e;if(au())try{null!=(b=null==(a=this.provider)?void 0:a.connection)&&b.socket&&(null==(e=null==(d=null==(c=this.provider)?void 0:c.connection)?void 0:d.socket)||e.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let a=await this.core.crypto.signJWT(this.relayUrl);this.provider=new et.JsonRpcProvider(new ew.default(function({protocol:a,version:b,relayUrl:c,sdkVersion:d,auth:e,projectId:f,useOnCloseEvent:g,bundleId:h,packageName:i}){var j,k;let l,m=c.split("?"),n=az(a,b,d),o=(j=m[1]||"",k={auth:e,ua:n,projectId:f,useOnCloseEvent:g||void 0,packageName:i||void 0,bundleId:h||void 0},l=new URLSearchParams(j),Object.entries(k).sort(([a],[b])=>a.localeCompare(b)).forEach(([a,b])=>{null!=b&&l.set(a,String(b))}),l.toString());return m[0]+"?"+o}({sdkVersion:eM,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:a,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(a,b){let{topic:c,message:d}=a;await this.messages.set(c,d,b)}async shouldIgnoreMessageEvent(a){let{topic:b,message:c}=a;if(!c||0===c.length)return this.logger.warn(`Ignoring invalid/empty message: ${c}`),!0;if(!await this.subscriber.isKnownTopic(b))return this.logger.warn(`Ignoring message for unknown topic ${b}`),!0;let d=this.messages.has(b,c);return d&&this.logger.warn(`Ignoring duplicate message: ${c}`),d}async onProviderPayload(a){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:a}),(0,ev.isJsonRpcRequest)(a)){if(!a.method.endsWith("_subscription"))return;let b=a.params,{topic:c,message:d,publishedAt:e,attestation:f}=b.data,g={topic:c,message:d,publishedAt:e,transportType:eO,attestation:f};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(gn({type:"event",event:b.id},g)),this.events.emit(b.id,g),await this.acknowledgePayload(a),await this.onMessageEvent(g)}else(0,ev.isJsonRpcResponse)(a)&&this.events.emit(eF,a)}async onMessageEvent(a){await this.shouldIgnoreMessageEvent(a)||(await this.recordMessageEvent(a,eP),this.events.emit(eE,a))}async acknowledgePayload(a){let b=(0,eu.formatJsonRpcResult)(a.id,!0);await this.provider.connection.send(b)}unregisterProviderListeners(){this.provider.off(eI,this.onPayloadHandler),this.provider.off(eJ,this.onConnectHandler),this.provider.off(eK,this.onDisconnectHandler),this.provider.off(eL,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let b=await er();(function(b){var c,d;switch(ax()){case at:c=b,!av()&&aw()&&(window.addEventListener("online",()=>c(!0)),window.addEventListener("offline",()=>c(!1)));break;case ar:d=b,av()&&null!=a.g&&a.g.NetInfo&&a.g?.NetInfo.addEventListener(a=>d(a?.isConnected))}})(async a=>{b!==a&&(b=a,a?await this.transportOpen().catch(a=>this.logger.error(a,a?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(t.HEARTBEAT_EVENTS.pulse,async()=>{var a;if(!this.transportExplicitlyClosed&&!this.connected&&(!(aw()&&(0,af.getDocument)())||(null==(a=(0,af.getDocument)())?void 0:a.visibilityState)==="visible"))try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(a){this.logger.warn(a,a?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit("relayer_disconnect"),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(a=>this.logger.error(a,a?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,ac.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:a}=em("NOT_INITIALIZED",this.name);throw Error(a)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function gq(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function gr(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let gs="[object Arguments]",gt="[object Object]";function gu(){}function gv(a){if(!a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&"[object Object]"===Object.prototype.toString.call(a)}var gw=Object.defineProperty,gx=Object.getOwnPropertySymbols,gy=Object.prototype.hasOwnProperty,gz=Object.prototype.propertyIsEnumerable,gA=(a,b,c)=>b in a?gw(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,gB=(a,b)=>{for(var c in b||(b={}))gy.call(b,c)&&gA(a,c,b[c]);if(gx)for(var c of gx(b))gz.call(b,c)&&gA(a,c,b[c]);return a},gC=(a,b,c)=>gA(a,"symbol"!=typeof b?b+"":b,c);class gD extends Y{constructor(a,b,c,d=ey,e){super(a,b,c,d),this.core=a,this.logger=b,this.name=c,gC(this,"map",new Map),gC(this,"version","0.3"),gC(this,"cached",[]),gC(this,"initialized",!1),gC(this,"getKey"),gC(this,"storagePrefix",ey),gC(this,"recentlyDeleted",[]),gC(this,"recentlyDeletedLimit",200),gC(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{var b;this.getKey&&null!==a&&!eo(a)?this.map.set(this.getKey(a),a):(null==(b=a?.proposer)?void 0:b.publicKey)?this.map.set(a.id,a):a?.topic&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)}),gC(this,"set",async(a,b)=>{this.isInitialized(),this.map.has(a)?await this.update(a,b):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:b}),this.map.set(a,b),await this.persist())}),gC(this,"get",a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a))),gC(this,"getAll",a=>(this.isInitialized(),a?this.values.filter(b=>Object.keys(a).every(c=>{var d;return d=b[c],function a(b,c,d,e,f,g,h){let i=h(b,c,d,e,f,g);if(void 0!==i)return i;if(typeof b==typeof c)switch(typeof b){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return b===c;case"number":return b===c||Object.is(b,c)}return function b(c,d,e,f){if(Object.is(c,d))return!0;let g=gr(c),h=gr(d);if(g===gs&&(g=gt),h===gs&&(h=gt),g!==h)return!1;switch(g){case"[object String]":return c.toString()===d.toString();case"[object Number]":{let a=c.valueOf(),b=d.valueOf();return a===b||Number.isNaN(a)&&Number.isNaN(b)}case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(c.valueOf(),d.valueOf());case"[object RegExp]":return c.source===d.source&&c.flags===d.flags;case"[object Function]":return c===d}let i=(e=e??new Map).get(c),j=e.get(d);if(null!=i&&null!=j)return i===d;e.set(c,d),e.set(d,c);try{switch(g){case"[object Map]":if(c.size!==d.size)return!1;for(let[b,g]of c.entries())if(!d.has(b)||!a(g,d.get(b),b,c,d,e,f))return!1;return!0;case"[object Set]":{if(c.size!==d.size)return!1;let b=Array.from(c.values()),g=Array.from(d.values());for(let h=0;h<b.length;h++){let i=b[h],j=g.findIndex(b=>a(i,b,void 0,c,d,e,f));if(-1===j)return!1;g.splice(j,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if("u">typeof Buffer&&Buffer.isBuffer(c)!==Buffer.isBuffer(d)||c.length!==d.length)return!1;for(let b=0;b<c.length;b++)if(!a(c[b],d[b],b,c,d,e,f))return!1;return!0;case"[object ArrayBuffer]":return c.byteLength===d.byteLength&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object DataView]":return c.byteLength===d.byteLength&&c.byteOffset===d.byteOffset&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object Error]":return c.name===d.name&&c.message===d.message;case gt:{if(!(b(c.constructor,d.constructor,e,f)||gv(c)&&gv(d)))return!1;let g=[...Object.keys(c),...gq(c)],h=[...Object.keys(d),...gq(d)];if(g.length!==h.length)return!1;for(let b=0;b<g.length;b++){let h=g[b],i=c[h];if(!Object.hasOwn(d,h))return!1;let j=d[h];if(!a(i,j,h,c,d,e,f))return!1}return!0}default:return!1}}finally{e.delete(c),e.delete(d)}}(b,c,g,h)}(d,a[c],void 0,void 0,void 0,void 0,gu)})):this.values)),gC(this,"update",async(a,b)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:b});let c=gB(gB({},this.getData(a)),b);this.map.set(a,c),await this.persist()}),gC(this,"delete",async(a,b)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:b}),this.map.delete(a),this.addToRecentlyDeleted(a),await this.persist())}),this.logger=M(b,this.name),this.storagePrefix=d,this.getKey=e}get context(){return L(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(a){this.recentlyDeleted.push(a),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(a){await this.core.storage.setItem(this.storageKey,a)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(a){let b=this.map.get(a);if(!b){if(this.recentlyDeleted.includes(a)){let{message:b}=em("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${a}`);throw this.logger.error(b),Error(b)}let{message:b}=em("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.error(b),Error(b)}return b}async persist(){await this.setDataStore(this.values)}async restore(){try{let a=await this.getDataStore();if(typeof a>"u"||!a.length)return;if(this.map.size){let{message:a}=em("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(a){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(a)}}isInitialized(){if(!this.initialized){let{message:a}=em("NOT_INITIALIZED",this.name);throw Error(a)}}}var gE=Object.defineProperty,gF=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?gE(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class gG{constructor(a,b){this.core=a,this.logger=b,gF(this,"name","pairing"),gF(this,"version","0.3"),gF(this,"events",new s.default),gF(this,"pairings"),gF(this,"initialized",!1),gF(this,"storagePrefix",ey),gF(this,"ignoredPayloadTypes",[1]),gF(this,"registeredMethods",[]),gF(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),gF(this,"register",({methods:a})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...a])]}),gF(this,"create",async a=>{this.isInitialized();let b=d$(),c=await this.core.crypto.setSymKey(b),d=aE(ac.FIVE_MINUTES),e={protocol:"irn"},f={topic:c,expiry:d,relay:e,active:!1,methods:a?.methods},g=ej({protocol:this.core.protocol,version:this.core.version,topic:c,symKey:b,relay:e,expiryTimestamp:d,methods:a?.methods});return this.events.emit(eU,f),this.core.expirer.set(c,d),await this.pairings.set(c,f),await this.core.relayer.subscribe(c,{transportType:a?.transportType,internal:a?.internal}),{topic:c,uri:g}}),gF(this,"pair",async a=>{let b;this.isInitialized();let c=this.core.eventClient.createEvent({properties:{topic:a?.uri,trace:["pairing_started"]}});this.isValidPair(a,c);let{topic:d,symKey:e,relay:f,expiryTimestamp:g,methods:h}=ei(a.uri);if(c.props.properties.topic=d,c.addTrace("pairing_uri_validation_success"),c.addTrace("pairing_uri_not_expired"),this.pairings.keys.includes(d)){if(b=this.pairings.get(d),c.addTrace("existing_pairing"),b.active)throw c.setError("active_pairing_already_exists"),Error(`Pairing already exists: ${d}. Please try again with a new connection URI.`);c.addTrace("pairing_not_expired")}let i=g||aE(ac.FIVE_MINUTES),j={topic:d,relay:f,expiry:i,active:!1,methods:h};this.core.expirer.set(d,i),await this.pairings.set(d,j),c.addTrace("store_new_pairing"),a.activatePairing&&await this.activate({topic:d}),this.events.emit(eU,j),c.addTrace("emit_inactive_pairing"),this.core.crypto.keychain.has(d)||await this.core.crypto.setSymKey(e,d),c.addTrace("subscribing_pairing_topic");try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{c.setError("no_internet_connection")}try{await this.core.relayer.subscribe(d,{relay:f})}catch(a){throw c.setError("subscribe_pairing_topic_failure"),a}return c.addTrace("subscribe_pairing_topic_success"),j}),gF(this,"activate",async({topic:a})=>{this.isInitialized();let b=aE(ac.FIVE_MINUTES);this.core.expirer.set(a,b),await this.pairings.update(a,{active:!0,expiry:b})}),gF(this,"ping",async a=>{this.isInitialized(),await this.isValidPing(a),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:b}=a;if(this.pairings.keys.includes(b)){let a=await this.sendRequest(b,"wc_pairingPing",{}),{done:c,resolve:d,reject:e}=function(a=ac.FIVE_MINUTES,b){let c,d,e,f,g=(0,ac.toMiliseconds)(a||ac.FIVE_MINUTES);return{resolve:a=>{e&&c&&(clearTimeout(e),c(a),f=Promise.resolve(a))},reject:a=>{e&&d&&(clearTimeout(e),d(a))},done:()=>new Promise((a,b)=>{if(f)return a(f);e=setTimeout(()=>{let a=Error(void 0);f=Promise.reject(a),b(a)},g),c=a,d=b})}}();this.events.once(aG("pairing_ping",a),({error:a})=>{a?e(a):d()}),await c()}}),gF(this,"updateExpiry",async({topic:a,expiry:b})=>{this.isInitialized(),await this.pairings.update(a,{expiry:b})}),gF(this,"updateMetadata",async({topic:a,metadata:b})=>{this.isInitialized(),await this.pairings.update(a,{peerMetadata:b})}),gF(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),gF(this,"disconnect",async a=>{this.isInitialized(),await this.isValidDisconnect(a);let{topic:b}=a;this.pairings.keys.includes(b)&&(await this.sendRequest(b,"wc_pairingDelete",en("USER_DISCONNECTED")),await this.deletePairing(b))}),gF(this,"formatUriFromPairing",a=>{this.isInitialized();let{topic:b,relay:c,expiry:d,methods:e}=a,f=this.core.crypto.keychain.get(b);return ej({protocol:this.core.protocol,version:this.core.version,topic:b,symKey:f,relay:c,expiryTimestamp:d,methods:e})}),gF(this,"sendRequest",async(a,b,c)=>{let d=(0,eu.formatJsonRpcRequest)(b,c),e=await this.core.crypto.encode(a,d),f=eT[b].req;return this.core.history.set(a,d),this.core.relayer.publish(a,e,f),d.id}),gF(this,"sendResult",async(a,b,c)=>{let d=(0,eu.formatJsonRpcResult)(a,c),e=await this.core.crypto.encode(b,d),f=eT[(await this.core.history.get(b,a)).request.method].res;await this.core.relayer.publish(b,e,f),await this.core.history.resolve(d)}),gF(this,"sendError",async(a,b,c)=>{let d=(0,eu.formatJsonRpcError)(a,c),e=await this.core.crypto.encode(b,d),f=(await this.core.history.get(b,a)).request.method,g=eT[f]?eT[f].res:eT.unregistered_method.res;await this.core.relayer.publish(b,e,g),await this.core.history.resolve(d)}),gF(this,"deletePairing",async(a,b)=>{await this.core.relayer.unsubscribe(a),await Promise.all([this.pairings.delete(a,en("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(a),b?Promise.resolve():this.core.expirer.del(a)])}),gF(this,"cleanup",async()=>{let a=this.pairings.getAll().filter(a=>aF(a.expiry));await Promise.all(a.map(a=>this.deletePairing(a.topic)))}),gF(this,"onRelayEventRequest",async a=>{let{topic:b,payload:c}=a;switch(c.method){case"wc_pairingPing":return await this.onPairingPingRequest(b,c);case"wc_pairingDelete":return await this.onPairingDeleteRequest(b,c);default:return await this.onUnknownRpcMethodRequest(b,c)}}),gF(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c}=a,d=(await this.core.history.get(b,c.id)).request.method;return"wc_pairingPing"===d?this.onPairingPingResponse(b,c):this.onUnknownRpcMethodResponse(d)}),gF(this,"onPairingPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult(c,a,!0),this.events.emit("pairing_ping",{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),gF(this,"onPairingPingResponse",(a,b)=>{let{id:c}=b;setTimeout(()=>{(0,ev.isJsonRpcResult)(b)?this.events.emit(aG("pairing_ping",c),{}):(0,ev.isJsonRpcError)(b)&&this.events.emit(aG("pairing_ping",c),{error:b.error})},500)}),gF(this,"onPairingDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a}),await this.deletePairing(a),this.events.emit(eV,{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),gF(this,"onUnknownRpcMethodRequest",async(a,b)=>{let{id:c,method:d}=b;try{if(this.registeredMethods.includes(d))return;let b=en("WC_METHOD_UNSUPPORTED",d);await this.sendError(c,a,b),this.logger.error(b)}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),gF(this,"onUnknownRpcMethodResponse",a=>{this.registeredMethods.includes(a)||this.logger.error(en("WC_METHOD_UNSUPPORTED",a))}),gF(this,"isValidPair",(a,b)=>{var c;if(!eq(a)){let{message:c}=em("MISSING_OR_INVALID",`pair() params: ${a}`);throw b.setError(e3),Error(c)}if(!function(a){function b(a){try{return"u">typeof new URL(a)}catch{return!1}}try{if(ep(a,!1)){if(b(a))return!0;let c=aJ(a);return b(c)}}catch{}return!1}(a.uri)){let{message:c}=em("MISSING_OR_INVALID",`pair() uri: ${a.uri}`);throw b.setError(e3),Error(c)}let d=ei(a?.uri);if(!(null!=(c=d?.relay)&&c.protocol)){let{message:a}=em("MISSING_OR_INVALID","pair() uri#relay-protocol");throw b.setError(e3),Error(a)}if(!(null!=d&&d.symKey)){let{message:a}=em("MISSING_OR_INVALID","pair() uri#symKey");throw b.setError(e3),Error(a)}if(null!=d&&d.expiryTimestamp&&(0,ac.toMiliseconds)(d?.expiryTimestamp)<Date.now()){b.setError("pairing_expired");let{message:a}=em("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw Error(a)}}),gF(this,"isValidPing",async a=>{if(!eq(a)){let{message:b}=em("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),gF(this,"isValidDisconnect",async a=>{if(!eq(a)){let{message:b}=em("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),gF(this,"isValidPairingTopic",async a=>{if(!ep(a,!1)){let{message:b}=em("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.pairings.keys.includes(a)){let{message:b}=em("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(aF(this.pairings.get(a).expiry)){await this.deletePairing(a);let{message:b}=em("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}),this.core=a,this.logger=M(b,this.name),this.pairings=new gD(this.core,this.logger,this.name,this.storagePrefix)}get context(){return L(this.logger)}isInitialized(){if(!this.initialized){let{message:a}=em("NOT_INITIALIZED",this.name);throw Error(a)}}registerRelayerEvents(){this.core.relayer.on(eE,async a=>{let{topic:b,message:c,transportType:d}=a;if(this.pairings.keys.includes(b)&&d!==eN&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(c)))try{let a=await this.core.crypto.decode(b,c);(0,ev.isJsonRpcRequest)(a)?(this.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a})):(0,ev.isJsonRpcResponse)(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a}),this.core.history.delete(b,a.id)),await this.core.relayer.messages.ack(b,c)}catch(a){this.logger.error(a)}})}registerExpirerEvents(){this.core.expirer.on(e_,async a=>{let{topic:b}=function(a){let[b,c]=a.split(":"),d={id:void 0,topic:void 0};if("topic"===b&&"string"==typeof c)d.topic=c;else if("id"===b&&Number.isInteger(Number(c)))d.id=Number(c);else throw Error(`Invalid target, expected id:number or topic:string, got ${b}:${c}`);return d}(a.target);b&&this.pairings.keys.includes(b)&&(await this.deletePairing(b,!0),this.events.emit("pairing_expire",{topic:b}))})}}var gH=Object.defineProperty,gI=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?gH(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class gJ extends U{constructor(a,b){super(a,b),this.core=a,this.logger=b,gI(this,"records",new Map),gI(this,"events",new s.EventEmitter),gI(this,"name","history"),gI(this,"version","0.3"),gI(this,"cached",[]),gI(this,"initialized",!1),gI(this,"storagePrefix",ey),gI(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.records.set(a.id,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),gI(this,"set",(a,b,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:a,request:b,chainId:c}),this.records.has(b.id))return;let d={id:b.id,topic:a,request:{method:b.method,params:b.params||null},chainId:c,expiry:aE(ac.THIRTY_DAYS)};this.records.set(d.id,d),this.persist(),this.events.emit(eW,d)}),gI(this,"resolve",async a=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:a}),!this.records.has(a.id))return;let b=await this.getRecord(a.id);typeof b.response>"u"&&(b.response=(0,ev.isJsonRpcError)(a)?{error:a.error}:{result:a.result},this.records.set(b.id,b),this.persist(),this.events.emit(eX,b))}),gI(this,"get",async(a,b)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:a,id:b}),await this.getRecord(b))),gI(this,"delete",(a,b)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:b}),this.values.forEach(c=>{c.topic===a&&("u">typeof b&&c.id!==b||(this.records.delete(c.id),this.events.emit(eY,c)))}),this.persist()}),gI(this,"exists",async(a,b)=>(this.isInitialized(),!!this.records.has(b)&&(await this.getRecord(b)).topic===a)),gI(this,"on",(a,b)=>{this.events.on(a,b)}),gI(this,"once",(a,b)=>{this.events.once(a,b)}),gI(this,"off",(a,b)=>{this.events.off(a,b)}),gI(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=M(b,this.name)}get context(){return L(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let a=[];return this.values.forEach(b=>{if("u">typeof b.response)return;let c={topic:b.topic,request:(0,eu.formatJsonRpcRequest)(b.request.method,b.request.params,b.id),chainId:b.chainId};return a.push(c)}),a}async setJsonRpcRecords(a){await this.core.storage.setItem(this.storageKey,a)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(a){this.isInitialized();let b=this.records.get(a);if(!b){let{message:b}=em("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit("history_sync")}async restore(){try{let a=await this.getJsonRpcRecords();if(typeof a>"u"||!a.length)return;if(this.records.size){let{message:a}=em("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}}registerEventListeners(){this.events.on(eW,a=>{this.logger.info(`Emitting ${eW}`),this.logger.debug({type:"event",event:eW,record:a})}),this.events.on(eX,a=>{this.logger.info(`Emitting ${eX}`),this.logger.debug({type:"event",event:eX,record:a})}),this.events.on(eY,a=>{this.logger.info(`Emitting ${eY}`),this.logger.debug({type:"event",event:eY,record:a})}),this.core.heartbeat.on(t.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let a=!1;this.records.forEach(b=>{(0,ac.toMiliseconds)(b.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${b.id}`),this.records.delete(b.id),this.events.emit(eY,b,!1),a=!0)}),a&&this.persist()}catch(a){this.logger.warn(a)}}isInitialized(){if(!this.initialized){let{message:a}=em("NOT_INITIALIZED",this.name);throw Error(a)}}}var gK=Object.defineProperty,gL=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?gK(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class gM extends ${constructor(a,b){super(a,b),this.core=a,this.logger=b,gL(this,"expirations",new Map),gL(this,"events",new s.EventEmitter),gL(this,"name","expirer"),gL(this,"version","0.3"),gL(this,"cached",[]),gL(this,"initialized",!1),gL(this,"storagePrefix",ey),gL(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.expirations.set(a.target,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),gL(this,"has",a=>{try{let b=this.formatTarget(a);return"u">typeof this.getExpiration(b)}catch{return!1}}),gL(this,"set",(a,b)=>{this.isInitialized();let c=this.formatTarget(a),d={target:c,expiry:b};this.expirations.set(c,d),this.checkExpiry(c,d),this.events.emit(eZ,{target:c,expiration:d})}),gL(this,"get",a=>{this.isInitialized();let b=this.formatTarget(a);return this.getExpiration(b)}),gL(this,"del",a=>{if(this.isInitialized(),this.has(a)){let b=this.formatTarget(a),c=this.getExpiration(b);this.expirations.delete(b),this.events.emit(e$,{target:b,expiration:c})}}),gL(this,"on",(a,b)=>{this.events.on(a,b)}),gL(this,"once",(a,b)=>{this.events.once(a,b)}),gL(this,"off",(a,b)=>{this.events.off(a,b)}),gL(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=M(b,this.name)}get context(){return L(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(a){if("string"==typeof a)return aD("topic",a);if("number"==typeof a)return aD("id",a);let{message:b}=em("UNKNOWN_TYPE",`Target type: ${typeof a}`);throw Error(b)}async setExpirations(a){await this.core.storage.setItem(this.storageKey,a)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit("expirer_sync")}async restore(){try{let a=await this.getExpirations();if(typeof a>"u"||!a.length)return;if(this.expirations.size){let{message:a}=em("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(a){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(a)}}getExpiration(a){let b=this.expirations.get(a);if(!b){let{message:b}=em("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.warn(b),Error(b)}return b}checkExpiry(a,b){let{expiry:c}=b;(0,ac.toMiliseconds)(c)-Date.now()<=0&&this.expire(a,b)}expire(a,b){this.expirations.delete(a),this.events.emit(e_,{target:a,expiration:b})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((a,b)=>this.checkExpiry(b,a))}registerEventListeners(){this.core.heartbeat.on(t.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(eZ,a=>{this.logger.info(`Emitting ${eZ}`),this.logger.debug({type:"event",event:eZ,data:a}),this.persist()}),this.events.on(e_,a=>{this.logger.info(`Emitting ${e_}`),this.logger.debug({type:"event",event:e_,data:a}),this.persist()}),this.events.on(e$,a=>{this.logger.info(`Emitting ${e$}`),this.logger.debug({type:"event",event:e$,data:a}),this.persist()})}isInitialized(){if(!this.initialized){let{message:a}=em("NOT_INITIALIZED",this.name);throw Error(a)}}}var gN=Object.defineProperty,gO=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?gN(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class gP extends _{constructor(a,b,c){super(a,b,c),this.core=a,this.logger=b,this.store=c,gO(this,"name","verify-api"),gO(this,"abortController"),gO(this,"isDevEnv"),gO(this,"verifyUrlV3",e1),gO(this,"storagePrefix",ey),gO(this,"version",2),gO(this,"publicKey"),gO(this,"fetchPromise"),gO(this,"init",async()=>{var a;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,ac.toMiliseconds)(null==(a=this.publicKey)?void 0:a.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),gO(this,"register",async a=>{if(!aw()||this.isDevEnv)return;let b=window.location.origin,{id:c,decryptedId:d}=a,e=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${b}&id=${c}&decryptedId=${d}`;try{let a=(0,af.getDocument)(),b=this.startAbortTimer(5*ac.ONE_SECOND),d=await new Promise((d,f)=>{let g=()=>{window.removeEventListener("message",i),a.body.removeChild(h),f("attestation aborted")};this.abortController.signal.addEventListener("abort",g);let h=a.createElement("iframe");h.src=e,h.style.display="none",h.addEventListener("error",g,{signal:this.abortController.signal});let i=e=>{if(e.data&&"string"==typeof e.data)try{let f=JSON.parse(e.data);if("verify_attestation"===f.type){if((0,ad.decodeJWT)(f.attestation).payload.id!==c)return;clearInterval(b),a.body.removeChild(h),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",i),d(null===f.attestation?"":f.attestation)}}catch(a){this.logger.warn(a)}};a.body.appendChild(h),window.addEventListener("message",i,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",d),d}catch(a){this.logger.warn(a)}return""}),gO(this,"resolve",async a=>{if(this.isDevEnv)return"";let{attestationId:b,hash:c,encryptedId:d}=a;if(""===b)return void this.logger.debug("resolve: attestationId is empty, skipping");if(b){if((0,ad.decodeJWT)(b).payload.id!==d)return;let a=await this.isValidJwtAttestation(b);if(a)return a.isVerified?a:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!c)return;let e=this.getVerifyUrl(a?.verifyUrl);return this.fetchAttestation(c,e)}),gO(this,"fetchAttestation",async(a,b)=>{this.logger.debug(`resolving attestation: ${a} from url: ${b}`);let c=this.startAbortTimer(5*ac.ONE_SECOND),d=await fetch(`${b}/attestation/${a}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(c),200===d.status?await d.json():void 0}),gO(this,"getVerifyUrl",a=>{let b=a||e0;return e2.includes(b)||(this.logger.info(`verify url: ${b}, not included in trusted list, assigning default: ${e0}`),b=e0),b}),gO(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let a=this.startAbortTimer(ac.FIVE_SECONDS),b=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(a),await b.json()}catch(a){this.logger.warn(a)}}),gO(this,"persistPublicKey",async a=>{this.logger.debug("persisting public key to local storage",a),await this.store.setItem(this.storeKey,a),this.publicKey=a}),gO(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),gO(this,"isValidJwtAttestation",async a=>{let b=await this.getPublicKey();try{if(b)return this.validateAttestation(a,b)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let c=await this.fetchAndPersistPublicKey();try{if(c)return this.validateAttestation(a,c)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),gO(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),gO(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async a=>{let b=await this.fetchPublicKey();b&&(await this.persistPublicKey(b),a(b))});let a=await this.fetchPromise;return this.fetchPromise=void 0,a}),gO(this,"validateAttestation",(a,b)=>{let c=function(a,b){let c,d,[e,f,g]=a.split("."),h=Buffer.from(d3(g),"base64");if(64!==h.length)throw Error("Invalid signature length");let i=h.slice(0,32),j=h.slice(32,64),k=bU(`${e}.${f}`),l=(c=Buffer.from(b.x,"base64"),d=Buffer.from(b.y,"base64"),(0,ao.concat)([new Uint8Array([4]),c,d]));if(!dU.verify((0,ao.concat)([i,j]),k,l))throw Error("Invalid signature");return(0,ad.decodeJWT)(a).payload}(a,b.publicKey),d={hasExpired:(0,ac.toMiliseconds)(c.exp)<Date.now(),payload:c};if(d.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),Error("JWT attestation expired");return{origin:d.payload.origin,isScam:d.payload.isScam,isVerified:d.payload.isVerified}}),this.logger=M(b,this.name),this.abortController=new AbortController,this.isDevEnv=aI(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return L(this.logger)}startAbortTimer(a){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,ac.toMiliseconds)(a))}}var gQ=Object.defineProperty,gR=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?gQ(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class gS extends aa{constructor(a,b){super(a,b),this.projectId=a,this.logger=b,gR(this,"context","echo"),gR(this,"registerDeviceToken",async a=>{let{clientId:b,token:c,notificationType:d,enableEncrypted:e=!1}=a,f=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:b,type:d,token:c,always_raw:e})})}),this.logger=M(b,this.context)}}var gT=Object.defineProperty,gU=Object.getOwnPropertySymbols,gV=Object.prototype.hasOwnProperty,gW=Object.prototype.propertyIsEnumerable,gX=(a,b,c)=>b in a?gT(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,gY=(a,b)=>{for(var c in b||(b={}))gV.call(b,c)&&gX(a,c,b[c]);if(gU)for(var c of gU(b))gW.call(b,c)&&gX(a,c,b[c]);return a},gZ=(a,b,c)=>gX(a,"symbol"!=typeof b?b+"":b,c);class g$ extends ab{constructor(a,b,c=!0){super(a,b,c),this.core=a,this.logger=b,gZ(this,"context","event-client"),gZ(this,"storagePrefix",ey),gZ(this,"storageVersion",.1),gZ(this,"events",new Map),gZ(this,"shouldPersist",!1),gZ(this,"init",async()=>{if(!aI())try{let a={eventId:aH(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:az(this.core.relayer.protocol,this.core.relayer.version,eM)}}};await this.sendEvent([a])}catch(a){this.logger.warn(a)}}),gZ(this,"createEvent",a=>{let{event:b="ERROR",type:c="",properties:{topic:d,trace:e}}=a,f=aH(),g=this.core.projectId||"",h=gY({eventId:f,timestamp:Date.now(),props:{event:b,type:c,properties:{topic:d,trace:e}},bundleId:g,domain:this.getAppDomain()},this.setMethods(f));return this.telemetryEnabled&&(this.events.set(f,h),this.shouldPersist=!0),h}),gZ(this,"getEvent",a=>{let{eventId:b,topic:c}=a;if(b)return this.events.get(b);let d=Array.from(this.events.values()).find(a=>a.props.properties.topic===c);if(d)return gY(gY({},d),this.setMethods(d.eventId))}),gZ(this,"deleteEvent",a=>{let{eventId:b}=a;this.events.delete(b),this.shouldPersist=!0}),gZ(this,"setEventListeners",()=>{this.core.heartbeat.on(t.HEARTBEAT_EVENTS.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(a=>{(0,ac.fromMiliseconds)(Date.now())-(0,ac.fromMiliseconds)(a.timestamp)>86400&&(this.events.delete(a.eventId),this.shouldPersist=!0)})})}),gZ(this,"setMethods",a=>({addTrace:b=>this.addTrace(a,b),setError:b=>this.setError(a,b)})),gZ(this,"addTrace",(a,b)=>{let c=this.events.get(a);c&&(c.props.properties.trace.push(b),this.events.set(a,c),this.shouldPersist=!0)}),gZ(this,"setError",(a,b)=>{let c=this.events.get(a);c&&(c.props.type=b,c.timestamp=Date.now(),this.events.set(a,c),this.shouldPersist=!0)}),gZ(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),gZ(this,"restore",async()=>{try{let a=await this.core.storage.getItem(this.storageKey)||[];if(!a.length)return;a.forEach(a=>{this.events.set(a.eventId,gY(gY({},a),this.setMethods(a.eventId)))})}catch(a){this.logger.warn(a)}}),gZ(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;let a=[];for(let[b,c]of this.events)c.props.type&&a.push(c);if(0!==a.length)try{if((await this.sendEvent(a)).ok)for(let b of a)this.events.delete(b.eventId),this.shouldPersist=!0}catch(a){this.logger.warn(a)}}),gZ(this,"sendEvent",async a=>{let b=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${eM}${b}`,{method:"POST",body:JSON.stringify(a)})}),gZ(this,"getAppDomain",()=>((0,ag.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}).url),this.logger=M(b,this.context),this.telemetryEnabled=c,c?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var g_=Object.defineProperty,g0=Object.getOwnPropertySymbols,g1=Object.prototype.hasOwnProperty,g2=Object.prototype.propertyIsEnumerable,g3=(a,b,c)=>b in a?g_(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,g4=(a,b)=>{for(var c in b||(b={}))g1.call(b,c)&&g3(a,c,b[c]);if(g0)for(var c of g0(b))g2.call(b,c)&&g3(a,c,b[c]);return a},g5=(a,b,c)=>g3(a,"symbol"!=typeof b?b+"":b,c);class g6 extends S{constructor(a){var b;super(a),g5(this,"protocol","wc"),g5(this,"version",2),g5(this,"name",ex),g5(this,"relayUrl"),g5(this,"projectId"),g5(this,"customStoragePrefix"),g5(this,"events",new s.EventEmitter),g5(this,"logger"),g5(this,"heartbeat"),g5(this,"relayer"),g5(this,"crypto"),g5(this,"storage"),g5(this,"history"),g5(this,"expirer"),g5(this,"pairing"),g5(this,"verify"),g5(this,"echoClient"),g5(this,"linkModeSupportedApps"),g5(this,"eventClient"),g5(this,"initialized",!1),g5(this,"logChunkController"),g5(this,"on",(a,b)=>this.events.on(a,b)),g5(this,"once",(a,b)=>this.events.once(a,b)),g5(this,"off",(a,b)=>this.events.off(a,b)),g5(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),g5(this,"dispatchEnvelope",({topic:a,message:b,sessionExists:c})=>{if(!a||!b)return;let d={topic:a,message:b,publishedAt:Date.now(),transportType:eN};this.relayer.onLinkMessageEvent(d,{sessionExists:c})});const c=this.getGlobalCore(a?.customStoragePrefix);if(c)try{return this.customStoragePrefix=c.customStoragePrefix,this.logger=c.logger,this.heartbeat=c.heartbeat,this.crypto=c.crypto,this.history=c.history,this.expirer=c.expirer,this.storage=c.storage,this.relayer=c.relayer,this.pairing=c.pairing,this.verify=c.verify,this.echoClient=c.echoClient,this.linkModeSupportedApps=c.linkModeSupportedApps,this.eventClient=c.eventClient,this.initialized=c.initialized,this.logChunkController=c.logChunkController,c}catch(a){console.warn("Failed to copy global core",a)}this.projectId=a?.projectId,this.relayUrl=a?.relayUrl||eD,this.customStoragePrefix=null!=a&&a.customStoragePrefix?`:${a.customStoragePrefix}`:"";const{logger:d,chunkLoggerController:e}=N({opts:K({level:"string"==typeof a?.logger&&a.logger?a.logger:"error",name:ex}),maxSizeInBytes:a?.maxLogBlobSizeInBytes,loggerOverride:a?.logger});this.logChunkController=e,null!=(b=this.logChunkController)&&b.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,b;null!=(a=this.logChunkController)&&a.downloadLogsBlobInBrowser&&(null==(b=this.logChunkController)||b.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=M(d,this.name),this.heartbeat=new t.HeartBeat,this.crypto=new fN(this,this.logger,a?.keychain),this.history=new gJ(this,this.logger),this.expirer=new gM(this,this.logger),this.storage=null!=a&&a.storage?a.storage:new u.default(g4(g4({},ez),a?.storageOptions)),this.relayer=new gp({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new gG(this,this.logger),this.verify=new gP(this,this.logger,this.storage),this.echoClient=new gS(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new g$(this,this.logger,a?.telemetryEnabled),this.setGlobalCore(this)}static async init(a){let b=new g6(a);await b.initialize();let c=await b.crypto.getClientId();return await b.storage.setItem("WALLETCONNECT_CLIENT_ID",c),b}get context(){return L(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var a;return null==(a=this.logChunkController)?void 0:a.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(a){this.linkModeSupportedApps.includes(a)||(this.linkModeSupportedApps.push(a),await this.storage.setItem(eQ,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(eQ)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(a){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,a),this.logger.error(a.message),a}}getGlobalCore(a=""){try{if(this.isGlobalCoreDisabled())return;let b=`_walletConnectCore_${a}`,c=`${b}_count`;return globalThis[c]=(globalThis[c]||0)+1,globalThis[c]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[c]} times.`),globalThis[b]}catch(a){console.warn("Failed to get global WalletConnect core",a);return}}setGlobalCore(a){var b;try{if(this.isGlobalCoreDisabled())return;let c=`_walletConnectCore_${(null==(b=a.opts)?void 0:b.customStoragePrefix)||""}`;globalThis[c]=a}catch(a){console.warn("Failed to set global WalletConnect core",a)}}isGlobalCoreDisabled(){try{return"u">typeof process&&"true"===process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}var O=v,g7=Object.defineProperty;P.IEvents;P.IEvents,P.IEvents,P.IEvents,P.IEvents,P.IEvents;var g8=Object.defineProperty,g9=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?g8(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};s.default;class ha{constructor(a){this.opts=a,g9(this,"protocol","wc"),g9(this,"version",2)}}s.EventEmitter;class hb{constructor(a){this.client=a}}let hc="2.36.0",hd={getDocsUrl:({docsBaseUrl:a,docsPath:b="",docsSlug:c})=>b?`${a??"https://viem.sh"}${b}${c?`#${c}`:""}`:void 0,version:`viem@${hc}`};class he extends Error{constructor(a,b={}){const c=b.cause instanceof he?b.cause.details:b.cause?.message?b.cause.message:b.details,d=b.cause instanceof he&&b.cause.docsPath||b.docsPath,e=hd.getDocsUrl?.({...b,docsPath:d});super([a||"An error occurred.","",...b.metaMessages?[...b.metaMessages,""]:[],...e?[`Docs: ${e}`]:[],...c?[`Details: ${c}`]:[],...hd.version?[`Version: ${hd.version}`]:[]].join("\n"),b.cause?{cause:b.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=c,this.docsPath=d,this.metaMessages=b.metaMessages,this.name=b.name??this.name,this.shortMessage=a,this.version=hc}walk(a){return function a(b,c){return c?.(b)?b:b&&"object"==typeof b&&"cause"in b&&void 0!==b.cause?a(b.cause,c):c?null:b}(this,a)}}function hf(a,{strict:b=!0}={}){return!!a&&"string"==typeof a&&(b?/^0x[0-9a-fA-F]*$/.test(a):a.startsWith("0x"))}class hg extends he{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (${a}) exceeds padding size (${b}).`,{name:"SizeExceedsPaddingSizeError"})}}function hh(a,{dir:b,size:c=32}={}){return"string"==typeof a?function(a,{dir:b,size:c=32}={}){if(null===c)return a;let d=a.replace("0x","");if(d.length>2*c)throw new hg({size:Math.ceil(d.length/2),targetSize:c,type:"hex"});return`0x${d["right"===b?"padEnd":"padStart"](2*c,"0")}`}(a,{dir:b,size:c}):function(a,{dir:b,size:c=32}={}){if(null===c)return a;if(a.length>c)throw new hg({size:a.length,targetSize:c,type:"bytes"});let d=new Uint8Array(c);for(let e=0;e<c;e++){let f="right"===b;d[f?e:c-e-1]=a[f?e:a.length-e-1]}return d}(a,{dir:b,size:c})}class hi extends he{constructor({max:a,min:b,signed:c,size:d,value:e}){super(`Number "${e}" is not in safe ${d?`${8*d}-bit ${c?"signed":"unsigned"} `:""}integer range ${a?`(${b} to ${a})`:`(above ${b})`}`,{name:"IntegerOutOfRangeError"})}}class hj extends he{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed ${b} bytes. Given size: ${a} bytes.`,{name:"SizeOverflowError"})}}function hk(a){return hf(a,{strict:!1})?Math.ceil((a.length-2)/2):a.length}function hl(a,{size:b}){if(hk(a)>b)throw new hj({givenSize:hk(a),maxSize:b})}function hm(a,b={}){let{signed:c}=b;b.size&&hl(a,{size:b.size});let d=BigInt(a);if(!c)return d;let e=(a.length-2)/2;return d<=(1n<<8n*BigInt(e)-1n)-1n?d:d-BigInt(`0x${"f".padStart(2*e,"f")}`)-1n}let hn=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function ho(a,b={}){return"number"==typeof a||"bigint"==typeof a?hq(a,b):"string"==typeof a?function(a,b={}){return hp(hr.encode(a),b)}(a,b):"boolean"==typeof a?function(a,b={}){let c=`0x${Number(a)}`;return"number"==typeof b.size?(hl(c,{size:b.size}),hh(c,{size:b.size})):c}(a,b):hp(a,b)}function hp(a,b={}){let c="";for(let b=0;b<a.length;b++)c+=hn[a[b]];let d=`0x${c}`;return"number"==typeof b.size?(hl(d,{size:b.size}),hh(d,{dir:"right",size:b.size})):d}function hq(a,b={}){let c,{signed:d,size:e}=b,f=BigInt(a);e?c=d?(1n<<8n*BigInt(e)-1n)-1n:2n**(8n*BigInt(e))-1n:"number"==typeof a&&(c=BigInt(Number.MAX_SAFE_INTEGER));let g="bigint"==typeof c&&d?-c-1n:0;if(c&&f>c||f<g){let b="bigint"==typeof a?"n":"";throw new hi({max:c?`${c}${b}`:void 0,min:`${g}${b}`,signed:d,size:e,value:`${a}${b}`})}let h=`0x${(d&&f<0?(1n<<BigInt(8*e))+BigInt(f):f).toString(16)}`;return e?hh(h,{size:e}):h}let hr=new TextEncoder,hs=new TextEncoder;function ht(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function hu(a,b={}){let c=a;b.size&&(hl(c,{size:b.size}),c=hh(c,{dir:"right",size:b.size}));let d=c.slice(2);d.length%2&&(d=`0${d}`);let e=d.length/2,f=new Uint8Array(e);for(let a=0,b=0;a<e;a++){let c=ht(d.charCodeAt(b++)),e=ht(d.charCodeAt(b++));if(void 0===c||void 0===e)throw new he(`Invalid byte sequence ("${d[b-2]}${d[b-1]}" in "${d}").`);f[a]=16*c+e}return f}function hv(a,b={}){let c=hs.encode(a);return"number"==typeof b.size?(hl(c,{size:b.size}),hh(c,{dir:"right",size:b.size})):c}function hw(a,b){let c=(0,ah.keccak_256)(hf(a,{strict:!1})?function(a,b={}){return"number"==typeof a||"bigint"==typeof a?hu(hq(a,b)):"boolean"==typeof a?function(a,b={}){let c=new Uint8Array(1);return(c[0]=Number(a),"number"==typeof b.size)?(hl(c,{size:b.size}),hh(c,{size:b.size})):c}(a,b):hf(a)?hu(a,b):hv(a,b)}(a):a);return"bytes"===(b||"hex")?c:ho(c)}class hx extends Map{constructor(a){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=a}get(a){let b=super.get(a);return super.has(a)&&void 0!==b&&(this.delete(a),super.set(a,b)),b}set(a,b){if(super.set(a,b),this.maxSize&&this.size>this.maxSize){let a=this.keys().next().value;a&&this.delete(a)}return this}}let hy=new hx(8192);async function hz({hash:b,signature:c}){let d=hf(b)?b:ho(b),{secp256k1:e}=await a.A(897028),f=(()=>{if("object"==typeof c&&"r"in c&&"s"in c){let{r:a,s:b,v:d,yParity:f}=c,g=hA(Number(f??d));return new e.Signature(hm(a),hm(b)).addRecoveryBit(g)}let a=hf(c)?c:ho(c);if(65!==hk(a))throw Error("invalid signature length");let b=hA(function(a,b={}){return Number(hm(a,b))}(`0x${a.slice(130)}`));return e.Signature.fromCompact(a.substring(2,130)).addRecoveryBit(b)})().recoverPublicKey(d.substring(2)).toHex(!1);return`0x${f}`}function hA(a){if(0===a||1===a)return a;if(27===a)return 0;if(28===a)return 1;throw Error("Invalid yParityOrV value")}async function hB({hash:a,signature:b}){var c;let d;return c=await hz({hash:a,signature:b}),d=hw(`0x${c.substring(4)}`).substring(26),function(a,b){if(hy.has(`${a}.undefined`))return hy.get(`${a}.undefined`);let c=a.substring(2).toLowerCase(),d=hw(hv(c),"bytes"),e=c.split("");for(let a=0;a<40;a+=2)d[a>>1]>>4>=8&&e[a]&&(e[a]=e[a].toUpperCase()),(15&d[a>>1])>=8&&e[a+1]&&(e[a+1]=e[a+1].toUpperCase());let f=`0x${e.join("")}`;return hy.set(`${a}.undefined`,f),f}(`0x${d}`)}function hC(a){let[b,c]=a.split(":");return{namespace:b,reference:c}}function hD(a,b){return a.includes(":")?[a]:b.chains||[]}var hE=Object.defineProperty,hF=Object.defineProperties,hG=Object.getOwnPropertyDescriptors,hH=Object.getOwnPropertySymbols,hI=Object.prototype.hasOwnProperty,hJ=Object.prototype.propertyIsEnumerable,hK=(a,b,c)=>b in a?hE(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,hL=(a,b)=>{for(var c in b||(b={}))hI.call(b,c)&&hK(a,c,b[c]);if(hH)for(var c of hH(b))hJ.call(b,c)&&hK(a,c,b[c]);return a},hM=(a,b,c)=>hK(a,"symbol"!=typeof b?b+"":b,c);let hN="react-native",hO="browser";function hP(){return"u">typeof process&&"u">typeof process.versions&&"u">typeof process.versions.node}function hQ(){return!(0,af.getDocument)()&&!!(0,af.getNavigator)()&&"ReactNative"===navigator.product}function hR(){return!hP()&&!!(0,af.getNavigator)()&&!!(0,af.getDocument)()}function hS(a,b){return a.filter(a=>b.includes(a)).length===a.length}function hT(a=ac.FIVE_MINUTES,b){let c,d,e,f,g=(0,ac.toMiliseconds)(a||ac.FIVE_MINUTES);return{resolve:a=>{e&&c&&(clearTimeout(e),c(a),f=Promise.resolve(a))},reject:a=>{e&&d&&(clearTimeout(e),d(a))},done:()=>new Promise((a,h)=>{if(f)return a(f);e=setTimeout(()=>{let a=Error(b);f=Promise.reject(a),h(a)},g),c=a,d=h})}}function hU(a,b){return(0,ac.fromMiliseconds)((b||Date.now())+(0,ac.toMiliseconds)(a))}function hV(a){return Date.now()>=(0,ac.toMiliseconds)(a)}function hW(a,b){return`${a}${b?`:${b}`:""}`}function hX(a=[],b=[]){return[...new Set([...a,...b])]}async function hY({id:b,topic:c,wcDeepLink:d}){var e,f;try{if(!d)return;let g="string"==typeof d?JSON.parse(d):d,h=g?.href;if("string"!=typeof h)return;let i=function(a,b,c){let d=`requestId=${b}&sessionTopic=${c}`;a.endsWith("/")&&(a=a.slice(0,-1));let e=`${a}`;if(a.startsWith("https://t.me")){let b=a.includes("?")?"&startapp=":"?startapp=";e=`${e}${b}${function(a,b=!1){let c=Buffer.from(a).toString("base64");return b?c.replace(/[=]/g,""):c}(d,!0)}`}else e=`${e}/wc?${d}`;return e}(h,b,c),j=hQ()?hN:hP()?"node":hR()?hO:"unknown";if(j===hO){let a;if(!(null!=(e=(0,af.getDocument)())&&e.hasFocus()))return void console.warn("Document does not have focus, skipping deeplink.");f=i,a="_self",!function(){try{return window.self!==window.top}catch{return!1}}()?(f.startsWith("https://")||f.startsWith("http://"))&&(a="_blank"):a="_top",window.open(f,a,"noreferrer noopener")}else j===hN&&"u">typeof(null==a.g?void 0:a.g.Linking)&&await a.g.Linking.openURL(i)}catch(a){console.error(a)}}async function hZ(a,b){let c="";try{if(hR()&&(c=localStorage.getItem(b)))return c;c=await a.getItem(b)}catch(a){console.error(a)}return c}function h$(a,b){if(!a.includes(b))return null;let c=a.split(/([&,?,=])/),d=c.indexOf(b);return c[d+2]}class h_{constructor({limit:a}){hM(this,"limit"),hM(this,"set"),this.limit=a,this.set=new Set}add(a){if(!this.set.has(a)){if(this.set.size>=this.limit){let a=this.set.values().next().value;a&&this.set.delete(a)}this.set.add(a)}}has(a){return this.set.has(a)}}let h0=BigInt(0x100000000-1),h1=BigInt(32);function h2(a,b=!1){return b?{h:Number(a&h0),l:Number(a>>h1&h0)}:{h:0|Number(a>>h1&h0),l:0|Number(a&h0)}}function h3(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=h2(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}let h4=(a,b,c)=>a>>>c,h5=(a,b,c)=>a<<32-c|b>>>c,h6=(a,b,c)=>a>>>c|b<<32-c,h7=(a,b,c)=>a<<32-c|b>>>c,h8=(a,b,c)=>a<<64-c|b>>>c-32,h9=(a,b,c)=>a>>>c-32|b<<64-c;function ia(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}}let ib=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),ic=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,id=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),ie=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,ig=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),ih=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,ii="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function ij(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function ik(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function il(a,...b){if(!ij(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function im(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");ik(a.outputLen),ik(a.blockLen)}function io(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function ip(a,b){il(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}function iq(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function ir(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function is(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function it(a,b){return a<<32-b|a>>>b}let iu=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function iv(a){return a<<24&0xff000000|a<<8&0xff0000|a>>>8&65280|a>>>24&255}let iw=iu?a=>a:a=>iv(a),ix=iu?a=>a:function(a){for(let b=0;b<a.length;b++)a[b]=iv(a[b]);return a},iy="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,iz=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function iA(a){if(il(a),iy)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=iz[a[c]];return b}function iB(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function iC(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(iy)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=iB(a.charCodeAt(e)),f=iB(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function iD(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}function iE(a){return"string"==typeof a&&(a=iD(a)),il(a),a}function iF(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];il(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}class iG{}function iH(a){let b=b=>a().update(iE(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function iI(a=32){if(ii&&"function"==typeof ii.getRandomValues)return ii.getRandomValues(new Uint8Array(a));if(ii&&"function"==typeof ii.randomBytes)return Uint8Array.from(ii.randomBytes(a));throw Error("crypto.getRandomValues must be defined")}let iJ=BigInt(0),iK=BigInt(1),iL=BigInt(2),iM=BigInt(7),iN=BigInt(256),iO=BigInt(113),iP=[],iQ=[],iR=[];for(let a=0,b=iK,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],iP.push(2*(5*d+c)),iQ.push((a+1)*(a+2)/2%64);let e=iJ;for(let a=0;a<7;a++)(b=(b<<iK^(b>>iM)*iO)%iN)&iL&&(e^=iK<<(iK<<BigInt(a))-iK);iR.push(e)}let iS=h3(iR,!0),iT=iS[0],iU=iS[1],iV=(a,b,c)=>c>32?b<<c-32|a>>>64-c:a<<c|b>>>32-c,iW=(a,b,c)=>c>32?a<<c-32|b>>>64-c:b<<c|a>>>32-c;class iX extends iG{constructor(a,b,c,d=!1,e=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,ik(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=iq(this.state)}clone(){return this._cloneInto()}keccak(){ix(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=iV(f,g,1)^c[d],i=iW(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=iQ[c],f=iV(b,e,d),g=iW(b,e,d),h=iP[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=iT[d],a[1]^=iU[d]}ir(c)}(this.state32,this.rounds),ix(this.state32),this.posOut=0,this.pos=0}update(a){io(this),il(a=iE(a));let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){io(this,!1),il(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return ik(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(ip(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,ir(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new iX(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let iY=iH(()=>new iX(136,1,32));class iZ extends iG{constructor(a,b,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=is(this.buffer)}update(a){io(this),il(a=iE(a));let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=is(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){io(this),ip(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,ir(this.buffer.subarray(f)),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=is(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let i$=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),i_=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),i0=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),i1=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),i2=new Uint32Array(64);class i3 extends iZ{constructor(a=32){super(64,a,8,!1),this.A=0|i$[0],this.B=0|i$[1],this.C=0|i$[2],this.D=0|i$[3],this.E=0|i$[4],this.F=0|i$[5],this.G=0|i$[6],this.H=0|i$[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)i2[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=i2[a-15],c=i2[a-2],d=it(b,7)^it(b,18)^b>>>3,e=it(c,17)^it(c,19)^c>>>10;i2[a]=e+i2[a-7]+d+i2[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(it(g,6)^it(g,11)^it(g,25))+((k=g)&h^~k&i)+i1[a]+i2[a]|0,o=(it(c,2)^it(c,13)^it(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){ir(i2)}destroy(){this.set(0,0,0,0,0,0,0,0),ir(this.buffer)}}let i4=h3(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),i5=i4[0],i6=i4[1],i7=new Uint32Array(80),i8=new Uint32Array(80);class i9 extends iZ{constructor(a=64){super(128,a,16,!1),this.Ah=0|i0[0],this.Al=0|i0[1],this.Bh=0|i0[2],this.Bl=0|i0[3],this.Ch=0|i0[4],this.Cl=0|i0[5],this.Dh=0|i0[6],this.Dl=0|i0[7],this.Eh=0|i0[8],this.El=0|i0[9],this.Fh=0|i0[10],this.Fl=0|i0[11],this.Gh=0|i0[12],this.Gl=0|i0[13],this.Hh=0|i0[14],this.Hl=0|i0[15]}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:n,Hh:o,Hl:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|n,this.Hh=0|o,this.Hl=0|p}process(a,b){for(let c=0;c<16;c++,b+=4)i7[c]=a.getUint32(b),i8[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|i7[a-15],c=0|i8[a-15],d=h6(b,c,1)^h6(b,c,8)^h4(b,c,7),e=h7(b,c,1)^h7(b,c,8)^h5(b,c,7),f=0|i7[a-2],g=0|i8[a-2],h=h6(f,g,19)^h8(f,g,61)^h4(f,g,6),i=id(e,h7(f,g,19)^h9(f,g,61)^h5(f,g,6),i8[a-7],i8[a-16]),j=ie(i,d,h,i7[a-7],i7[a-16]);i7[a]=0|j,i8[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:n,Gh:o,Gl:p,Hh:q,Hl:r}=this;for(let a=0;a<80;a++){let b=h6(k,l,14)^h6(k,l,18)^h8(k,l,41),s=h7(k,l,14)^h7(k,l,18)^h9(k,l,41),t=k&m^~k&o,u=ig(r,s,l&n^~l&p,i6[a],i8[a]),v=ih(u,q,b,t,i5[a],i7[a]),w=0|u,x=h6(c,d,28)^h8(c,d,34)^h8(c,d,39),y=h7(c,d,28)^h9(c,d,34)^h9(c,d,39),z=c&e^c&g^e&g,A=d&f^d&h^f&h;q=0|o,r=0|p,o=0|m,p=0|n,m=0|k,n=0|l,({h:k,l:l}=ia(0|i,0|j,0|v,0|w)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let B=ib(w,y,A);c=ic(B,v,x,z),d=0|B}({h:c,l:d}=ia(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=ia(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=ia(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=ia(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=ia(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:n}=ia(0|this.Fh,0|this.Fl,0|m,0|n)),({h:o,l:p}=ia(0|this.Gh,0|this.Gl,0|o,0|p)),({h:q,l:r}=ia(0|this.Hh,0|this.Hl,0|q,0|r)),this.set(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r)}roundClean(){ir(i7,i8)}destroy(){ir(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class ja extends i9{constructor(){super(48),this.Ah=0|i_[0],this.Al=0|i_[1],this.Bh=0|i_[2],this.Bl=0|i_[3],this.Ch=0|i_[4],this.Cl=0|i_[5],this.Dh=0|i_[6],this.Dl=0|i_[7],this.Eh=0|i_[8],this.El=0|i_[9],this.Fh=0|i_[10],this.Fl=0|i_[11],this.Gh=0|i_[12],this.Gl=0|i_[13],this.Hh=0|i_[14],this.Hl=0|i_[15]}}let jb=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class jc extends i9{constructor(){super(32),this.Ah=0|jb[0],this.Al=0|jb[1],this.Bh=0|jb[2],this.Bl=0|jb[3],this.Ch=0|jb[4],this.Cl=0|jb[5],this.Dh=0|jb[6],this.Dl=0|jb[7],this.Eh=0|jb[8],this.El=0|jb[9],this.Fh=0|jb[10],this.Fl=0|jb[11],this.Gh=0|jb[12],this.Gl=0|jb[13],this.Hh=0|jb[14],this.Hl=0|jb[15]}}let jd=iH(()=>new i3),je=iH(()=>new i9),jf=iH(()=>new ja),jg=iH(()=>new jc),jh=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),ji=Uint32Array.from([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),jj=new Uint32Array(32);function jk(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=jj[2*a],j=jj[2*a+1],k=jj[2*b],l=jj[2*b+1],m=jj[2*c],n=jj[2*c+1],o=jj[2*d],p=jj[2*d+1],q=ib(i,k,g);j=ic(q,j,l,h),i=0|q,({Dh:p,Dl:o}={Dh:p^j,Dl:o^i}),({Dh:p,Dl:o}={Dh:o,Dl:p}),({h:n,l:m}=ia(n,m,p,o)),({Bh:l,Bl:k}={Bh:l^n,Bl:k^m}),({Bh:l,Bl:k}={Bh:h6(l,k,24),Bl:h7(l,k,24)}),jj[2*a]=i,jj[2*a+1]=j,jj[2*b]=k,jj[2*b+1]=l,jj[2*c]=m,jj[2*c+1]=n,jj[2*d]=o,jj[2*d+1]=p}function jl(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=jj[2*a],j=jj[2*a+1],k=jj[2*b],l=jj[2*b+1],m=jj[2*c],n=jj[2*c+1],o=jj[2*d],p=jj[2*d+1],q=ib(i,k,g);j=ic(q,j,l,h),i=0|q,({Dh:p,Dl:o}={Dh:p^j,Dl:o^i}),({Dh:p,Dl:o}={Dh:h6(p,o,16),Dl:h7(p,o,16)}),({h:n,l:m}=ia(n,m,p,o)),({Bh:l,Bl:k}={Bh:l^n,Bl:k^m}),({Bh:l,Bl:k}={Bh:h8(l,k,63),Bl:h9(l,k,63)}),jj[2*a]=i,jj[2*a+1]=j,jj[2*b]=k,jj[2*b+1]=l,jj[2*c]=m,jj[2*c+1]=n,jj[2*d]=o,jj[2*d+1]=p}class jm extends iG{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,ik(a),ik(b),this.blockLen=a,this.outputLen=b,this.buffer=new Uint8Array(a),this.buffer32=iq(this.buffer)}update(a){io(this),il(a=iE(a));let{blockLen:b,buffer:c,buffer32:d}=this,e=a.length,f=a.byteOffset,g=a.buffer;for(let h=0;h<e;){this.pos===b&&(ix(d),this.compress(d,0,!1),ix(d),this.pos=0);let i=Math.min(b-this.pos,e-h),j=f+h;if(i===b&&!(j%4)&&h+i<e){let a=new Uint32Array(g,j,Math.floor((e-h)/4));ix(a);for(let c=0;h+b<e;c+=d.length,h+=b)this.length+=b,this.compress(a,c,!1);ix(a);continue}c.set(a.subarray(h,h+i),this.pos),this.pos+=i,this.length+=i,h+=i}return this}digestInto(a){io(this),ip(a,this);let{pos:b,buffer32:c}=this;this.finished=!0,ir(this.buffer.subarray(b)),ix(c),this.compress(c,0,!0),ix(c);let d=iq(a);this.get().forEach((a,b)=>d[b]=iw(a))}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){let{buffer:b,length:c,finished:d,destroyed:e,outputLen:f,pos:g}=this;return a||(a=new this.constructor({dkLen:f})),a.set(...this.get()),a.buffer.set(b),a.destroyed=e,a.finished=d,a.length=c,a.pos=g,a.outputLen=f,a}clone(){return this._cloneInto()}}class jn extends jm{constructor(a={}){const b=void 0===a.dkLen?64:a.dkLen;super(128,b),this.v0l=0|ji[0],this.v0h=0|ji[1],this.v1l=0|ji[2],this.v1h=0|ji[3],this.v2l=0|ji[4],this.v2h=0|ji[5],this.v3l=0|ji[6],this.v3h=0|ji[7],this.v4l=0|ji[8],this.v4h=0|ji[9],this.v5l=0|ji[10],this.v5h=0|ji[11],this.v6l=0|ji[12],this.v6h=0|ji[13],this.v7l=0|ji[14],this.v7h=0|ji[15],function(a,b={},c,d,e){if(ik(64),a<0||a>64)throw Error("outputLen bigger than keyLen");let{key:f,salt:g,personalization:h}=b;if(void 0!==f&&(f.length<1||f.length>64))throw Error("key length must be undefined or 1..64");if(void 0!==g&&16!==g.length)throw Error("salt must be undefined or 16");if(void 0!==h&&16!==h.length)throw Error("personalization must be undefined or 16")}(b,a,0,0,0);let{key:c,personalization:d,salt:e}=a,f=0;if(void 0!==c&&(f=(c=iE(c)).length),this.v0l^=this.outputLen|f<<8|0x1010000,void 0!==e){const a=iq(e=iE(e));this.v4l^=iw(a[0]),this.v4h^=iw(a[1]),this.v5l^=iw(a[2]),this.v5h^=iw(a[3])}if(void 0!==d){const a=iq(d=iE(d));this.v6l^=iw(a[0]),this.v6h^=iw(a[1]),this.v7l^=iw(a[2]),this.v7h^=iw(a[3])}if(void 0!==c){const a=new Uint8Array(this.blockLen);a.set(c),this.update(a)}}get(){let{v0l:a,v0h:b,v1l:c,v1h:d,v2l:e,v2h:f,v3l:g,v3h:h,v4l:i,v4h:j,v5l:k,v5h:l,v6l:m,v6h:n,v7l:o,v7h:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.v0l=0|a,this.v0h=0|b,this.v1l=0|c,this.v1h=0|d,this.v2l=0|e,this.v2h=0|f,this.v3l=0|g,this.v3h=0|h,this.v4l=0|i,this.v4h=0|j,this.v5l=0|k,this.v5h=0|l,this.v6l=0|m,this.v6h=0|n,this.v7l=0|o,this.v7h=0|p}compress(a,b,c){this.get().forEach((a,b)=>jj[b]=a),jj.set(ji,16);let{h:d,l:e}=h2(BigInt(this.length));jj[24]=ji[8]^e,jj[25]=ji[9]^d,c&&(jj[28]=~jj[28],jj[29]=~jj[29]);let f=0;for(let c=0;c<12;c++)jk(0,4,8,12,a,b+2*jh[f++]),jl(0,4,8,12,a,b+2*jh[f++]),jk(1,5,9,13,a,b+2*jh[f++]),jl(1,5,9,13,a,b+2*jh[f++]),jk(2,6,10,14,a,b+2*jh[f++]),jl(2,6,10,14,a,b+2*jh[f++]),jk(3,7,11,15,a,b+2*jh[f++]),jl(3,7,11,15,a,b+2*jh[f++]),jk(0,5,10,15,a,b+2*jh[f++]),jl(0,5,10,15,a,b+2*jh[f++]),jk(1,6,11,12,a,b+2*jh[f++]),jl(1,6,11,12,a,b+2*jh[f++]),jk(2,7,8,13,a,b+2*jh[f++]),jl(2,7,8,13,a,b+2*jh[f++]),jk(3,4,9,14,a,b+2*jh[f++]),jl(3,4,9,14,a,b+2*jh[f++]);this.v0l^=jj[0]^jj[16],this.v0h^=jj[1]^jj[17],this.v1l^=jj[2]^jj[18],this.v1h^=jj[3]^jj[19],this.v2l^=jj[4]^jj[20],this.v2h^=jj[5]^jj[21],this.v3l^=jj[6]^jj[22],this.v3h^=jj[7]^jj[23],this.v4l^=jj[8]^jj[24],this.v4h^=jj[9]^jj[25],this.v5l^=jj[10]^jj[26],this.v5h^=jj[11]^jj[27],this.v6l^=jj[12]^jj[28],this.v6h^=jj[13]^jj[29],this.v7l^=jj[14]^jj[30],this.v7h^=jj[15]^jj[31],ir(jj)}destroy(){this.destroyed=!0,ir(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let jo=(q=a=>new jn(a),(h=(a,b)=>q(b).update(iE(a)).digest()).outputLen=(i=q({})).outputLen,h.blockLen=i.blockLen,h.create=a=>q(a),h);function jp(a){let b=`Ethereum Signed Message:
${a.length}`,c=new TextEncoder().encode(b+a);return"0x"+Buffer.from(iY(c)).toString("hex")}async function jq(a,b,c,d,e,f){switch(c.t){case"eip191":return await jr(a,b,c.s);case"eip1271":return await js(a,b,c.s,d,e,f);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${c.t}`)}}async function jr(a,b,c){return(await hB({hash:jp(b),signature:c})).toLowerCase()===a.toLowerCase()}async function js(a,b,c,d,e,f){let g=hC(d);if(!g.namespace||!g.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${d}`);try{let g="0x1626ba7e",h=c.substring(2),i=(h.length/2).toString(16).padStart(64,"0"),j=(b.startsWith("0x")?b:jp(b)).substring(2),k=g+j+"0000000000000000000000000000000000000000000000000000000000000040"+i+h,l=await fetch(`${f||"https://rpc.walletconnect.org/v1"}/?chainId=${d}&projectId=${e}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:a,data:k},"latest"]})}),{result:m}=await l.json();return!!m&&m.slice(0,g.length).toLowerCase()===g.toLowerCase()}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function jt(a){let b=new Uint8Array(jd(function(a){if(a instanceof Uint8Array)return a;if(Array.isArray(a))return new Uint8Array(a);if("object"==typeof a&&null!=a&&a.data)return new Uint8Array(Object.values(a.data));if("object"==typeof a&&a)return new Uint8Array(Object.values(a));throw Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(a)));return ai.default.encode(b)}function ju(a){let b=Buffer.from(a,"base64"),c=(0,aj.decode)(b).txn;if(!c)throw Error("Invalid signed transaction: missing 'txn' field");let d=(0,ak.encode)(c),e=Buffer.from("TX"),f=jg(Buffer.concat([e,Buffer.from(d)]));return al.base32.encode(f).replace(/=+$/,"")}function jv(a){let b=[],c=BigInt(a);for(;c>=BigInt(128);)b.push(Number(c&BigInt(127)|BigInt(128))),c>>=BigInt(7);return b.push(Number(c)),Buffer.from(b)}var jw=Object.defineProperty,jx=Object.defineProperties,jy=Object.getOwnPropertyDescriptors,jz=Object.getOwnPropertySymbols,jA=Object.prototype.hasOwnProperty,jB=Object.prototype.propertyIsEnumerable,jC=(a,b,c)=>b in a?jw(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;let jD=a=>a?.split(":"),jE=a=>{let b=a&&jD(a);if(b)return b[2]+":"+b[3]},jF=a=>{let b=a&&jD(a);if(b)return b.pop()};async function jG(a){let{cacao:b,projectId:c}=a,{s:d,p:e}=b,f=jH(e,e.iss),g=jF(e.iss);return await jq(g,f,d,jE(e.iss),c)}let jH=(a,b)=>{let c=`${a.domain} wants you to sign in with your Ethereum account:`,d=jF(b);if(!a.aud&&!a.uri)throw Error("Either `aud` or `uri` is required to construct the message");let e=a.statement||void 0,f=`URI: ${a.aud||a.uri}`,g=`Version: ${a.version}`,h=`Chain ID: ${(a=>{let b=a&&jD(a);if(b)return a.includes("did:pkh:")?b[3]:b[1]})(b)}`,i=`Nonce: ${a.nonce}`,j=`Issued At: ${a.iat}`,k=a.exp?`Expiration Time: ${a.exp}`:void 0,l=a.nbf?`Not Before: ${a.nbf}`:void 0,m=a.requestId?`Request ID: ${a.requestId}`:void 0,n=a.resources?`Resources:${a.resources.map(a=>`
- ${a}`).join("")}`:void 0,o=jN(a.resources);return o&&(e=function(a="",b){jI(b);let c="I further authorize the stated URI to perform the following actions on my behalf: ";if(a.includes(c))return a;let d=[],e=0;Object.keys(b.att).forEach(a=>{let c=Object.keys(b.att[a]).map(a=>({ability:a.split("/")[0],action:a.split("/")[1]}));c.sort((a,b)=>a.action.localeCompare(b.action));let f={};c.forEach(a=>{f[a.ability]||(f[a.ability]=[]),f[a.ability].push(a.action)});let g=Object.keys(f).map(b=>(e++,`(${e}) '${b}': '${f[b].join("', '")}' for '${a}'.`));d.push(g.join(", ").replace(".,","."))});let f=d.join(" "),g=`${c}${f}`;return`${a?a+" ":""}${g}`}(e,jK(o))),[c,d,"",e,"",f,g,h,i,j,k,l,m,n].filter(a=>null!=a).join(`
`)};function jI(a){if(!a)throw Error("No recap provided, value is undefined");if(!a.att)throw Error("No `att` property found");let b=Object.keys(a.att);if(!(null!=b&&b.length))throw Error("No resources found in `att` property");b.forEach(b=>{let c=a.att[b];if(Array.isArray(c)||"object"!=typeof c)throw Error(`Resource must be an object: ${b}`);if(!Object.keys(c).length)throw Error(`Resource object is empty: ${b}`);Object.keys(c).forEach(a=>{let b=c[a];if(!Array.isArray(b))throw Error(`Ability limits ${a} must be an array of objects, found: ${b}`);if(!b.length)throw Error(`Value of ${a} is empty array, must be an array with objects`);b.forEach(b=>{if("object"!=typeof b)throw Error(`Ability limits (${a}) must be an array of objects, found: ${b}`)})})})}function jJ(a){return jI(a),`urn:recap:${Buffer.from(JSON.stringify(a)).toString("base64").replace(/=/g,"")}`}function jK(a){var b;let c=(b=a.replace("urn:recap:",""),JSON.parse(Buffer.from(b,"base64").toString("utf-8")));return jI(c),c}function jL(a){var b;let c=jK(a);jI(c);let d=null==(b=c.att)?void 0:b.eip155;return d?Object.keys(d).map(a=>a.split("/")[1]):[]}function jM(a){let b=jK(a);jI(b);let c=[];return Object.values(b.att).forEach(a=>{Object.values(a).forEach(a=>{var b;null!=(b=a?.[0])&&b.chains&&c.push(a[0].chains)})}),[...new Set(c.flat())]}function jN(a){if(!a)return;let b=a?.[a.length-1];return b&&b.includes("urn:recap:")?b:void 0}function jO(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function jP(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function jQ(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function jR(a,...b){if(!jO(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function jS(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function jT(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function jU(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let jV=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function jW(a){if("string"==typeof a)a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a);else if(jO(a))a=jZ(a);else throw Error("Uint8Array expected, got "+typeof a);return a}function jX(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error("invalid output length, expected "+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function jY(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function jZ(a){return Uint8Array.from(a)}let j$=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),j_=j$("expand 16-byte k"),j0=j$("expand 32-byte k"),j1=jT(j_),j2=jT(j0);function j3(a,b){return a<<b|a>>>32-b}function j4(a){return a.byteOffset%4==0}let j5=0x100000000-1,j6=new Uint32Array,j7=(a,b)=>255&a[b++]|(255&a[b++])<<8;class j8{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,jR(a=jW(a),32);const b=j7(a,0),c=j7(a,2),d=j7(a,4),e=j7(a,6),f=j7(a,8),g=j7(a,10),h=j7(a,12),i=j7(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=j7(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=j7(a,b+0),q=j7(a,b+2),r=j7(a,b+4),s=j7(a,b+6),t=j7(a,b+8),u=j7(a,b+10),v=j7(a,b+12),w=j7(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;jU(c)}update(a){jS(this),jR(a=jW(a));let{buffer:b,blockLen:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){jU(this.h,this.r,this.buffer,this.pad)}digestInto(a){jS(this),function(a,b){jR(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,h:c}=this,{pos:d}=this;if(d){for(b[d++]=1;d<16;d++)b[d]=0;this.process(b,0,!0)}this.finalize();let e=0;for(let b=0;b<8;b++)a[e++]=c[b]>>>0,a[e++]=c[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let j9=(r=a=>new j8(a),(j=(a,b)=>r(b).update(jW(a)).digest()).outputLen=(k=r(new Uint8Array(32))).outputLen,j.blockLen=k.blockLen,j.create=a=>r(a),j),ka=function(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return jQ(e),jQ(g),jP(f),jP(c),(b,h,i,j,k=0)=>{jR(b),jR(h),jR(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),jR(j),jQ(k),k<0||k>=j5)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],n=b.length,o,p;if(32===n)m.push(o=jZ(b)),p=j2;else if(16===n&&c)(o=new Uint8Array(32)).set(b),o.set(b,16),p=j1,m.push(o);else throw Error(`arx: invalid 32-byte key, got length=${n}`);j4(h)||m.push(h=jZ(h));let q=jT(o);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(p,q,jT(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=jT(j),l=j4(e)&&j4(f),m=l?jT(e):j6,n=l?jT(f):j6;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=j5)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,p,q,jT(h),i,j,k,g),jU(...m),j}}(function(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=j3(H^(v=v+z|0),16))|0,v=v+(z=j3(z^D,12))|0,D=D+(H=j3(H^v,8))|0,z=j3(z^D,7),E=E+(I=j3(I^(w=w+A|0),16))|0,w=w+(A=j3(A^E,12))|0,E=E+(I=j3(I^w,8))|0,A=j3(A^E,7),F=F+(J=j3(J^(x=x+B|0),16))|0,x=x+(B=j3(B^F,12))|0,F=F+(J=j3(J^x,8))|0,B=j3(B^F,7),G=G+(K=j3(K^(y=y+C|0),16))|0,y=y+(C=j3(C^G,12))|0,G=G+(K=j3(K^y,8))|0,C=j3(C^G,7),F=F+(K=j3(K^(v=v+A|0),16))|0,v=v+(A=j3(A^F,12))|0,F=F+(K=j3(K^v,8))|0,A=j3(A^F,7),G=G+(H=j3(H^(w=w+B|0),16))|0,w=w+(B=j3(B^G,12))|0,G=G+(H=j3(H^w,8))|0,B=j3(B^G,7),D=D+(I=j3(I^(x=x+C|0),16))|0,x=x+(C=j3(C^D,12))|0,D=D+(I=j3(I^x,8))|0,C=j3(C^D,7),E=E+(J=j3(J^(y=y+z|0),16))|0,y=y+(z=j3(z^E,12))|0,E=E+(J=j3(J^y,8))|0,z=j3(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),kb=new Uint8Array(16),kc=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(kb.subarray(c))},kd=new Uint8Array(32);function ke(a,b,c,d,e){var f,g;let h,i,j=a(b,c,kd),k=j9.create(j);e&&kc(k,e),kc(k,d);let l=(f=d.length,g=e?e.length:0,jP(!0),jY(i=new DataView((h=new Uint8Array(16)).buffer,h.byteOffset,h.byteLength),0,BigInt(g),!0),jY(i,8,BigInt(f),!0),h);k.update(l);let m=k.digest();return jU(j,l),m}m={blockSize:64,nonceLength:12,tagLength:16},n=(a,b,c)=>({encrypt(d,e){let f=d.length;(e=jX(f+16,e,!1)).set(d);let g=e.subarray(0,-16);ka(a,b,g,g,1);let h=ke(ka,a,b,g,c);return e.set(h,f),jU(h),e},decrypt(d,e){e=jX(d.length-16,e,!1);let f=d.subarray(0,-16),g=d.subarray(-16),h=ke(ka,a,b,f,c);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(g,h))throw Error("invalid tag");return e.set(d.subarray(0,-16)),ka(a,b,e,e,1),jU(h),e}}),Object.assign(function(a,...b){if(jR(a),!jV)throw Error("Non little-endian hardware is not yet supported");if(void 0!==m.nonceLength){let a=b[0];if(!a)throw Error("nonce / iv required");m.varSizeNonce?jR(a):jR(a,m.nonceLength)}let c=m.tagLength;c&&void 0!==b[1]&&jR(b[1]);let d=n(a,...b),e=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");jR(b)}},f=!1;return{encrypt(a,b){if(f)throw Error("cannot encrypt() twice with same key + nonce");return f=!0,jR(a),e(d.encrypt.length,b),d.encrypt(a,b)},decrypt(a,b){if(jR(a),c&&a.length<c)throw Error("invalid ciphertext length: smaller than tagLength="+c);return e(d.decrypt.length,b),d.decrypt(a,b)}}},m);class kf extends iG{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,im(a);const c=iE(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),ir(e)}update(a){return io(this),this.iHash.update(a),this}digestInto(a){io(this),il(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let kg=(a,b,c)=>new kf(a,b).update(c).digest();kg.create=(a,b)=>new kf(a,b),Uint8Array.from([0]),Uint8Array.of();let kh=BigInt(0),ki=BigInt(1);function kj(a,b=""){if("boolean"!=typeof a)throw Error((b&&`"${b}"`)+"expected boolean, got type="+typeof a);return a}function kk(a,b,c=""){let d=ij(a),e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function kl(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function km(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?kh:BigInt("0x"+a)}function kn(a){return il(a),km(iA(Uint8Array.from(a).reverse()))}function ko(a,b){return iC(a.toString(16).padStart(2*b,"0"))}function kp(a,b){return ko(a,b).reverse()}function kq(a,b,c){let d;if("string"==typeof b)try{d=iC(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(ij(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}let kr=a=>"bigint"==typeof a&&kh<=a;function ks(a,b,c,d){if(!(kr(b)&&kr(c)&&kr(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}function kt(a){let b;for(b=0;a>kh;a>>=ki,b+=1);return b}let ku=a=>(ki<<BigInt(a))-ki;function kv(a,b,c={}){if(!a||"object"!=typeof a)throw Error("expected valid options object");function d(b,c,d){let e=a[b];if(d&&void 0===e)return;let f=typeof e;if(f!==c||null===e)throw Error(`param "${b}" is invalid: expected ${c}, got ${f}`)}Object.entries(b).forEach(([a,b])=>d(a,b,!1)),Object.entries(c).forEach(([a,b])=>d(a,b,!0))}function kw(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let kx=BigInt(0),ky=BigInt(1),kz=BigInt(2),kA=BigInt(3),kB=BigInt(4),kC=BigInt(5),kD=BigInt(7),kE=BigInt(8),kF=BigInt(9),kG=BigInt(16);function kH(a,b){let c=a%b;return c>=kx?c:b+c}function kI(a,b,c){let d=a;for(;b-- >kx;)d*=d,d%=c;return d}function kJ(a,b){if(a===kx)throw Error("invert: expected non-zero number");if(b<=kx)throw Error("invert: expected positive modulus, got "+b);let c=kH(a,b),d=b,e=kx,f=ky;for(;c!==kx;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==ky)throw Error("invert: does not exist");return kH(e,b)}function kK(a,b,c){if(!a.eql(a.sqr(b),c))throw Error("Cannot find square root")}function kL(a,b){let c=(a.ORDER+ky)/kB,d=a.pow(b,c);return kK(a,d,b),d}function kM(a,b){let c=(a.ORDER-kC)/kE,d=a.mul(b,kz),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,kz),e),h=a.mul(f,a.sub(g,a.ONE));return kK(a,h,b),h}function kN(a){if(a<kA)throw Error("sqrt is not defined for small field");let b=a-ky,c=0;for(;b%kz===kx;)b/=kz,c++;let d=kz,e=kS(a);for(;1===kQ(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return kL;let f=e.pow(d,b),g=(b+ky)/kz;return function(a,d){if(a.is0(d))return d;if(1!==kQ(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=ky<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}let kO=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function kP(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function kQ(a,b){let c=(a.ORDER-ky)/kz,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function kR(a,b){void 0!==b&&ik(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function kS(a,b,c=!1,d={}){let e;if(a<=kx)throw Error("invalid field: expected ORDER > 0, got "+a);let f,g,h=!1,i;if("object"==typeof b&&null!=b){if(d.sqrt||c)throw Error("cannot specify opts in two arguments");b.BITS&&(f=b.BITS),b.sqrt&&(g=b.sqrt),"boolean"==typeof b.isLE&&(c=b.isLE),"boolean"==typeof b.modFromBytes&&(h=b.modFromBytes),i=b.allowedLengths}else"number"==typeof b&&(f=b),d.sqrt&&(g=d.sqrt);let{nBitLength:j,nByteLength:k}=kR(a,f);if(k>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let l=Object.freeze({ORDER:a,isLE:c,BITS:j,BYTES:k,MASK:ku(j),ZERO:kx,ONE:ky,allowedLengths:i,create:b=>kH(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return kx<=b&&b<a},is0:a=>a===kx,isValidNot0:a=>!l.is0(a)&&l.isValid(a),isOdd:a=>(a&ky)===ky,neg:b=>kH(-b,a),eql:(a,b)=>a===b,sqr:b=>kH(b*b,a),add:(b,c)=>kH(b+c,a),sub:(b,c)=>kH(b-c,a),mul:(b,c)=>kH(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<kx)throw Error("invalid exponent, negatives unsupported");if(c===kx)return a.ONE;if(c===ky)return b;let d=a.ONE,e=b;for(;c>kx;)c&ky&&(d=a.mul(d,e)),e=a.sqr(e),c>>=ky;return d})(l,a,b),div:(b,c)=>kH(b*kJ(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>kJ(b,a),sqrt:g||(b=>{let c,d,f,g,h,i;return e||(e=a%kB===kA?kL:a%kE===kC?kM:a%kG===kF?(c=kS(a),f=(d=kN(a))(c,c.neg(c.ONE)),g=d(c,f),h=d(c,c.neg(f)),i=(a+kD)/kG,(a,b)=>{let c=a.pow(b,i),d=a.mul(c,f),e=a.mul(c,g),j=a.mul(c,h),k=a.eql(a.sqr(d),b),l=a.eql(a.sqr(e),b);c=a.cmov(c,d,k),d=a.cmov(j,e,l);let m=a.eql(a.sqr(d),b),n=a.cmov(c,d,m);return kK(a,n,b),n}):kN(a)),e(l,b)}),toBytes:a=>c?kp(a,k):ko(a,k),fromBytes:(b,d=!0)=>{if(i){if(!i.includes(b.length)||b.length>k)throw Error("Field.fromBytes: expected "+i+" bytes, got "+b.length);let a=new Uint8Array(k);a.set(b,c?0:a.length-b.length),b=a}if(b.length!==k)throw Error("Field.fromBytes: expected "+k+" bytes, got "+b.length);let e=c?kn(b):km(iA(b));if(h&&(e=kH(e,a)),!d&&!l.isValid(e))throw Error("invalid field element: outside of range 0..ORDER");return e},invertBatch:a=>kP(l,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(l)}function kT(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function kU(a){let b=kT(a);return b+Math.ceil(b/2)}let kV=BigInt(0),kW=BigInt(1);function kX(a,b){let c=b.negate();return a?c:b}function kY(a,b){let c=kP(a.Fp,b.map(a=>a.Z));return b.map((b,d)=>a.fromAffine(b.toAffine(c[d])))}function kZ(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function k$(a,b){kZ(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:ku(a),maxNumber:e,shiftBy:BigInt(a)}}function k_(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=kW);let j=b*d;return{nextN:i,offset:j+Math.abs(h)-1,isZero:0===h,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let k0=new WeakMap,k1=new WeakMap;function k2(a){return k1.get(a)||1}function k3(a){if(a!==kV)throw Error("invalid wNAF")}class k4{constructor(a,b){this.BASE=a.BASE,this.ZERO=a.ZERO,this.Fn=a.Fn,this.bits=b}_unsafeLadder(a,b,c=this.ZERO){let d=a;for(;b>kV;)b&kW&&(c=c.add(d)),d=d.double(),b>>=kW;return c}precomputeWindow(a,b){let{windows:c,windowSize:d}=k$(b,this.bits),e=[],f=a,g=f;for(let a=0;a<c;a++){g=f,e.push(g);for(let a=1;a<d;a++)g=g.add(f),e.push(g);f=g.double()}return e}wNAF(a,b,c){if(!this.Fn.isValid(c))throw Error("invalid scalar");let d=this.ZERO,e=this.BASE,f=k$(a,this.bits);for(let a=0;a<f.windows;a++){let{nextN:g,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=k_(c,a,f);c=g,i?e=e.add(kX(k,b[l])):d=d.add(kX(j,b[h]))}return k3(c),{p:d,f:e}}wNAFUnsafe(a,b,c,d=this.ZERO){let e=k$(a,this.bits);for(let a=0;a<e.windows&&c!==kV;a++){let{nextN:f,offset:g,isZero:h,isNeg:i}=k_(c,a,e);if(c=f,!h){let a=b[g];d=d.add(i?a.negate():a)}}return k3(c),d}getPrecomputes(a,b,c){let d=k0.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&("function"==typeof c&&(d=c(d)),k0.set(b,d))),d}cached(a,b,c){let d=k2(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)}unsafe(a,b,c,d){let e=k2(a);return 1===e?this._unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)}createCache(a,b){kZ(b,this.bits),k1.set(a,b),k0.delete(a)}hasCache(a){return 1!==k2(a)}}function k5(a,b,c){if(!b)return kS(a,{isLE:c});if(b.ORDER!==a)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return kv(b,kO.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),b}BigInt(0),BigInt(1),BigInt(2),BigInt(8),iD("HashToScalar-");let k6=BigInt(0),k7=BigInt(1),k8=BigInt(2),k9=BigInt(1),la=BigInt(2),lb=BigInt(3),lc=BigInt(5),ld=BigInt(8),le=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),lf={p:le,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:ld,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")},lg=(function(a){let{P:b,type:c,adjustScalarBytes:d,powPminus2:e,randomBytes:f}=(kv(a,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...a})),g="x25519"===c;if(!g&&"x448"!==c)throw Error("invalid type");let h=g?32:56,i=BigInt(g?9:5),j=BigInt(g?121665:39081),k=g?k8**BigInt(254):k8**BigInt(447),l=k+(g?BigInt(8)*k8**BigInt(251)-k7:BigInt(4)*k8**BigInt(445)-k7)+k7,m=a=>kH(a,b),n=kp(m(i),h);n.slice()}({P:l=kS(lf.p,{isLE:!0}).ORDER,type:"x25519",powPminus2:a=>{let b,c,d,e,f,g,h,i,j,k,m,n,o,p,{pow_p_5_8:q,b2:r}=(b=BigInt(10),c=BigInt(20),d=BigInt(40),e=BigInt(80),g=kI(f=a*a%le*a%le,la,le)*f%le,h=kI(g,k9,le)*a%le,i=kI(h,lc,le)*h%le,j=kI(i,b,le)*i%le,k=kI(j,c,le)*j%le,m=kI(k,d,le)*k%le,n=kI(m,e,le)*m%le,o=kI(n,e,le)*m%le,p=kI(o,b,le)*i%le,{pow_p_5_8:kI(p,la,le)*a%le,b2:f});return kH(kI(q,lb,l)*r,l)},adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a}}),(a,b)=>(a+(a>=0?b:-b)/lm)/b);function lh(a){if(!["compact","recovered","der"].includes(a))throw Error('Signature format must be "compact", "recovered", or "der"');return a}function li(a,b){let c={};for(let d of Object.keys(b))c[d]=void 0===a[d]?b[d]:a[d];return kj(c.lowS,"lowS"),kj(c.prehash,"prehash"),void 0!==c.format&&lh(c.format),c}let lj={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=lj;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=kl(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?kl(e.length/2|128):"";return kl(a)+f+e+b},decode(a,b){let{Err:c}=lj,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=lj;if(a<lk)throw new b("integer: negative integers are not allowed");let c=kl(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=lj;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return km(iA(a))}},toSig(a){let{Err:b,_int:c,_tlv:d}=lj,e=kq("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=lj,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},lk=BigInt(0),ll=BigInt(1),lm=BigInt(2),ln=BigInt(3),lo=BigInt(4);function lp(a,b){let c,{BYTES:d}=a;if("bigint"==typeof b)c=b;else{let e=kq("private key",b);try{c=a.fromBytes(e)}catch{throw Error(`invalid private key: expected ui8a of size ${d}, got ${typeof b}`)}}if(!a.isValidNot0(c))throw Error("invalid private key: out of range [1..N-1]");return c}function lq(a){return Uint8Array.of(a?2:3)}function lr(a,b){return{secretKey:b.BYTES,publicKey:1+a.BYTES,publicKeyUncompressed:1+2*a.BYTES,publicKeyHasPrefix:!0,signature:2*b.BYTES}}function ls(a,b){let c=b=>(function(a){let b,{CURVE:c,curveOpts:d,hash:e,ecdsaOpts:f}=function(a){let b,c,d,e,{CURVE:f,curveOpts:g}=(b={a:a.a,b:a.b,p:a.Fp.ORDER,n:a.n,h:a.h,Gx:a.Gx,Gy:a.Gy},c=a.Fp,d=a.allowedPrivateKeyLengths?Array.from(new Set(a.allowedPrivateKeyLengths.map(a=>Math.ceil(a/2)))):void 0,e={Fp:c,Fn:kS(b.n,{BITS:a.nBitLength,allowedLengths:d,modFromBytes:a.wrapPrivateKey}),allowInfinityPoint:a.allowInfinityPoint,endo:a.endo,isTorsionFree:a.isTorsionFree,clearCofactor:a.clearCofactor,fromBytes:a.fromBytes,toBytes:a.toBytes},{CURVE:b,curveOpts:e}),h={hmac:a.hmac,randomBytes:a.randomBytes,lowS:a.lowS,bits2int:a.bits2int,bits2int_modN:a.bits2int_modN};return{CURVE:f,curveOpts:g,hash:a.hash,ecdsaOpts:h}}(a),g=function(a,b,c={}){im(b),kv(c,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let d=c.randomBytes||iI,e=c.hmac||((a,...c)=>kg(b,a,iF(...c))),{Fp:f,Fn:g}=a,{ORDER:h,BITS:i}=g,{keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:n}=function(a,b={}){let{Fn:c}=a,d=b.randomBytes||iI,e=Object.assign(lr(a.Fp,c),{seed:kU(c.ORDER)});function f(a){try{return!!lp(c,a)}catch{return!1}}function g(a=d(e.seed)){return function(a,b,c=!1){let d=a.length,e=kT(b),f=kU(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=kH(c?kn(a):km(iA(a)),b-ky)+ky;return c?kp(g,e):ko(g,e)}(kk(a,e.seed,"seed"),c.ORDER)}function h(b,d=!0){return a.BASE.multiply(lp(c,b)).toBytes(d)}function i(b){if("bigint"==typeof b)return!1;if(b instanceof a)return!0;let{secretKey:d,publicKey:f,publicKeyUncompressed:g}=e;if(c.allowedLengths||d===f)return;let h=kq("key",b).length;return h===f||h===g}return Object.freeze({getPublicKey:h,getSharedSecret:function(b,d,e=!0){if(!0===i(b))throw Error("first arg must be private key");if(!1===i(d))throw Error("second arg must be public key");let f=lp(c,b);return a.fromHex(d).multiply(f).toBytes(e)},keygen:function(a){let b=g(a);return{secretKey:b,publicKey:h(b)}},Point:a,utils:{isValidSecretKey:f,isValidPublicKey:function(b,c){let{publicKey:d,publicKeyUncompressed:f}=e;try{let e=b.length;return(!0!==c||e===d)&&(!1!==c||e===f)&&!!a.fromBytes(b)}catch{return!1}},randomSecretKey:g,isValidPrivateKey:f,randomPrivateKey:g,normPrivateKeyToScalar:a=>lp(c,a),precompute:(b=8,c=a.BASE)=>c.precompute(b,!1)},lengths:e})}(a,c),o={prehash:!1,lowS:"boolean"==typeof c.lowS&&c.lowS,format:void 0,extraEntropy:!1},p="compact";function q(a,b){if(!g.isValidNot0(b))throw Error(`invalid signature ${a}: out of range 1..Point.Fn.ORDER`);return b}class r{constructor(a,b,c){this.r=q("r",a),this.s=q("s",b),null!=c&&(this.recovery=c),Object.freeze(this)}static fromBytes(a,b=p){var c,d;let e,f;if(c=a,lh(d=b),f=n.signature,kk(c,"compact"===d?f:"recovered"===d?f+1:void 0,`${d} signature`),"der"===b){let{r:b,s:c}=lj.toSig(kk(a));return new r(b,c)}"recovered"===b&&(e=a[0],b="compact",a=a.subarray(1));let h=g.BYTES,i=a.subarray(0,h),j=a.subarray(h,2*h);return new r(g.fromBytes(i),g.fromBytes(j),e)}static fromHex(a,b){return this.fromBytes(iC(a),b)}addRecoveryBit(a){return new r(this.r,this.s,a)}recoverPublicKey(b){let c=f.ORDER,{r:d,s:e,recovery:i}=this;if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");if(h*lm<c&&i>1)throw Error("recovery id is ambiguous for h>1 curve");let j=2===i||3===i?d+h:d;if(!f.isValid(j))throw Error("recovery id 2 or 3 invalid");let k=f.toBytes(j),l=a.fromBytes(iF(lq((1&i)==0),k)),m=g.inv(j),n=t(kq("msgHash",b)),o=g.create(-n*m),p=g.create(e*m),q=a.BASE.multiplyUnsafe(o).add(l.multiplyUnsafe(p));if(q.is0())throw Error("point at infinify");return q.assertValidity(),q}hasHighS(){return this.s>h>>ll}toBytes(a=p){if(lh(a),"der"===a)return iC(lj.hexFromSig(this));let b=g.toBytes(this.r),c=g.toBytes(this.s);if("recovered"===a){if(null==this.recovery)throw Error("recovery bit must be present");return iF(Uint8Array.of(this.recovery),b,c)}return iF(b,c)}toHex(a){return iA(this.toBytes(a))}assertValidity(){}static fromCompact(a){return r.fromBytes(kq("sig",a),"compact")}static fromDER(a){return r.fromBytes(kq("sig",a),"der")}normalizeS(){return this.hasHighS()?new r(this.r,g.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return iA(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return iA(this.toBytes("compact"))}}let s=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=km(iA(a)),c=8*a.length-i;return c>0?b>>BigInt(c):b},t=c.bits2int_modN||function(a){return g.create(s(a))},u=ku(i);function v(a){return ks("num < 2^"+i,a,lk,u),g.toBytes(a)}function w(a,c){return kk(a,void 0,"message"),c?kk(b(a),void 0,"prehashed message"):a}return Object.freeze({keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:n,Point:a,sign:function(c,f,i={}){let{seed:j,k2sig:k}=function(b,c,e){if(["recovered","canonical"].some(a=>a in e))throw Error("sign() legacy options not supported");let{lowS:f,prehash:i,extraEntropy:j}=li(e,o),k=t(b=w(b,i)),l=lp(g,c),m=[v(l),v(k)];if(null!=j&&!1!==j){let a=!0===j?d(n.secretKey):j;m.push(kq("extraEntropy",a))}return{seed:iF(...m),k2sig:function(b){let c=s(b);if(!g.isValidNot0(c))return;let d=g.inv(c),e=a.BASE.multiply(c).toAffine(),i=g.create(e.x);if(i===lk)return;let j=g.create(d*g.create(k+i*l));if(j===lk)return;let m=2*(e.x!==i)|Number(e.y&ll),n=j;return f&&j>h>>ll&&(n=g.neg(j),m^=1),new r(i,n,m)}}}(c=kq("message",c),f,i);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=a=>new Uint8Array(a),e=d(a),f=d(a),g=0,h=()=>{e.fill(1),f.fill(0),g=0},i=(...a)=>c(f,e,...a),j=(a=d(0))=>{f=i(Uint8Array.of(0),a),e=i(),0!==a.length&&(f=i(Uint8Array.of(1),a),e=i())},k=()=>{if(g++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(e=i()).slice();c.push(b),a+=e.length}return iF(...c)};return(a,b)=>{let c;for(h(),j(a);!(c=b(k()));)j();return h(),c}})(b.outputLen,g.BYTES,e)(j,k)},verify:function(b,c,d,e={}){let{lowS:f,prehash:h,format:i}=li(e,o);if(d=kq("publicKey",d),c=w(kq("message",c),h),"strict"in e)throw Error("options.strict was renamed to lowS");let j=void 0===i?function(a){let b,c="string"==typeof a||ij(a),d=!c&&null!==a&&"object"==typeof a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!c&&!d)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(d)b=new r(a.r,a.s);else if(c){try{b=r.fromBytes(kq("sig",a),"der")}catch(a){if(!(a instanceof lj.Err))throw a}if(!b)try{b=r.fromBytes(kq("sig",a),"compact")}catch{return!1}}return b||!1}(b):r.fromBytes(kq("sig",b),i);if(!1===j)return!1;try{let b=a.fromBytes(d);if(f&&j.hasHighS())return!1;let{r:e,s:h}=j,i=t(c),k=g.inv(h),l=g.create(i*k),m=g.create(e*k),n=a.BASE.multiplyUnsafe(l).add(b.multiplyUnsafe(m));return!n.is0()&&g.create(n.x)===e}catch{return!1}},recoverPublicKey:function(a,b,c={}){let{prehash:d}=li(c,o);return b=w(b,d),r.fromBytes(a,"recovered").recoverPublicKey(b).toBytes()},Signature:r,hash:b})}(function(a,b={}){let c=function(a,b,c={},d){if(void 0===d&&(d="edwards"===a),!b||"object"!=typeof b)throw Error(`expected valid ${a} CURVE object`);for(let a of["p","n","h"]){let c=b[a];if(!("bigint"==typeof c&&c>kV))throw Error(`CURVE.${a} must be positive bigint`)}let e=k5(b.p,c.Fp,d),f=k5(b.n,c.Fn,d);for(let c of["Gx","Gy","a","weierstrass"===a?"b":"d"])if(!e.isValid(b[c]))throw Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return{CURVE:b=Object.freeze(Object.assign({},b)),Fp:e,Fn:f}}("weierstrass",a,b),{Fp:d,Fn:e}=c,f=c.CURVE,{h:g,n:h}=f;kv(b,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:i}=b;if(i&&(!d.is0(f.a)||"bigint"!=typeof i.beta||!Array.isArray(i.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let j=lr(d,e);function k(){if(!d.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let l=b.toBytes||function(a,b,c){let{x:e,y:f}=b.toAffine(),g=d.toBytes(e);return(kj(c,"isCompressed"),c)?(k(),iF(lq(!d.isOdd(f)),g)):iF(Uint8Array.of(4),g,d.toBytes(f))},m=b.fromBytes||function(a){kk(a,void 0,"Point");let{publicKey:b,publicKeyUncompressed:c}=j,e=a.length,f=a[0],g=a.subarray(1);if(e===b&&(2===f||3===f)){let a,b=d.fromBytes(g);if(!d.isValid(b))throw Error("bad point: is not on curve, wrong x");let c=n(b);try{a=d.sqrt(c)}catch(a){throw Error("bad point: is not on curve, sqrt error"+(a instanceof Error?": "+a.message:""))}return k(),(1&f)==1!==d.isOdd(a)&&(a=d.neg(a)),{x:b,y:a}}if(e===c&&4===f){let a=d.BYTES,b=d.fromBytes(g.subarray(0,a)),c=d.fromBytes(g.subarray(a,2*a));if(!o(b,c))throw Error("bad point: is not on curve");return{x:b,y:c}}throw Error(`bad point: got length ${e}, expected compressed=${b} or uncompressed=${c}`)};function n(a){let b=d.sqr(a),c=d.mul(b,a);return d.add(d.add(c,d.mul(a,f.a)),f.b)}function o(a,b){let c=d.sqr(b),e=n(a);return d.eql(c,e)}if(!o(f.Gx,f.Gy))throw Error("bad curve params: generator point");let p=d.mul(d.pow(f.a,ln),lo),q=d.mul(d.sqr(f.b),BigInt(27));if(d.is0(d.add(p,q)))throw Error("bad curve params: a or b");function r(a,b,c=!1){if(!d.isValid(b)||c&&d.is0(b))throw Error(`bad point coordinate ${a}`);return b}function s(a){if(!(a instanceof x))throw Error("ProjectivePoint expected")}function t(a){if(!i||!i.basises)throw Error("no endo");return function(a,b,c){let[[d,e],[f,g]]=b,h=lg(g*a,c),i=lg(-e*a,c),j=a-h*d-i*f,k=-h*e-i*g,l=j<lk,m=k<lk;l&&(j=-j),m&&(k=-k);let n=ku(Math.ceil(kt(c)/2))+ll;if(j<lk||j>=n||k<lk||k>=n)throw Error("splitScalar (endomorphism): failed, k="+a);return{k1neg:l,k1:j,k2neg:m,k2:k}}(a,i.basises,e.ORDER)}let u=kw((a,b)=>{let{X:c,Y:e,Z:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),v=kw(a=>{if(a.is0()){if(b.allowInfinityPoint&&!d.is0(a.Y))return;throw Error("bad point: ZERO")}let{x:c,y:e}=a.toAffine();if(!d.isValid(c)||!d.isValid(e))throw Error("bad point: x or y not field elements");if(!o(c,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function w(a,b,c,e,f){return c=new x(d.mul(c.X,a),c.Y,c.Z),b=kX(e,b),c=kX(f,c),b.add(c)}class x{constructor(a,b,c){this.X=r("x",a),this.Y=r("y",b,!0),this.Z=r("z",c),Object.freeze(this)}static CURVE(){return f}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof x)throw Error("projective point not allowed");return d.is0(b)&&d.is0(c)?x.ZERO:new x(b,c,d.ONE)}static fromBytes(a){let b=x.fromAffine(m(kk(a,void 0,"point")));return b.assertValidity(),b}static fromHex(a){return x.fromBytes(kq("pointHex",a))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(a=8,b=!0){return z.createCache(this,a),b||this.multiply(ln),this}assertValidity(){v(this)}hasEvenY(){let{y:a}=this.toAffine();if(!d.isOdd)throw Error("Field doesn't support isOdd");return!d.isOdd(a)}equals(a){s(a);let{X:b,Y:c,Z:e}=this,{X:f,Y:g,Z:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new x(this.X,d.neg(this.Y),this.Z)}double(){let{a:a,b}=f,c=d.mul(b,ln),{X:e,Y:g,Z:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(e,e),m=d.mul(g,g),n=d.mul(h,h),o=d.mul(e,g);return o=d.add(o,o),k=d.mul(e,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(c,n),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(o,i),k=d.mul(c,k),n=d.mul(a,n),o=d.sub(l,n),o=d.mul(a,o),o=d.add(o,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,n),l=d.mul(l,o),j=d.add(j,l),n=d.mul(g,h),n=d.add(n,n),l=d.mul(n,o),i=d.sub(i,l),k=d.mul(n,m),k=d.add(k,k),new x(i,j,k=d.add(k,k))}add(a){s(a);let{X:b,Y:c,Z:e}=this,{X:g,Y:h,Z:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,m=f.a,n=d.mul(f.b,ln),o=d.mul(b,g),p=d.mul(c,h),q=d.mul(e,i),r=d.add(b,c),t=d.add(g,h);r=d.mul(r,t),t=d.add(o,p),r=d.sub(r,t),t=d.add(b,e);let u=d.add(g,i);return t=d.mul(t,u),u=d.add(o,q),t=d.sub(t,u),u=d.add(c,e),j=d.add(h,i),u=d.mul(u,j),j=d.add(p,q),u=d.sub(u,j),l=d.mul(m,t),j=d.mul(n,q),l=d.add(j,l),j=d.sub(p,l),l=d.add(p,l),k=d.mul(j,l),p=d.add(o,o),p=d.add(p,o),q=d.mul(m,q),t=d.mul(n,t),p=d.add(p,q),q=d.sub(o,q),q=d.mul(m,q),t=d.add(t,q),o=d.mul(p,t),k=d.add(k,o),o=d.mul(u,t),j=d.mul(r,j),j=d.sub(j,o),o=d.mul(r,p),l=d.mul(u,l),new x(j,k,l=d.add(l,o))}subtract(a){return this.add(a.negate())}is0(){return this.equals(x.ZERO)}multiply(a){let c,d,{endo:f}=b;if(!e.isValidNot0(a))throw Error("invalid scalar: out of range");let g=a=>z.cached(this,a,a=>kY(x,a));if(f){let{k1neg:b,k1:e,k2neg:h,k2:i}=t(a),{p:j,f:k}=g(e),{p:l,f:m}=g(i);d=k.add(m),c=w(f.beta,j,l,b,h)}else{let{p:b,f:e}=g(a);c=b,d=e}return kY(x,[c,d])[0]}multiplyUnsafe(a){let{endo:c}=b;if(!e.isValid(a))throw Error("invalid scalar: out of range");if(a===lk||this.is0())return x.ZERO;if(a===ll)return this;if(z.hasCache(this))return this.multiply(a);if(!c)return z.unsafe(this,a);{let{k1neg:b,k1:d,k2neg:e,k2:f}=t(a),{p1:g,p2:h}=function(a,b,c,d){let e=b,f=a.ZERO,g=a.ZERO;for(;c>kV||d>kV;)c&kW&&(f=f.add(e)),d&kW&&(g=g.add(e)),e=e.double(),c>>=kW,d>>=kW;return{p1:f,p2:g}}(x,this,d,f);return w(c.beta,g,h,b,e)}}multiplyAndAddUnsafe(a,b,c){let d=this.multiplyUnsafe(b).add(a.multiplyUnsafe(c));return d.is0()?void 0:d}toAffine(a){return u(this,a)}isTorsionFree(){let{isTorsionFree:a}=b;return g===ll||(a?a(x,this):z.unsafe(this,h).is0())}clearCofactor(){let{clearCofactor:a}=b;return g===ll?this:a?a(x,this):this.multiplyUnsafe(g)}isSmallOrder(){return this.multiplyUnsafe(g).is0()}toBytes(a=!0){return kj(a,"isCompressed"),this.assertValidity(),l(x,this,a)}toHex(a=!0){return iA(this.toBytes(a))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(a=!0){return this.toBytes(a)}_setWindowSize(a){this.precompute(a)}static normalizeZ(a){return kY(x,a)}static msm(a,b){return function(a,b,c,d){(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})})(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b);let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=kt(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=ku(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(x,e,a,b)}static fromPrivateKey(a){return x.BASE.multiply(lp(e,a))}}x.BASE=new x(f.Gx,f.Gy,d.ONE),x.ZERO=new x(d.ZERO,d.ONE,d.ZERO),x.Fp=d,x.Fn=e;let y=e.BITS,z=new k4(x,b.endo?Math.ceil(y/2):y);return x.BASE.precompute(8),x}(c,d),e,f);return b=g.Point,Object.assign({},g,{ProjectivePoint:b,CURVE:Object.assign({},a,kR(b.Fn.ORDER,b.Fn.BITS))})})({...a,hash:b});return{...c(b),create:c}}let lt={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},lu={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},lv={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},lw=kS(lt.p),lx=kS(lu.p),ly=kS(lv.p);ls({...lt,Fp:lw,lowS:!1},jd),ls({...lu,Fp:lx,lowS:!1},jf),ls({...lv,Fp:ly,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},je);let lz="base16",lA="base64pad",lB="base64url";function lC(a){let b=jd((0,an.fromString)(a,lz));return(0,am.toString)(b,lz)}function lD(a){let b=jd((0,an.fromString)(a,"utf8"));return(0,am.toString)(b,lz)}function lE(a,b,c){return`${a}?wc_ev=${c}&topic=${b}`}Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;var lF=Object.defineProperty,lG=Object.defineProperties,lH=Object.getOwnPropertyDescriptors,lI=Object.getOwnPropertySymbols,lJ=Object.prototype.hasOwnProperty,lK=Object.prototype.propertyIsEnumerable,lL=(a,b,c)=>b in a?lF(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,lM=(a,b)=>{for(var c in b||(b={}))lJ.call(b,c)&&lL(a,c,b[c]);if(lI)for(var c of lI(b))lK.call(b,c)&&lL(a,c,b[c]);return a},lN=(a,b)=>lG(a,lH(b));function lO(a){let b=[];return a.forEach(a=>{let[c,d]=a.split(":");b.push(`${c}:${d}`)}),b}function lP(a){return a.includes(":")}function lQ(a){return lP(a)?a.split(":")[0]:a}function lR(a){var b,c,d;let e={};if(!lY(a))return e;for(let[f,g]of Object.entries(a)){let a=lP(f)?[f]:g.chains,h=g.methods||[],i=g.events||[],j=lQ(f);e[j]=lN(lM({},e[j]),{chains:hX(a,null==(b=e[j])?void 0:b.chains),methods:hX(h,null==(c=e[j])?void 0:c.methods),events:hX(i,null==(d=e[j])?void 0:d.events)})}return e}function lS(a,b){var c;let d,e=(c=b=b.map(a=>a.replace("did:pkh:","")),d={},c?.forEach(a=>{var b;let[c,e]=a.split(":");d[c]||(d[c]={accounts:[],chains:[],events:[],methods:[]}),d[c].accounts.push(a),null==(b=d[c].chains)||b.push(`${c}:${e}`)}),d);for(let[b,c]of Object.entries(e))c.methods?c.methods=hX(c.methods,a):c.methods=a,c.events=["chainChanged","accountsChanged"];return e}let lT={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},lU={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function lV(a,b){let{message:c,code:d}=lU[a];return{message:b?`${c} ${b}`:c,code:d}}function lW(a,b){let{message:c,code:d}=lT[a];return{message:b?`${c} ${b}`:c,code:d}}function lX(a,b){return!!Array.isArray(a)&&(!("u">typeof b)||!a.length||a.every(b))}function lY(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function lZ(a){return typeof a>"u"}function l$(a,b){return!!(b&&lZ(a))||"string"==typeof a&&!!a.trim().length}function l_(a,b){return!!(b&&lZ(a))||"number"==typeof a&&!isNaN(a)}function l0(a){return!!(l$(a,!1)&&a.includes(":"))&&2===a.split(":").length}function l1(a){let b=!0;return lX(a)?a.length&&(b=a.every(a=>l$(a,!1))):b=!1,b}function l2(a,b){let c=null;return Object.values(a).forEach(a=>{var d;let e;if(c)return;let f=(d=`${b}, namespace`,e=null,l1(a?.methods)?l1(a?.events)||(e=lW("UNSUPPORTED_EVENTS",`${d}, events should be an array of strings or empty array for no events`)):e=lW("UNSUPPORTED_METHODS",`${d}, methods should be an array of strings or empty array for no methods`),e);f&&(c=f)}),c}function l3(a,b){let c=null;if(a&&lY(a)){let d,e=l2(a,b);e&&(c=e);let f=(d=null,Object.values(a).forEach(a=>{var c,e;let f;if(d)return;let g=(c=a?.accounts,e=`${b} namespace`,f=null,lX(c)?c.forEach(a=>{f||function(a){if(l$(a,!1)&&a.includes(":")){let b=a.split(":");if(3===b.length){let a=b[0]+":"+b[1];return!!b[2]&&l0(a)}}return!1}(a)||(f=lW("UNSUPPORTED_ACCOUNTS",`${e}, account ${a} should be a string and conform to "namespace:chainId:address" format`))}):f=lW("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),f);g&&(d=g)}),d);f&&(c=f)}else c=lV("MISSING_OR_INVALID",`${b}, namespaces should be an object with data`);return c}function l4(a){return l$(a.protocol,!0)}function l5(a){return"u">typeof a}function l6(a,b){let c;return!(!l0(b)||!(c=[],Object.values(a).forEach(a=>{c.push(...lO(a.accounts))}),c).includes(b))}function l7(a,b,c){var d,e;let f,g,h=null,i=(f={},Object.keys(d=a).forEach(a=>{var b;a.includes(":")?f[a]=d[a]:null==(b=d[a].chains)||b.forEach(b=>{f[b]={methods:d[a].methods,events:d[a].events}})}),f),j=(g={},Object.keys(e=b).forEach(a=>{if(a.includes(":"))g[a]=e[a];else{let b=lO(e[a].accounts);b?.forEach(b=>{g[b]={accounts:e[a].accounts.filter(a=>a.includes(`${b}:`)),methods:e[a].methods,events:e[a].events}})}}),g),k=Object.keys(i),l=Object.keys(j),m=l8(Object.keys(a)),n=l8(Object.keys(b)),o=m.filter(a=>!n.includes(a));return o.length&&(h=lV("NON_CONFORMING_NAMESPACES",`${c} namespaces keys don't satisfy requiredNamespaces.
      Required: ${o.toString()}
      Received: ${Object.keys(b).toString()}`)),hS(k,l)||(h=lV("NON_CONFORMING_NAMESPACES",`${c} namespaces chains don't satisfy required namespaces.
      Required: ${k.toString()}
      Approved: ${l.toString()}`)),Object.keys(b).forEach(a=>{if(!a.includes(":")||h)return;let d=lO(b[a].accounts);d.includes(a)||(h=lV("NON_CONFORMING_NAMESPACES",`${c} namespaces accounts don't satisfy namespace accounts for ${a}
        Required: ${a}
        Approved: ${d.toString()}`))}),k.forEach(a=>{h||(hS(i[a].methods,j[a].methods)?hS(i[a].events,j[a].events)||(h=lV("NON_CONFORMING_NAMESPACES",`${c} namespaces events don't satisfy namespace events for ${a}`)):h=lV("NON_CONFORMING_NAMESPACES",`${c} namespaces methods don't satisfy namespace methods for ${a}`))}),h}function l8(a){return[...new Set(a.map(a=>a.includes(":")?a.split(":")[0]:a))]}let l9={};class ma{static get(a){return l9[a]}static set(a,b){l9[a]=b}static delete(a){delete l9[a]}}function mb(a){return new Uint8Array(a.replace(/^0x/,"").match(/.{1,2}/g).map(a=>parseInt(a,16)))}let mc="client",md=`wc@2:${mc}:`,me="WALLETCONNECT_DEEPLINK_CHOICE",mf=(ac.THIRTY_DAYS,"Proposal expired"),mg=ac.SEVEN_DAYS,mh={wc_sessionPropose:{req:{ttl:ac.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ac.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:ac.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:ac.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:ac.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ac.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ac.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ac.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ac.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ac.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ac.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ac.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ac.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ac.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ac.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ac.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ac.ONE_DAY,prompt:!1,tag:1114},res:{ttl:ac.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:ac.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:ac.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:ac.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:ac.FIVE_MINUTES,prompt:!1,tag:1119}}},mi={min:ac.FIVE_MINUTES,max:ac.SEVEN_DAYS},mj="IDLE",mk="ACTIVE",ml={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},mm=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],mn="wc@1.5:auth:",mo=`${mn}:PUB_KEY`;var mp=Object.defineProperty,mq=Object.defineProperties,mr=Object.getOwnPropertyDescriptors,ms=Object.getOwnPropertySymbols,mt=Object.prototype.hasOwnProperty,mu=Object.prototype.propertyIsEnumerable,mv=(a,b,c)=>b in a?mp(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,mw=(a,b)=>{for(var c in b||(b={}))mt.call(b,c)&&mv(a,c,b[c]);if(ms)for(var c of ms(b))mu.call(b,c)&&mv(a,c,b[c]);return a},mx=(a,b,c)=>mv(a,"symbol"!=typeof b?b+"":b,c);class my extends hb{constructor(b){super(b),mx(this,"name","engine"),mx(this,"events",new s.default),mx(this,"initialized",!1),mx(this,"requestQueue",{state:mj,queue:[]}),mx(this,"sessionRequestQueue",{state:mj,queue:[]}),mx(this,"emittedSessionRequests",new h_({limit:500})),mx(this,"requestQueueDelay",ac.ONE_SECOND),mx(this,"expectedPairingMethodMap",new Map),mx(this,"recentlyDeletedMap",new Map),mx(this,"recentlyDeletedLimit",200),mx(this,"relayMessageCache",[]),mx(this,"pendingSessions",new Map),mx(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(mh)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,ac.toMiliseconds)(this.requestQueueDelay)))}),mx(this,"connect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let b=mq(mw({},a),mr({requiredNamespaces:a.requiredNamespaces||{},optionalNamespaces:a.optionalNamespaces||{}}));await this.isValidConnect(b),b.optionalNamespaces=function(a,b){var c,d,e,f,g,h;let i=lR(a),j=lR(b),k={};for(let a of Object.keys(i).concat(Object.keys(j)))k[a]={chains:hX(null==(c=i[a])?void 0:c.chains,null==(d=j[a])?void 0:d.chains),methods:hX(null==(e=i[a])?void 0:e.methods,null==(f=j[a])?void 0:f.methods),events:hX(null==(g=i[a])?void 0:g.events,null==(h=j[a])?void 0:h.events)};return k}(b.requiredNamespaces,b.optionalNamespaces),b.requiredNamespaces={};let{pairingTopic:c,requiredNamespaces:d,optionalNamespaces:e,sessionProperties:f,scopedProperties:g,relays:h}=b,i=c,j,k=!1;try{if(i){let a=this.client.core.pairing.pairings.get(i);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),k=a.active}}catch(a){throw this.client.logger.error(`connect() -> pairing.get(${i}) failed`),a}if(!i||!k){let{topic:a,uri:b}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});i=a,j=b}if(!i){let{message:a}=lV("NO_MATCHING_KEY",`connect() pairing topic: ${i}`);throw Error(a)}let l=await this.client.core.crypto.generateKeyPair(),m=mh.wc_sessionPropose.req.ttl||ac.FIVE_MINUTES,n=hU(m),o=mq(mw(mw({requiredNamespaces:d,optionalNamespaces:e,relays:h??[{protocol:"irn"}],proposer:{publicKey:l,metadata:this.client.metadata},expiryTimestamp:n,pairingTopic:i},f&&{sessionProperties:f}),g&&{scopedProperties:g}),mr({id:(0,eu.payloadId)()})),p=hW("session_connect",o.id),{reject:q,resolve:r,done:s}=hT(m,mf),t=({id:a})=>{a===o.id&&(this.client.events.off("proposal_expire",t),this.pendingSessions.delete(o.id),this.events.emit(p,{error:{message:mf,code:0}}))};return this.client.events.on("proposal_expire",t),this.events.once(p,({error:a,session:b})=>{this.client.events.off("proposal_expire",t),a?q(a):b&&r(b)}),await this.sendProposeSession({proposal:o,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:o.id}}}),await this.setProposal(o.id,o),{uri:j,approval:s}}),mx(this,"pair",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(a)}catch(a){throw this.client.logger.error("pair() failed"),a}}),mx(this,"approve",async a=>{var b,c,d;let e=this.client.core.eventClient.createEvent({properties:{topic:null==(b=a?.id)?void 0:b.toString(),trace:[e4]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(a){throw e.setError("no_internet_connection"),a}try{await this.isValidProposalId(a?.id)}catch(b){throw this.client.logger.error(`approve() -> proposal.get(${a?.id}) failed`),e.setError("proposal_not_found"),b}try{await this.isValidApprove(a)}catch(a){throw this.client.logger.error("approve() -> isValidApprove() failed"),e.setError("session_approve_namespace_validation_failure"),a}let{id:f,relayProtocol:g,namespaces:h,sessionProperties:i,scopedProperties:j,sessionConfig:k}=a,l=this.client.proposal.get(f);this.client.core.eventClient.deleteEvent({eventId:e.eventId});let{pairingTopic:m,proposer:n,requiredNamespaces:o,optionalNamespaces:p}=l,q=null==(c=this.client.core.eventClient)?void 0:c.getEvent({topic:m});q||(q=null==(d=this.client.core.eventClient)?void 0:d.createEvent({type:e4,properties:{topic:m,trace:[e4,"session_namespaces_validation_success"]}}));let r=await this.client.core.crypto.generateKeyPair(),s=n.publicKey,t=await this.client.core.crypto.generateSharedKey(r,s),u=mw(mw(mw({relay:{protocol:g??"irn"},namespaces:h,controller:{publicKey:r,metadata:this.client.metadata},expiry:hU(mg)},i&&{sessionProperties:i}),j&&{scopedProperties:j}),k&&{sessionConfig:k});q.addTrace("subscribing_session_topic");try{await this.client.core.relayer.subscribe(t,{transportType:eO,internal:{skipSubscribe:!0}})}catch(a){throw q.setError("subscribe_session_topic_failure"),a}q.addTrace("subscribe_session_topic_success");let v=mq(mw({},u),mr({topic:t,requiredNamespaces:o,optionalNamespaces:p,pairingTopic:m,acknowledged:!1,self:u.controller,peer:{publicKey:n.publicKey,metadata:n.metadata},controller:r,transportType:eO}));await this.client.session.set(t,v),q.addTrace("store_session");try{await this.sendApproveSession({sessionTopic:t,proposal:l,pairingProposalResponse:{relay:{protocol:g??"irn"},responderPublicKey:r},sessionSettleRequest:u,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:f}}}),q.addTrace("session_approve_publish_success")}catch(a){throw this.client.logger.error(a),this.client.session.delete(t,lW("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(t),a}return this.client.core.eventClient.deleteEvent({eventId:q.eventId}),await this.client.core.pairing.updateMetadata({topic:m,metadata:n.metadata}),await this.deleteProposal(f),await this.client.core.pairing.activate({topic:m}),await this.setExpiry(t,hU(mg)),{topic:t,acknowledged:()=>Promise.resolve(this.client.session.get(t))}}),mx(this,"reject",async a=>{let b;this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(a)}catch(a){throw this.client.logger.error("reject() -> isValidReject() failed"),a}let{id:c,reason:d}=a;try{b=this.client.proposal.get(c).pairingTopic}catch(a){throw this.client.logger.error(`reject() -> proposal.get(${c}) failed`),a}b&&await this.sendError({id:c,topic:b,error:d,rpcOpts:mh.wc_sessionPropose.reject}),await this.deleteProposal(c)}),mx(this,"update",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(a)}catch(a){throw this.client.logger.error("update() -> isValidUpdate() failed"),a}let{topic:b,namespaces:c}=a,{done:d,resolve:e,reject:f}=hT(),g=(0,eu.payloadId)(),h=(0,eu.getBigIntRpcId)().toString(),i=this.client.session.get(b).namespaces;return this.events.once(hW("session_update",g),({error:a})=>{a?f(a):e()}),await this.client.session.update(b,{namespaces:c}),await this.sendRequest({topic:b,method:"wc_sessionUpdate",params:{namespaces:c},throwOnFailedPublish:!0,clientRpcId:g,relayRpcId:h}).catch(a=>{this.client.logger.error(a),this.client.session.update(b,{namespaces:i}),f(a)}),{acknowledged:d}}),mx(this,"extend",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(a)}catch(a){throw this.client.logger.error("extend() -> isValidExtend() failed"),a}let{topic:b}=a,c=(0,eu.payloadId)(),{done:d,resolve:e,reject:f}=hT();return this.events.once(hW("session_extend",c),({error:a})=>{a?f(a):e()}),await this.setExpiry(b,hU(mg)),this.sendRequest({topic:b,method:"wc_sessionExtend",params:{},clientRpcId:c,throwOnFailedPublish:!0}).catch(a=>{f(a)}),{acknowledged:d}}),mx(this,"request",async a=>{this.isInitialized();try{await this.isValidRequest(a)}catch(a){throw this.client.logger.error("request() -> isValidRequest() failed"),a}let{chainId:b,request:c,topic:d,expiry:e=mh.wc_sessionRequest.req.ttl}=a,f=this.client.session.get(d);f?.transportType===eO&&await this.confirmOnlineStateOrThrow();let g=(0,eu.payloadId)(),h=(0,eu.getBigIntRpcId)().toString(),{done:i,resolve:j,reject:k}=hT(e,"Request expired. Please try again.");this.events.once(hW("session_request",g),({error:a,result:b})=>{a?k(a):j(b)});let l="wc_sessionRequest",m=this.getAppLinkIfEnabled(f.peer.metadata,f.transportType);if(m)return await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:l,params:{request:mq(mw({},c),mr({expiryTimestamp:hU(e)})),chainId:b},expiry:e,throwOnFailedPublish:!0,appLink:m}).catch(a=>k(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),await i();let n={request:mq(mw({},c),mr({expiryTimestamp:hU(e)})),chainId:b};return await Promise.all([new Promise(async a=>{await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:l,params:n,expiry:e,throwOnFailedPublish:!0,tvf:this.getTVFParams(g,n)}).catch(a=>k(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),a()}),new Promise(async a=>{var b;if(!(null!=(b=f.sessionConfig)&&b.disableDeepLink)){let a=await hZ(this.client.core.storage,me);await hY({id:g,topic:d,wcDeepLink:a})}a()}),i()]).then(a=>a[2])}),mx(this,"respond",async a=>{this.isInitialized(),await this.isValidRespond(a);let{topic:b,response:c}=a,{id:d}=c,e=this.client.session.get(b);e.transportType===eO&&await this.confirmOnlineStateOrThrow();let f=this.getAppLinkIfEnabled(e.peer.metadata,e.transportType);(0,ev.isJsonRpcResult)(c)?await this.sendResult({id:d,topic:b,result:c.result,throwOnFailedPublish:!0,appLink:f}):(0,ev.isJsonRpcError)(c)&&await this.sendError({id:d,topic:b,error:c.error,appLink:f}),this.cleanupAfterResponse(a)}),mx(this,"ping",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(a)}catch(a){throw this.client.logger.error("ping() -> isValidPing() failed"),a}let{topic:b}=a;if(this.client.session.keys.includes(b)){let a=(0,eu.payloadId)(),c=(0,eu.getBigIntRpcId)().toString(),{done:d,resolve:e,reject:f}=hT();this.events.once(hW("session_ping",a),({error:a})=>{a?f(a):e()}),await Promise.all([this.sendRequest({topic:b,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:c}),d()])}else this.client.core.pairing.pairings.keys.includes(b)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:b}))}),mx(this,"emit",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(a);let{topic:b,event:c,chainId:d}=a,e=(0,eu.getBigIntRpcId)().toString(),f=(0,eu.payloadId)();await this.sendRequest({topic:b,method:"wc_sessionEvent",params:{event:c,chainId:d},throwOnFailedPublish:!0,relayRpcId:e,clientRpcId:f})}),mx(this,"disconnect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(a);let{topic:b}=a;if(this.client.session.keys.includes(b))await this.sendRequest({topic:b,method:"wc_sessionDelete",params:lW("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:b,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(b))await this.client.core.pairing.disconnect({topic:b});else{let{message:a}=lV("MISMATCHED_TOPIC",`Session or pairing topic not found: ${b}`);throw Error(a)}}),mx(this,"find",a=>(this.isInitialized(),this.client.session.getAll().filter(b=>(function(a,b){let{requiredNamespaces:c}=b,d=Object.keys(a.namespaces),e=Object.keys(c),f=!0;return!!hS(e,d)&&(d.forEach(b=>{let{accounts:d,methods:e,events:g}=a.namespaces[b],h=lO(d),i=c[b];hS(hD(b,i),h)&&hS(i.methods,e)&&hS(i.events,g)||(f=!1)}),f)})(b,a)))),mx(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),mx(this,"authenticate",async(a,b)=>{var c,d,e,f,g;let h;this.isInitialized(),this.isValidAuthenticate(a);let i=b&&this.client.core.linkModeSupportedApps.includes(b)&&(null==(c=this.client.metadata.redirect)?void 0:c.linkMode),j=i?eN:eO;j===eO&&await this.confirmOnlineStateOrThrow();let{chains:k,statement:l="",uri:m,domain:n,nonce:o,type:p,exp:q,nbf:r,methods:s=[],expiry:t}=a,u=[...a.resources||[]],{topic:v,uri:w}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:j});this.client.logger.info({message:"Generated new pairing",pairing:{topic:v,uri:w}});let x=await this.client.core.crypto.generateKeyPair(),y=lC(x);if(await Promise.all([this.client.auth.authKeys.set(mo,{responseTopic:y,publicKey:x}),this.client.auth.pairingTopics.set(y,{topic:y,pairingTopic:v})]),await this.client.core.relayer.subscribe(y,{transportType:j}),this.client.logger.info(`sending request to new pairing topic: ${v}`),s.length>0){let a,b,{namespace:c}=hC(k[0]),h=jJ(function(a,b,c,d={}){return c?.sort((a,b)=>a.localeCompare(b)),{att:{[a]:function(a,b,c={}){return Object.assign({},...(b=b?.sort((a,b)=>a.localeCompare(b))).map(b=>({[`${a}/${b}`]:[c]})))}(b,c,d)}}}(c,"request",s));jN(u)&&(d=h,e=u.pop(),h=jJ((f=jK(d),g=jK(e),jI(f),jI(g),a=Object.keys(f.att).concat(Object.keys(g.att)).sort((a,b)=>a.localeCompare(b)),b={att:{}},a.forEach(a=>{var c,d;Object.keys((null==(c=f.att)?void 0:c[a])||{}).concat(Object.keys((null==(d=g.att)?void 0:d[a])||{})).sort((a,b)=>a.localeCompare(b)).forEach(c=>{var d,e;b.att[a]=jx(((a,b)=>{for(var c in b||(b={}))jA.call(b,c)&&jC(a,c,b[c]);if(jz)for(var c of jz(b))jB.call(b,c)&&jC(a,c,b[c]);return a})({},b.att[a]),jy({[c]:(null==(d=f.att[a])?void 0:d[c])||(null==(e=g.att[a])?void 0:e[c])}))})}),b))),u.push(h)}let z=t&&t>mh.wc_sessionAuthenticate.req.ttl?t:mh.wc_sessionAuthenticate.req.ttl,A={authPayload:{type:p??"caip122",chains:k,statement:l,aud:m,domain:n,version:"1",nonce:o,iat:new Date().toISOString(),exp:q,nbf:r,resources:u},requester:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:hU(z)},B={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:k,methods:[...new Set(["personal_sign",...s])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:v,proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:hU(mh.wc_sessionPropose.req.ttl),id:(0,eu.payloadId)()},{done:C,resolve:D,reject:E}=hT(z,"Request expired"),F=(0,eu.payloadId)(),G=hW("session_connect",B.id),H=hW("session_request",F),I=async({error:a,session:b})=>{this.events.off(H,J),a?E(a):b&&D({session:b})},J=async a=>{var c,d,e;let f;if(await this.deletePendingAuthRequest(F,{message:"fulfilled",code:0}),a.error){let b=lW("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return a.error.code===b.code?void 0:(this.events.off(G,I),E(a.error.message))}await this.deleteProposal(B.id),this.events.off(G,I);let{cacaos:g,responder:h}=a.result,i=[],k=[];for(let a of g){await jG({cacao:a,projectId:this.client.core.projectId})||(this.client.logger.error(a,"Signature verification failed"),E(lW("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:b}=a,c=jN(b.resources),d=[jE(b.iss)],e=jF(b.iss);if(c){let a=jL(c),b=jM(c);i.push(...a),d.push(...b)}for(let a of d)k.push(`${a}:${e}`)}let l=await this.client.core.crypto.generateSharedKey(x,h.publicKey);i.length>0&&(f={topic:l,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:h,controller:h.publicKey,expiry:hU(mg),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:v,namespaces:lS([...new Set(i)],[...new Set(k)]),transportType:j},await this.client.core.relayer.subscribe(l,{transportType:j}),await this.client.session.set(l,f),v&&await this.client.core.pairing.updateMetadata({topic:v,metadata:h.metadata}),f=this.client.session.get(l)),null!=(c=this.client.metadata.redirect)&&c.linkMode&&null!=(d=h.metadata.redirect)&&d.linkMode&&null!=(e=h.metadata.redirect)&&e.universal&&b&&(this.client.core.addLinkModeSupportedApp(h.metadata.redirect.universal),this.client.session.update(l,{transportType:eN})),D({auths:g,session:f})};this.events.once(G,I),this.events.once(H,J);try{if(i){let a=(0,eu.formatJsonRpcRequest)("wc_sessionAuthenticate",A,F);this.client.core.history.set(v,a);let c=await this.client.core.crypto.encode("",a,{type:2,encoding:lB});h=lE(b,v,c)}else await Promise.all([this.sendRequest({topic:v,method:"wc_sessionAuthenticate",params:A,expiry:a.expiry,throwOnFailedPublish:!0,clientRpcId:F}),this.sendRequest({topic:v,method:"wc_sessionPropose",params:B,expiry:mh.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:B.id})])}catch(a){throw this.events.off(G,I),this.events.off(H,J),a}return await this.setProposal(B.id,B),await this.setAuthRequest(F,{request:mq(mw({},A),mr({verifyContext:{}})),pairingTopic:v,transportType:j}),{uri:h??w,response:C}}),mx(this,"approveSessionAuthenticate",async a=>{let b,{id:c,auths:d}=a,e=this.client.core.eventClient.createEvent({properties:{topic:c.toString(),trace:["authenticated_session_approve_started"]}});try{this.isInitialized()}catch(a){throw e.setError("no_internet_connection"),a}let f=this.getPendingAuthRequest(c);if(!f)throw e.setError("authenticated_session_pending_request_not_found"),Error(`Could not find pending auth request with id ${c}`);let g=f.transportType||eO;g===eO&&await this.confirmOnlineStateOrThrow();let h=f.requester.publicKey,i=await this.client.core.crypto.generateKeyPair(),j=lC(h),k={type:1,receiverPublicKey:h,senderPublicKey:i},l=[],m=[];for(let a of d){if(!await jG({cacao:a,projectId:this.client.core.projectId})){e.setError("invalid_cacao");let a=lW("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:c,topic:j,error:a,encodeOpts:k}),Error(a.message)}e.addTrace("cacaos_verified");let{p:b}=a,d=jN(b.resources),f=[jE(b.iss)],g=jF(b.iss);if(d){let a=jL(d),b=jM(d);l.push(...a),f.push(...b)}for(let a of f)m.push(`${a}:${g}`)}let n=await this.client.core.crypto.generateSharedKey(i,h);if(e.addTrace("create_authenticated_session_topic"),l?.length>0){b={topic:n,acknowledged:!0,self:{publicKey:i,metadata:this.client.metadata},peer:{publicKey:h,metadata:f.requester.metadata},controller:h,expiry:hU(mg),authentication:d,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:f.pairingTopic,namespaces:lS([...new Set(l)],[...new Set(m)]),transportType:g},e.addTrace("subscribing_authenticated_session_topic");try{await this.client.core.relayer.subscribe(n,{transportType:g})}catch(a){throw e.setError("subscribe_authenticated_session_topic_failure"),a}e.addTrace("subscribe_authenticated_session_topic_success"),await this.client.session.set(n,b),e.addTrace("store_authenticated_session"),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:f.requester.metadata})}e.addTrace("publishing_authenticated_session_approve");try{await this.sendResult({topic:j,id:c,result:{cacaos:d,responder:{publicKey:i,metadata:this.client.metadata}},encodeOpts:k,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(f.requester.metadata,g)})}catch(a){throw e.setError("authenticated_session_approve_publish_failure"),a}return await this.client.auth.requests.delete(c,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:f.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:e.eventId}),{session:b}}),mx(this,"rejectSessionAuthenticate",async a=>{this.isInitialized();let{id:b,reason:c}=a,d=this.getPendingAuthRequest(b);if(!d)throw Error(`Could not find pending auth request with id ${b}`);d.transportType===eO&&await this.confirmOnlineStateOrThrow();let e=d.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),g=lC(e);await this.sendError({id:b,topic:g,error:c,encodeOpts:{type:1,receiverPublicKey:e,senderPublicKey:f},rpcOpts:mh.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(d.requester.metadata,d.transportType)}),await this.client.auth.requests.delete(b,{message:"rejected",code:0}),await this.deleteProposal(b)}),mx(this,"formatAuthMessage",a=>{this.isInitialized();let{request:b,iss:c}=a;return jH(b,c)}),mx(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{let a=this.relayMessageCache.shift();a&&await this.onRelayMessage(a)}catch(a){this.client.logger.error(a)}},50)}),mx(this,"cleanupDuplicatePairings",async a=>{if(a.pairingTopic)try{let b=this.client.core.pairing.pairings.get(a.pairingTopic),c=this.client.core.pairing.pairings.getAll().filter(c=>{var d,e;return(null==(d=c.peerMetadata)?void 0:d.url)&&(null==(e=c.peerMetadata)?void 0:e.url)===a.peer.metadata.url&&c.topic&&c.topic!==b.topic});if(0===c.length)return;this.client.logger.info(`Cleaning up ${c.length} duplicate pairing(s)`),await Promise.all(c.map(a=>this.client.core.pairing.disconnect({topic:a.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(a){this.client.logger.error(a)}}),mx(this,"deleteSession",async a=>{var b;let{topic:c,expirerHasDeleted:d=!1,emitEvent:e=!0,id:f=0}=a,{self:g}=this.client.session.get(c);await this.client.core.relayer.unsubscribe(c),await this.client.session.delete(c,lW("USER_DISCONNECTED")),this.addToRecentlyDeleted(c,"session"),this.client.core.crypto.keychain.has(g.publicKey)&&await this.client.core.crypto.deleteKeyPair(g.publicKey),this.client.core.crypto.keychain.has(c)&&await this.client.core.crypto.deleteSymKey(c),d||this.client.core.expirer.del(c),this.client.core.storage.removeItem(me).catch(a=>this.client.logger.warn(a)),this.getPendingSessionRequests().forEach(a=>{a.topic===c&&this.deletePendingSessionRequest(a.id,lW("USER_DISCONNECTED"))}),c===(null==(b=this.sessionRequestQueue.queue[0])?void 0:b.topic)&&(this.sessionRequestQueue.state=mj),e&&this.client.events.emit("session_delete",{id:f,topic:c})}),mx(this,"deleteProposal",async(a,b)=>{if(b)try{let b=this.client.proposal.get(a),c=this.client.core.eventClient.getEvent({topic:b.pairingTopic});c?.setError("proposal_expired")}catch{}await Promise.all([this.client.proposal.delete(a,lW("USER_DISCONNECTED")),b?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"proposal")}),mx(this,"deletePendingSessionRequest",async(a,b,c=!1)=>{await Promise.all([this.client.pendingRequest.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(b=>b.id!==a),c&&(this.sessionRequestQueue.state=mj,this.client.events.emit("session_request_expire",{id:a}))}),mx(this,"deletePendingAuthRequest",async(a,b,c=!1)=>{await Promise.all([this.client.auth.requests.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)])}),mx(this,"setExpiry",async(a,b)=>{this.client.session.keys.includes(a)&&(this.client.core.expirer.set(a,b),await this.client.session.update(a,{expiry:b}))}),mx(this,"setProposal",async(a,b)=>{this.client.core.expirer.set(a,hU(mh.wc_sessionPropose.req.ttl)),await this.client.proposal.set(a,b)}),mx(this,"setAuthRequest",async(a,b)=>{let{request:c,pairingTopic:d,transportType:e=eO}=b;this.client.core.expirer.set(a,c.expiryTimestamp),await this.client.auth.requests.set(a,{authPayload:c.authPayload,requester:c.requester,expiryTimestamp:c.expiryTimestamp,id:a,pairingTopic:d,verifyContext:c.verifyContext,transportType:e})}),mx(this,"setPendingSessionRequest",async a=>{let{id:b,topic:c,params:d,verifyContext:e}=a,f=d.request.expiryTimestamp||hU(mh.wc_sessionRequest.req.ttl);this.client.core.expirer.set(b,f),await this.client.pendingRequest.set(b,{id:b,topic:c,params:d,verifyContext:e})}),mx(this,"sendRequest",async b=>{let c,d,{topic:e,method:f,params:g,expiry:h,relayRpcId:i,clientRpcId:j,throwOnFailedPublish:k,appLink:l,tvf:m,publishOpts:n={}}=b,o=(0,eu.formatJsonRpcRequest)(f,g,j),p=!!l;try{let a=p?lB:lA;c=await this.client.core.crypto.encode(e,o,{encoding:a})}catch(a){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${e} failed`),a}if(mm.includes(f)){let a=lD(JSON.stringify(o)),b=lD(c);d=await this.client.core.verify.register({id:b,decryptedId:a})}let q=mw(mw({},mh[f].req),n);if(q.attestation=d,h&&(q.ttl=h),i&&(q.id=i),this.client.core.history.set(e,o),p){let b=lE(l,e,c);await a.g.Linking.openURL(b,this.client.name)}else{let a;q.tvf=mq(mw({},m),mr({correlationId:o.id})),k?(a=mw({},q.internal),q.internal=mq(a,mr({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(e,c,q)):this.client.core.relayer.publish(e,c,q).catch(a=>this.client.logger.error(a))}return o.id}),mx(this,"sendProposeSession",async a=>{let{proposal:b,publishOpts:c}=a,d=(0,eu.formatJsonRpcRequest)("wc_sessionPropose",b,b.id);this.client.core.history.set(b.pairingTopic,d);let e=await this.client.core.crypto.encode(b.pairingTopic,d,{encoding:lA}),f=lD(JSON.stringify(d)),g=lD(e),h=await this.client.core.verify.register({id:g,decryptedId:f});await this.client.core.relayer.publishCustom({payload:{pairingTopic:b.pairingTopic,sessionProposal:e},opts:mq(mw({},c),mr({publishMethod:"wc_proposeSession",attestation:h}))})}),mx(this,"sendApproveSession",async a=>{let{sessionTopic:b,pairingProposalResponse:c,proposal:d,sessionSettleRequest:e,publishOpts:f}=a,g=(0,eu.formatJsonRpcResult)(d.id,c),h=await this.client.core.crypto.encode(d.pairingTopic,g,{encoding:lA}),i=(0,eu.formatJsonRpcRequest)("wc_sessionSettle",e,f?.id),j=await this.client.core.crypto.encode(b,i,{encoding:lA});this.client.core.history.set(b,i),await this.client.core.relayer.publishCustom({payload:{sessionTopic:b,pairingTopic:d.pairingTopic,sessionProposalResponse:h,sessionSettlementRequest:j},opts:mq(mw({},f),mr({publishMethod:"wc_approveSession"}))})}),mx(this,"sendResult",async b=>{let c,d,e,{id:f,topic:g,result:h,throwOnFailedPublish:i,encodeOpts:j,appLink:k}=b,l=(0,eu.formatJsonRpcResult)(f,h),m=k&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a,b,d=m?lB:lA;c=await this.client.core.crypto.encode(g,l,(a=mw({},j||{}),b={encoding:d},mq(a,mr(b))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${g} failed`),a}try{let a=(d=await this.client.core.history.get(g,f)).request;try{e=this.getTVFParams(f,a.params,h)}catch(a){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${a?.message}`)}}catch(a){throw this.client.logger.error(`sendResult() -> history.get(${g}, ${f}) failed`),a}if(m){let b=lE(k,g,c);await a.g.Linking.openURL(b,this.client.name)}else{let a,b=mh[d.request.method].res;b.tvf=mq(mw({},e),mr({correlationId:f})),i?(a=mw({},b.internal),b.internal=mq(a,mr({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(g,c,b)):this.client.core.relayer.publish(g,c,b).catch(a=>this.client.logger.error(a))}await this.client.core.history.resolve(l)}),mx(this,"sendError",async b=>{let c,d,{id:e,topic:f,error:g,encodeOpts:h,rpcOpts:i,appLink:j}=b,k=(0,eu.formatJsonRpcError)(e,g),l=j&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a,b,d=l?lB:lA;c=await this.client.core.crypto.encode(f,k,(a=mw({},h||{}),b={encoding:d},mq(a,mr(b))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${f} failed`),a}try{d=await this.client.core.history.get(f,e)}catch(a){throw this.client.logger.error(`sendError() -> history.get(${f}, ${e}) failed`),a}if(l){let b=lE(j,f,c);await a.g.Linking.openURL(b,this.client.name)}else{let a=d.request.method,b=i||mh[a].res;this.client.core.relayer.publish(f,c,b)}await this.client.core.history.resolve(k)}),mx(this,"cleanup",async()=>{let a=[],b=[];this.client.session.getAll().forEach(b=>{let c=!1;hV(b.expiry)&&(c=!0),this.client.core.crypto.keychain.has(b.topic)||(c=!0),c&&a.push(b.topic)}),this.client.proposal.getAll().forEach(a=>{hV(a.expiryTimestamp)&&b.push(a.id)}),await Promise.all([...a.map(a=>this.deleteSession({topic:a})),...b.map(a=>this.deleteProposal(a))])}),mx(this,"onProviderMessageEvent",async a=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(a):await this.onRelayMessage(a)}),mx(this,"onRelayEventRequest",async a=>{this.requestQueue.queue.push(a),await this.processRequestsQueue()}),mx(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===mk)return void this.client.logger.info("Request queue already active, skipping...");for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=mk;let a=this.requestQueue.queue.shift();if(a)try{await this.processRequest(a)}catch(a){this.client.logger.warn(a)}}this.requestQueue.state=mj}),mx(this,"processRequest",async a=>{let{topic:b,payload:c,attestation:d,transportType:e,encryptedId:f}=a,g=c.method;if(!this.shouldIgnorePairingRequest({topic:b,requestMethod:g}))switch(g){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:b,payload:c,attestation:d,encryptedId:f});case"wc_sessionSettle":return await this.onSessionSettleRequest(b,c);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(b,c);case"wc_sessionExtend":return await this.onSessionExtendRequest(b,c);case"wc_sessionPing":return await this.onSessionPingRequest(b,c);case"wc_sessionDelete":return await this.onSessionDeleteRequest(b,c);case"wc_sessionRequest":return await this.onSessionRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});case"wc_sessionEvent":return await this.onSessionEventRequest(b,c);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});default:return this.client.logger.info(`Unsupported request method ${g}`)}}),mx(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c,transportType:d}=a,e=(await this.client.core.history.get(b,c.id)).request.method;switch(e){case"wc_sessionPropose":return this.onSessionProposeResponse(b,c,d);case"wc_sessionSettle":return this.onSessionSettleResponse(b,c);case"wc_sessionUpdate":return this.onSessionUpdateResponse(b,c);case"wc_sessionExtend":return this.onSessionExtendResponse(b,c);case"wc_sessionPing":return this.onSessionPingResponse(b,c);case"wc_sessionRequest":return this.onSessionRequestResponse(b,c);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(b,c);default:return this.client.logger.info(`Unsupported response method ${e}`)}}),mx(this,"onRelayEventUnknownPayload",a=>{let{topic:b}=a,{message:c}=lV("MISSING_OR_INVALID",`Decoded payload on topic ${b} is not identifiable as a JSON-RPC request or a response.`);throw Error(c)}),mx(this,"shouldIgnorePairingRequest",a=>{let{topic:b,requestMethod:c}=a,d=this.expectedPairingMethodMap.get(b);return!(!d||d.includes(c))&&!!(d.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),mx(this,"onSessionProposeRequest",async a=>{let{topic:b,payload:c,attestation:d,encryptedId:e}=a,{params:f,id:g}=c;try{let a=this.client.core.eventClient.getEvent({topic:b});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),a?.setError("proposal_listener_not_found")),this.isValidConnect(mw({},c.params));let h=f.expiryTimestamp||hU(mh.wc_sessionPropose.req.ttl),i=mw({id:g,pairingTopic:b,expiryTimestamp:h,attestation:d,encryptedId:e},f);await this.setProposal(g,i);let j=await this.getVerifyContext({attestationId:d,hash:lD(JSON.stringify(c)),encryptedId:e,metadata:i.proposer.metadata});a?.addTrace("emit_session_proposal"),this.client.events.emit("session_proposal",{id:g,params:i,verifyContext:j})}catch(a){await this.sendError({id:g,topic:b,error:a,rpcOpts:mh.wc_sessionPropose.autoReject}),this.client.logger.error(a)}}),mx(this,"onSessionProposeResponse",async(a,b,c)=>{let{id:d}=b;if((0,ev.isJsonRpcResult)(b)){let{result:e}=b;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:e});let f=this.client.proposal.get(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});let g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});let h=e.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});let i=await this.client.core.crypto.generateSharedKey(g,h);this.pendingSessions.set(d,{sessionTopic:i,pairingTopic:a,proposalId:d,publicKey:g});let j=await this.client.core.relayer.subscribe(i,{transportType:c});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:j}),await this.client.core.pairing.activate({topic:a})}else if((0,ev.isJsonRpcError)(b)){await this.deleteProposal(d);let a=hW("session_connect",d);if(0===this.events.listenerCount(a))throw Error(`emitting ${a} without any listeners, 954`);this.events.emit(a,{error:b.error})}}),mx(this,"onSessionSettleRequest",async(a,b)=>{let{id:c,params:d}=b;try{let c,e;this.isValidSessionSettleRequest(d);let{relay:f,controller:g,expiry:h,namespaces:i,sessionProperties:j,scopedProperties:k,sessionConfig:l}=b.params,m=[...this.pendingSessions.values()].find(b=>b.sessionTopic===a);if(!m)return this.client.logger.error(`Pending session not found for topic ${a}`);let n=this.client.proposal.get(m.proposalId),o=(c=mw(mw(mw({topic:a,relay:f,expiry:h,namespaces:i,acknowledged:!0,pairingTopic:m.pairingTopic,requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,controller:g.publicKey,self:{publicKey:m.publicKey,metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},j&&{sessionProperties:j}),k&&{scopedProperties:k}),l&&{sessionConfig:l}),e={transportType:eO},mq(c,mr(e)));await this.client.session.set(o.topic,o),await this.setExpiry(o.topic,o.expiry),await this.client.core.pairing.updateMetadata({topic:m.pairingTopic,metadata:o.peer.metadata}),this.client.events.emit("session_connect",{session:o}),this.events.emit(hW("session_connect",m.proposalId),{session:o}),this.pendingSessions.delete(m.proposalId),this.deleteProposal(m.proposalId,!1),this.cleanupDuplicatePairings(o),await this.sendResult({id:b.id,topic:a,result:!0})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),mx(this,"onSessionSettleResponse",async(a,b)=>{let{id:c}=b;(0,ev.isJsonRpcResult)(b)?(await this.client.session.update(a,{acknowledged:!0}),this.events.emit(hW("session_approve",c),{})):(0,ev.isJsonRpcError)(b)&&(await this.client.session.delete(a,lW("USER_DISCONNECTED")),this.events.emit(hW("session_approve",c),{error:b.error}))}),mx(this,"onSessionUpdateRequest",async(a,b)=>{let{params:c,id:d}=b;try{let b=`${a}_session_update`,e=ma.get(b);if(e&&this.isRequestOutOfSync(e,d)){this.client.logger.warn(`Discarding out of sync request - ${d}`),this.sendError({id:d,topic:a,error:lW("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(mw({topic:a},c));try{ma.set(b,d),await this.client.session.update(a,{namespaces:c.namespaces}),await this.sendResult({id:d,topic:a,result:!0})}catch(a){throw ma.delete(b),a}this.client.events.emit("session_update",{id:d,topic:a,params:c})}catch(b){await this.sendError({id:d,topic:a,error:b}),this.client.logger.error(b)}}),mx(this,"isRequestOutOfSync",(a,b)=>b.toString().slice(0,-3)<a.toString().slice(0,-3)),mx(this,"onSessionUpdateResponse",(a,b)=>{let{id:c}=b,d=hW("session_update",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,ev.isJsonRpcResult)(b)?this.events.emit(hW("session_update",c),{}):(0,ev.isJsonRpcError)(b)&&this.events.emit(hW("session_update",c),{error:b.error})}),mx(this,"onSessionExtendRequest",async(a,b)=>{let{id:c}=b;try{this.isValidExtend({topic:a}),await this.setExpiry(a,hU(mg)),await this.sendResult({id:c,topic:a,result:!0}),this.client.events.emit("session_extend",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),mx(this,"onSessionExtendResponse",(a,b)=>{let{id:c}=b,d=hW("session_extend",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,ev.isJsonRpcResult)(b)?this.events.emit(hW("session_extend",c),{}):(0,ev.isJsonRpcError)(b)&&this.events.emit(hW("session_extend",c),{error:b.error})}),mx(this,"onSessionPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult({id:c,topic:a,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),mx(this,"onSessionPingResponse",(a,b)=>{let{id:c}=b,d=hW("session_ping",c);setTimeout(()=>{if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners 2176`);(0,ev.isJsonRpcResult)(b)?this.events.emit(hW("session_ping",c),{}):(0,ev.isJsonRpcError)(b)&&this.events.emit(hW("session_ping",c),{error:b.error})},500)}),mx(this,"onSessionDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a,reason:b.params}),await Promise.all([new Promise(b=>{this.client.core.relayer.once(eH,async()=>{b(await this.deleteSession({topic:a,id:c}))})}),this.sendResult({id:c,topic:a,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:a,error:lW("USER_DISCONNECTED")})]).catch(a=>this.client.logger.error(a))}catch(a){this.client.logger.error(a)}}),mx(this,"onSessionRequest",async a=>{var b,c,d;let{topic:e,payload:f,attestation:g,encryptedId:h,transportType:i}=a,{id:j,params:k}=f;try{await this.isValidRequest(mw({topic:e},k));let a=this.client.session.get(e),f=await this.getVerifyContext({attestationId:g,hash:lD(JSON.stringify((0,eu.formatJsonRpcRequest)("wc_sessionRequest",k,j))),encryptedId:h,metadata:a.peer.metadata,transportType:i}),l={id:j,topic:e,params:k,verifyContext:f};await this.setPendingSessionRequest(l),i===eN&&null!=(b=a.peer.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(null==(c=a.peer.metadata.redirect)?void 0:c.universal),null!=(d=this.client.signConfig)&&d.disableRequestQueue?this.emitSessionRequest(l):(this.addSessionRequestToSessionRequestQueue(l),this.processSessionRequestQueue())}catch(a){await this.sendError({id:j,topic:e,error:a}),this.client.logger.error(a)}}),mx(this,"onSessionRequestResponse",(a,b)=>{let{id:c}=b,d=hW("session_request",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,ev.isJsonRpcResult)(b)?this.events.emit(hW("session_request",c),{result:b.result}):(0,ev.isJsonRpcError)(b)&&this.events.emit(hW("session_request",c),{error:b.error})}),mx(this,"onSessionEventRequest",async(a,b)=>{let{id:c,params:d}=b;try{let b=`${a}_session_event_${d.event.name}`,e=ma.get(b);if(e&&this.isRequestOutOfSync(e,c))return void this.client.logger.info(`Discarding out of sync request - ${c}`);this.isValidEmit(mw({topic:a},d)),this.client.events.emit("session_event",{id:c,topic:a,params:d}),ma.set(b,c)}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),mx(this,"onSessionAuthenticateResponse",(a,b)=>{let{id:c}=b;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:a,payload:b}),(0,ev.isJsonRpcResult)(b)?this.events.emit(hW("session_request",c),{result:b.result}):(0,ev.isJsonRpcError)(b)&&this.events.emit(hW("session_request",c),{error:b.error})}),mx(this,"onSessionAuthenticateRequest",async a=>{var b;let{topic:c,payload:d,attestation:e,encryptedId:f,transportType:g}=a;try{let{requester:a,authPayload:h,expiryTimestamp:i}=d.params,j=await this.getVerifyContext({attestationId:e,hash:lD(JSON.stringify(d)),encryptedId:f,metadata:a.metadata,transportType:g}),k={requester:a,pairingTopic:c,id:d.id,authPayload:h,verifyContext:j,expiryTimestamp:i};await this.setAuthRequest(d.id,{request:k,pairingTopic:c,transportType:g}),g===eN&&null!=(b=a.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(a.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:c,params:d.params,id:d.id,verifyContext:j})}catch(f){this.client.logger.error(f);let a=d.params.requester.publicKey,b=await this.client.core.crypto.generateKeyPair(),e=this.getAppLinkIfEnabled(d.params.requester.metadata,g);await this.sendError({id:d.id,topic:c,error:f,encodeOpts:{type:1,receiverPublicKey:a,senderPublicKey:b},rpcOpts:mh.wc_sessionAuthenticate.autoReject,appLink:e})}}),mx(this,"addSessionRequestToSessionRequestQueue",a=>{this.sessionRequestQueue.queue.push(a)}),mx(this,"cleanupAfterResponse",a=>{this.deletePendingSessionRequest(a.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=mj,this.processSessionRequestQueue()},(0,ac.toMiliseconds)(this.requestQueueDelay))}),mx(this,"cleanupPendingSentRequestsForTopic",({topic:a,error:b})=>{let c=this.client.core.history.pending;c.length>0&&c.filter(b=>b.topic===a&&"wc_sessionRequest"===b.request.method).forEach(a=>{let c=hW("session_request",a.request.id);if(0===this.events.listenerCount(c))throw Error(`emitting ${c} without any listeners`);this.events.emit(hW("session_request",a.request.id),{error:b})})}),mx(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===mk)return void this.client.logger.info("session request queue is already active.");let a=this.sessionRequestQueue.queue[0];if(!a)return void this.client.logger.info("session request queue is empty.");try{this.emitSessionRequest(a)}catch(a){this.client.logger.error(a)}}),mx(this,"emitSessionRequest",a=>{this.emittedSessionRequests.has(a.id)?this.client.logger.warn({id:a.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${a.id}`):(this.sessionRequestQueue.state=mk,this.emittedSessionRequests.add(a.id),this.client.events.emit("session_request",a))}),mx(this,"onPairingCreated",a=>{if(a.methods&&this.expectedPairingMethodMap.set(a.topic,a.methods),a.active)return;let b=this.client.proposal.getAll().find(b=>b.pairingTopic===a.topic);b&&this.onSessionProposeRequest({topic:a.topic,payload:(0,eu.formatJsonRpcRequest)("wc_sessionPropose",mq(mw({},b),mr({requiredNamespaces:b.requiredNamespaces,optionalNamespaces:b.optionalNamespaces,relays:b.relays,proposer:b.proposer,sessionProperties:b.sessionProperties,scopedProperties:b.scopedProperties})),b.id),attestation:b.attestation,encryptedId:b.encryptedId})}),mx(this,"isValidConnect",async a=>{let b;if(!l5(a)){let{message:b}=lV("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(a)}`);throw Error(b)}let{pairingTopic:c,requiredNamespaces:d,optionalNamespaces:e,sessionProperties:f,scopedProperties:g,relays:h}=a;if(lZ(c)||await this.isValidPairingTopic(c),b=!1,h?h&&lX(h)&&h.length&&h.forEach(a=>{b=l4(a)}):b=!0,!b){let{message:a}=lV("MISSING_OR_INVALID",`connect() relays: ${h}`);throw Error(a)}if(!lZ(d)&&0!==lY(d)){let a="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(a):this.client.logger.warn(a),this.validateNamespaces(d,"requiredNamespaces")}if(lZ(e)||0===lY(e)||this.validateNamespaces(e,"optionalNamespaces"),lZ(f)||this.validateSessionProps(f,"sessionProperties"),!lZ(g)){this.validateSessionProps(g,"scopedProperties");let a=Object.keys(d||{}).concat(Object.keys(e||{}));if(!Object.keys(g).every(b=>a.includes(b.split(":")[0])))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(g)}, required/optional namespaces: ${JSON.stringify(a)}`)}}),mx(this,"validateNamespaces",(a,b)=>{let c=function(a,b,c){let d=null;if(a&&lY(a)){let e,f=l2(a,b);f&&(d=f);let g=(e=null,Object.entries(a).forEach(([a,d])=>{var f,g;let h;if(e)return;let i=(f=hD(a,d),g=`${b} ${c}`,h=null,lX(f)&&f.length?f.forEach(a=>{h||l0(a)||(h=lW("UNSUPPORTED_CHAINS",`${g}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):l0(a)||(h=lW("UNSUPPORTED_CHAINS",`${g}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),h);i&&(e=i)}),e);g&&(d=g)}else d=lV("MISSING_OR_INVALID",`${b}, ${c} should be an object with data`);return d}(a,"connect()",b);if(c)throw Error(c.message)}),mx(this,"isValidApprove",async a=>{if(!l5(a))throw Error(lV("MISSING_OR_INVALID",`approve() params: ${a}`).message);let{id:b,namespaces:c,relayProtocol:d,sessionProperties:e,scopedProperties:f}=a;this.checkRecentlyDeleted(b),await this.isValidProposalId(b);let g=this.client.proposal.get(b),h=l3(c,"approve()");if(h)throw Error(h.message);let i=l7(g.requiredNamespaces,c,"approve()");if(i)throw Error(i.message);if(!l$(d,!0)){let{message:a}=lV("MISSING_OR_INVALID",`approve() relayProtocol: ${d}`);throw Error(a)}if(lZ(e)||this.validateSessionProps(e,"sessionProperties"),!lZ(f)){this.validateSessionProps(f,"scopedProperties");let a=new Set(Object.keys(c));if(!Object.keys(f).every(b=>a.has(b.split(":")[0])))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(f)}, approved namespaces: ${Array.from(a).join(", ")}`)}}),mx(this,"isValidReject",async a=>{if(!l5(a)){let{message:b}=lV("MISSING_OR_INVALID",`reject() params: ${a}`);throw Error(b)}let{id:b,reason:c}=a;if(this.checkRecentlyDeleted(b),await this.isValidProposalId(b),!c||"object"!=typeof c||!c.code||!l_(c.code,!1)||!c.message||!l$(c.message,!1)){let{message:a}=lV("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(c)}`);throw Error(a)}}),mx(this,"isValidSessionSettleRequest",a=>{let b;if(!l5(a)){let{message:b}=lV("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${a}`);throw Error(b)}let{relay:c,controller:d,namespaces:e,expiry:f}=a;if(!l4(c)){let{message:a}=lV("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw Error(a)}let g=(b=null,l$(d?.publicKey,!1)||(b=lV("MISSING_OR_INVALID","onSessionSettleRequest() controller public key should be a string")),b);if(g)throw Error(g.message);let h=l3(e,"onSessionSettleRequest()");if(h)throw Error(h.message);if(hV(f)){let{message:a}=lV("EXPIRED","onSessionSettleRequest()");throw Error(a)}}),mx(this,"isValidUpdate",async a=>{if(!l5(a)){let{message:b}=lV("MISSING_OR_INVALID",`update() params: ${a}`);throw Error(b)}let{topic:b,namespaces:c}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b);let d=this.client.session.get(b),e=l3(c,"update()");if(e)throw Error(e.message);let f=l7(d.requiredNamespaces,c,"update()");if(f)throw Error(f.message)}),mx(this,"isValidExtend",async a=>{if(!l5(a)){let{message:b}=lV("MISSING_OR_INVALID",`extend() params: ${a}`);throw Error(b)}let{topic:b}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b)}),mx(this,"isValidRequest",async a=>{var b;let c;if(!l5(a)){let{message:b}=lV("MISSING_OR_INVALID",`request() params: ${a}`);throw Error(b)}let{topic:d,request:e,chainId:f,expiry:g}=a;this.checkRecentlyDeleted(d),await this.isValidSessionTopic(d);let{namespaces:h}=this.client.session.get(d);if(!l6(h,f)){let{message:a}=lV("MISSING_OR_INVALID",`request() chainId: ${f}`);throw Error(a)}if(lZ(e)||!l$(e.method,!1)){let{message:a}=lV("MISSING_OR_INVALID",`request() ${JSON.stringify(e)}`);throw Error(a)}if(!(l$(b=e.method,!1)&&(c=[],Object.values(h).forEach(a=>{lO(a.accounts).includes(f)&&c.push(...a.methods)}),c).includes(b))){let{message:a}=lV("MISSING_OR_INVALID",`request() method: ${e.method}`);throw Error(a)}if(g&&(!l_(g,!1)||!(g<=mi.max)||!(g>=mi.min))){let{message:a}=lV("MISSING_OR_INVALID",`request() expiry: ${g}. Expiry must be a number (in seconds) between ${mi.min} and ${mi.max}`);throw Error(a)}}),mx(this,"isValidRespond",async a=>{var b;if(!l5(a)){let{message:b}=lV("MISSING_OR_INVALID",`respond() params: ${a}`);throw Error(b)}let{topic:c,response:d}=a;try{await this.isValidSessionTopic(c)}catch(c){throw null!=(b=a?.response)&&b.id&&this.cleanupAfterResponse(a),c}if(lZ(d)||lZ(d.result)&&lZ(d.error)||!l_(d.id,!1)||!l$(d.jsonrpc,!1)){let{message:a}=lV("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(d)}`);throw Error(a)}}),mx(this,"isValidPing",async a=>{if(!l5(a)){let{message:b}=lV("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),mx(this,"isValidEmit",async a=>{var b;let c;if(!l5(a)){let{message:b}=lV("MISSING_OR_INVALID",`emit() params: ${a}`);throw Error(b)}let{topic:d,event:e,chainId:f}=a;await this.isValidSessionTopic(d);let{namespaces:g}=this.client.session.get(d);if(!l6(g,f)){let{message:a}=lV("MISSING_OR_INVALID",`emit() chainId: ${f}`);throw Error(a)}if(lZ(e)||!l$(e.name,!1)||!(l$(b=e.name,!1)&&(c=[],Object.values(g).forEach(a=>{lO(a.accounts).includes(f)&&c.push(...a.events)}),c).includes(b))){let{message:a}=lV("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(e)}`);throw Error(a)}}),mx(this,"isValidDisconnect",async a=>{if(!l5(a)){let{message:b}=lV("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),mx(this,"isValidAuthenticate",a=>{let{chains:b,uri:c,domain:d,nonce:e}=a;if(!Array.isArray(b)||0===b.length)throw Error("chains is required and must be a non-empty array");if(!l$(c,!1))throw Error("uri is required parameter");if(!l$(d,!1))throw Error("domain is required parameter");if(!l$(e,!1))throw Error("nonce is required parameter");if([...new Set(b.map(a=>hC(a).namespace))].length>1)throw Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:f}=hC(b[0]);if("eip155"!==f)throw Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),mx(this,"getVerifyContext",async a=>{let{attestationId:b,hash:c,encryptedId:d,metadata:e,transportType:f}=a,g={verified:{verifyUrl:e.verifyUrl||e0,validation:"UNKNOWN",origin:e.url||""}};try{if(f===eN){let a=this.getAppLinkIfEnabled(e,f);return g.verified.validation=a&&new URL(a).origin===new URL(e.url).origin?"VALID":"INVALID",g}let a=await this.client.core.verify.resolve({attestationId:b,hash:c,encryptedId:d,verifyUrl:e.verifyUrl});a&&(g.verified.origin=a.origin,g.verified.isScam=a.isScam,g.verified.validation=a.origin===new URL(e.url).origin?"VALID":"INVALID")}catch(a){this.client.logger.warn(a)}return this.client.logger.debug(`Verify context: ${JSON.stringify(g)}`),g}),mx(this,"validateSessionProps",(a,b)=>{Object.values(a).forEach((c,d)=>{if(null==c){let{message:e}=lV("MISSING_OR_INVALID",`${b} must contain an existing value for each key. Received: ${c} for key ${Object.keys(a)[d]}`);throw Error(e)}})}),mx(this,"getPendingAuthRequest",a=>{let b=this.client.auth.requests.get(a);return"object"==typeof b?b:void 0}),mx(this,"addToRecentlyDeleted",(a,b)=>{if(this.recentlyDeletedMap.set(a,b),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let a=0,b=this.recentlyDeletedLimit/2;for(let c of this.recentlyDeletedMap.keys()){if(a++>=b)break;this.recentlyDeletedMap.delete(c)}}}),mx(this,"checkRecentlyDeleted",a=>{let b=this.recentlyDeletedMap.get(a);if(b){let{message:c}=lV("MISSING_OR_INVALID",`Record was recently deleted - ${b}: ${a}`);throw Error(c)}}),mx(this,"isLinkModeEnabled",(b,c)=>{var d,e,f,g,h,i,j,k,l;return!!b&&c===eN&&(null==(e=null==(d=this.client.metadata)?void 0:d.redirect)?void 0:e.linkMode)===!0&&(null==(g=null==(f=this.client.metadata)?void 0:f.redirect)?void 0:g.universal)!==void 0&&(null==(i=null==(h=this.client.metadata)?void 0:h.redirect)?void 0:i.universal)!==""&&(null==(j=b?.redirect)?void 0:j.universal)!==void 0&&(null==(k=b?.redirect)?void 0:k.universal)!==""&&(null==(l=b?.redirect)?void 0:l.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(b.redirect.universal)&&"u">typeof(null==a.g?void 0:a.g.Linking)}),mx(this,"getAppLinkIfEnabled",(a,b)=>{var c;return this.isLinkModeEnabled(a,b)?null==(c=a?.redirect)?void 0:c.universal:void 0}),mx(this,"handleLinkModeMessage",({url:a})=>{if(!a||!a.includes("wc_ev")||!a.includes("topic"))return;let b=h$(a,"topic")||"",c=decodeURIComponent(h$(a,"wc_ev")||""),d=this.client.session.keys.includes(b);d&&this.client.session.update(b,{transportType:eN}),this.client.core.dispatchEnvelope({topic:b,message:c,sessionExists:d})}),mx(this,"registerLinkModeListeners",async()=>{var b;if("u">typeof process&&"true"===process.env.IS_VITEST||hQ()&&null!=(b=this.client.metadata.redirect)&&b.linkMode){let b=null==a.g?void 0:a.g.Linking;if("u">typeof b){b.addEventListener("url",this.handleLinkModeMessage,this.client.name);let a=await b.getInitialURL();a&&setTimeout(()=>{this.handleLinkModeMessage({url:a})},50)}}}),mx(this,"getTVFParams",(a,b,c)=>{var d,e,f;if(!(null!=(d=b.request)&&d.method))return{};let g={correlationId:a,rpcMethods:[b.request.method],chainId:b.chainId};try{g.txHashes=this.extractTxHashesFromResult(b.request,c),g.contractAddresses=this.isValidContractData(b.request.params)?[null==(f=null==(e=b.request.params)?void 0:e[0])?void 0:f.to]:[]}catch(a){this.client.logger.warn("Error getting TVF params",a)}return g}),mx(this,"isValidContractData",a=>{var b;if(!a)return!1;try{let c=a?.data||(null==(b=a?.[0])?void 0:b.data);if(!c.startsWith("0x"))return!1;let d=c.slice(2);return!!/^[0-9a-fA-F]*$/.test(d)&&d.length%2==0}catch{}return!1}),mx(this,"extractTxHashesFromResult",(a,b)=>{var c,d,e,f,g;try{if(!b)return[];let h=a.method,i=ml[h];if("sui_signTransaction"===h){let a,c,d,f;return[(e=b.transactionBytes,a=new Uint8Array(Buffer.from(e,"base64")),c=Array.from("TransactionData::").map(a=>a.charCodeAt(0)),(d=new Uint8Array(c.length+a.length)).set(c),d.set(a,c.length),f=jo(d,{dkLen:32}),ai.default.encode(f))]}if("near_signTransaction"===h)return[jt(b)];if("near_signTransactions"===h)return b.map(a=>jt(a));if("xrpl_signTransactionFor"===h||"xrpl_signTransaction"===h)return[null==(c=b.tx_json)?void 0:c.hash];if("polkadot_signTransaction"===h){let c,e,f,g;return[(d={transaction:a.params.transactionPayload,signature:b.signature},f=Uint8Array.from(Buffer.from(d.signature,"hex")),g=function({publicKey:a,signature:b,payload:c}){var d,e,f;let g,h=mb(c.method),i=128|parseInt((null==(d=c.version)?void 0:d.toString())||"4"),j=(e=c.address,g=ai.default.decode(e)[0],42===g?0:60===g?2:1),k="00"===c.era?new Uint8Array([0]):mb(c.era);if(1!==k.length&&2!==k.length)throw Error("Invalid era length");let l=parseInt(c.nonce,16),m=new Uint8Array([255&l,l>>8&255]),n=new Uint8Array([0,...a,j,...b,...k,...m,...function(a){if(a<BigInt(1)<<BigInt(6))return new Uint8Array([Number(a<<BigInt(2))]);if(a<BigInt(1)<<BigInt(14)){let b=a<<BigInt(2)|BigInt(1);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255))])}if(a<BigInt(1)<<BigInt(30)){let b=a<<BigInt(2)|BigInt(2);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255)),Number(b>>BigInt(16)&BigInt(255)),Number(b>>BigInt(24)&BigInt(255))])}throw Error("BigInt compact encoding not supported > 2^30")}(BigInt(`0x${(f=c.tip).startsWith("0x")?f.slice(2):f}`)),...h]);return new Uint8Array([...function(a){if(a<64)return new Uint8Array([a<<2]);if(a<16384){let b=a<<2|1;return new Uint8Array([255&b,b>>8&255])}if(a<0x40000000){let b=a<<2|2;return new Uint8Array([255&b,b>>8&255,b>>16&255,b>>24&255])}throw Error("Compact encoding > 2^30 not supported")}(n.length+1),i,...n])}({publicKey:function(a){let b=ai.default.decode(a);if(b.length<33)throw Error("Too short to contain a public key");return b.slice(1,33)}(d.transaction.address),signature:f,payload:d.transaction}),c=mb(Buffer.from(g).toString("hex")),e=(0,aq.blake2b)(c,void 0,32),"0x"+Buffer.from(e).toString("hex"))]}if("algo_signTxn"===h)return lX(b)?b.map(a=>ju(a)):[ju(b)];if("cosmos_signDirect"===h){let a,c,d,e,f;return[(a=Buffer.from(b.signed.bodyBytes,"base64"),c=Buffer.from(b.signed.authInfoBytes,"base64"),d=Buffer.from(b.signature.signature,"base64"),(e=[]).push(Buffer.from([10])),e.push(jv(a.length)),e.push(a),e.push(Buffer.from([18])),e.push(jv(c.length)),e.push(c),e.push(Buffer.from([26])),e.push(jv(d.length)),e.push(d),f=jd(Buffer.concat(e)),Buffer.from(f).toString("hex").toUpperCase())]}if("wallet_sendCalls"===h){let a=[];try{if("string"==typeof b)return a.push(b),a;if("object"!=typeof b)return a;null!=b&&b.id&&a.push(b.id);let c=null==(g=null==(f=b?.capabilities)?void 0:f.caip345)?void 0:g.transactionHashes;c&&a.push(...c)}catch(a){console.warn("getWalletSendCallsHashes failed: ",a)}return a}if("string"==typeof b)return[b];let j=b[i.key];if(lX(j))return"solana_signAllTransactions"===h?j.map(a=>(function(a){let b=atob(a),c=new Uint8Array(b.length);for(let a=0;a<b.length;a++)c[a]=b.charCodeAt(a);let d=c[0];if(0===d)throw Error("No signatures found");if(c.length<1+64*d)throw Error("Transaction data too short for claimed signature count");if(c.length<100)throw Error("Transaction too short");let e=Buffer.from(a,"base64").slice(1,65);return ai.default.encode(e)})(a)):j;if("string"==typeof j)return[j]}catch(a){this.client.logger.warn("Error extracting tx hashes from result",a)}return[]})}async processPendingMessageEvents(){try{let a=this.client.session.keys,b=this.client.core.relayer.messages.getWithoutAck(a);for(let[a,c]of Object.entries(b))for(let b of c)try{await this.onProviderMessageEvent({topic:a,message:b,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${a}, message: ${b}`)}}catch(a){this.client.logger.warn("processPendingMessageEvents failed",a)}}isInitialized(){if(!this.initialized){let{message:a}=lV("NOT_INITIALIZED",this.name);throw Error(a)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(eE,a=>{this.onProviderMessageEvent(a)})}async onRelayMessage(a){let{topic:b,message:c,attestation:d,transportType:e}=a,{publicKey:f}=this.client.auth.authKeys.keys.includes(mo)?this.client.auth.authKeys.get(mo):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(b,c,{receiverPublicKey:f,encoding:e===eN?lB:lA});(0,ev.isJsonRpcRequest)(a)?(this.client.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a,attestation:d,transportType:e,encryptedId:lD(c)})):(0,ev.isJsonRpcResponse)(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a,transportType:e}),this.client.core.history.delete(b,a.id)):await this.onRelayEventUnknownPayload({topic:b,payload:a,transportType:e}),await this.client.core.relayer.messages.ack(b,c)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(e_,async a=>{let{topic:b,id:c}=function(a){let[b,c]=a.split(":"),d={id:void 0,topic:void 0};if("topic"===b&&"string"==typeof c)d.topic=c;else if("id"===b&&Number.isInteger(Number(c)))d.id=Number(c);else throw Error(`Invalid target, expected id:number or topic:string, got ${b}:${c}`);return d}(a.target);return c&&this.client.pendingRequest.keys.includes(c)?await this.deletePendingSessionRequest(c,lV("EXPIRED"),!0):c&&this.client.auth.requests.keys.includes(c)?await this.deletePendingAuthRequest(c,lV("EXPIRED"),!0):void(b?this.client.session.keys.includes(b)&&(await this.deleteSession({topic:b,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:b})):c&&(await this.deleteProposal(c,!0),this.client.events.emit("proposal_expire",{id:c})))})}registerPairingEvents(){this.client.core.pairing.events.on(eU,a=>this.onPairingCreated(a)),this.client.core.pairing.events.on(eV,a=>{this.addToRecentlyDeleted(a.topic,"pairing")})}isValidPairingTopic(a){if(!l$(a,!1)){let{message:b}=lV("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.client.core.pairing.pairings.keys.includes(a)){let{message:b}=lV("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(hV(this.client.core.pairing.pairings.get(a).expiry)){let{message:b}=lV("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}async isValidSessionTopic(a){if(!l$(a,!1)){let{message:b}=lV("MISSING_OR_INVALID",`session topic should be a string: ${a}`);throw Error(b)}if(this.checkRecentlyDeleted(a),!this.client.session.keys.includes(a)){let{message:b}=lV("NO_MATCHING_KEY",`session topic doesn't exist: ${a}`);throw Error(b)}if(hV(this.client.session.get(a).expiry)){await this.deleteSession({topic:a});let{message:b}=lV("EXPIRED",`session topic: ${a}`);throw Error(b)}if(!this.client.core.crypto.keychain.has(a)){let{message:b}=lV("MISSING_OR_INVALID",`session topic does not exist in keychain: ${a}`);throw await this.deleteSession({topic:a}),Error(b)}}async isValidSessionOrPairingTopic(a){if(this.checkRecentlyDeleted(a),this.client.session.keys.includes(a))await this.isValidSessionTopic(a);else if(this.client.core.pairing.pairings.keys.includes(a))this.isValidPairingTopic(a);else if(l$(a,!1)){let{message:b}=lV("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${a}`);throw Error(b)}else{let{message:b}=lV("MISSING_OR_INVALID",`session or pairing topic should be a string: ${a}`);throw Error(b)}}async isValidProposalId(a){if("number"!=typeof a){let{message:b}=lV("MISSING_OR_INVALID",`proposal id should be a number: ${a}`);throw Error(b)}if(!this.client.proposal.keys.includes(a)){let{message:b}=lV("NO_MATCHING_KEY",`proposal id doesn't exist: ${a}`);throw Error(b)}if(hV(this.client.proposal.get(a).expiryTimestamp)){await this.deleteProposal(a);let{message:b}=lV("EXPIRED",`proposal id: ${a}`);throw Error(b)}}}class mz extends gD{constructor(a,b){super(a,b,"proposal",md),this.core=a,this.logger=b}}class mA extends gD{constructor(a,b){super(a,b,"session",md),this.core=a,this.logger=b}}class mB extends gD{constructor(a,b){super(a,b,"request",md,a=>a.id),this.core=a,this.logger=b}}class mC extends gD{constructor(a,b){super(a,b,"authKeys",mn,()=>mo),this.core=a,this.logger=b}}class mD extends gD{constructor(a,b){super(a,b,"pairingTopics",mn),this.core=a,this.logger=b}}class mE extends gD{constructor(a,b){super(a,b,"requests",mn,a=>a.id),this.core=a,this.logger=b}}var mF=Object.defineProperty,mG=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?mF(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class mH{constructor(a,b){this.core=a,this.logger=b,mG(this,"authKeys"),mG(this,"pairingTopics"),mG(this,"requests"),this.authKeys=new mC(this.core,this.logger),this.pairingTopics=new mD(this.core,this.logger),this.requests=new mE(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var mI=Object.defineProperty,mJ=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?mI(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class mK extends ha{constructor(a){super(a),mJ(this,"protocol","wc"),mJ(this,"version",2),mJ(this,"name",mc),mJ(this,"metadata"),mJ(this,"core"),mJ(this,"logger"),mJ(this,"events",new s.EventEmitter),mJ(this,"engine"),mJ(this,"session"),mJ(this,"proposal"),mJ(this,"pendingRequest"),mJ(this,"auth"),mJ(this,"signConfig"),mJ(this,"on",(a,b)=>this.events.on(a,b)),mJ(this,"once",(a,b)=>this.events.once(a,b)),mJ(this,"off",(a,b)=>this.events.off(a,b)),mJ(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),mJ(this,"removeAllListeners",a=>this.events.removeAllListeners(a)),mJ(this,"connect",async a=>{try{return await this.engine.connect(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"pair",async a=>{try{return await this.engine.pair(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"approve",async a=>{try{return await this.engine.approve(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"reject",async a=>{try{return await this.engine.reject(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"update",async a=>{try{return await this.engine.update(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"extend",async a=>{try{return await this.engine.extend(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"request",async a=>{try{return await this.engine.request(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"respond",async a=>{try{return await this.engine.respond(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"ping",async a=>{try{return await this.engine.ping(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"emit",async a=>{try{return await this.engine.emit(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"disconnect",async a=>{try{return await this.engine.disconnect(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"find",a=>{try{return this.engine.find(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"authenticate",async(a,b)=>{try{return await this.engine.authenticate(a,b)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"formatAuthMessage",a=>{try{return this.engine.formatAuthMessage(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"approveSessionAuthenticate",async a=>{try{return await this.engine.approveSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),mJ(this,"rejectSessionAuthenticate",async a=>{try{return await this.engine.rejectSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),this.name=a?.name||mc,this.metadata=function(a){var b,c;let d=(0,ag.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]};try{let e,f;return null!=a&&a.url&&d.url&&new URL(a.url).host!==new URL(d.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${a.url} differs from the actual page url:${d.url}. This is probably unintended and can lead to issues.`),a.url=d.url),null!=(b=a?.icons)&&b.length&&a.icons.length>0&&(a.icons=a.icons.filter(a=>""!==a)),e=hL(hL({},d),a),f={url:a?.url||d.url,name:a?.name||d.name,description:a?.description||d.description,icons:null!=(c=a?.icons)&&c.length&&a.icons.length>0?a.icons:d.icons},hF(e,hG(f))}catch(b){return console.warn("Error populating app metadata",b),a||d}}(a?.metadata),this.signConfig=a?.signConfig;const b="u">typeof a?.logger&&"string"!=typeof a?.logger?a.logger:(0,O.default)(K({level:a?.logger||"error"}));this.core=a?.core||new g6(a),this.logger=M(b,this.name),this.session=new mA(this.core,this.logger),this.proposal=new mz(this.core,this.logger),this.pendingRequest=new mB(this.core,this.logger),this.engine=new my(this),this.auth=new mH(this.core,this.logger)}static async init(a){let b=new mK(a);return await b.initialize(),b}get context(){return L(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(a){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(a.message),a}}}var O=v,mL=a.i(419997);let mM="error",mN="wc@2:universal_provider:",mO="https://rpc.walletconnect.org/v1/",mP="generic",mQ=`${mO}bundler`,mR="call_status",mS="default_chain_changed";function mT(a){return null==a||"object"!=typeof a&&"function"!=typeof a}function mU(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function mV(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let mW="[object String]",mX="[object Number]",mY="[object Boolean]",mZ="[object Arguments]";function m$(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function m_(a,b,c,d=new Map,e){let f=e?.(a,b,c,d);if(null!=f)return f;if(mT(a))return a;if(d.has(a))return d.get(a);if(Array.isArray(a)){let b=Array(a.length);d.set(a,b);for(let f=0;f<a.length;f++)b[f]=m_(a[f],f,c,d,e);return Object.hasOwn(a,"index")&&(b.index=a.index),Object.hasOwn(a,"input")&&(b.input=a.input),b}if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp){let b=new RegExp(a.source,a.flags);return b.lastIndex=a.lastIndex,b}if(a instanceof Map){let b=new Map;for(let[f,g]of(d.set(a,b),a))b.set(f,m_(g,f,c,d,e));return b}if(a instanceof Set){let b=new Set;for(let f of(d.set(a,b),a))b.add(m_(f,void 0,c,d,e));return b}if("u">typeof Buffer&&Buffer.isBuffer(a))return a.subarray();if(m$(a)){let b=new(Object.getPrototypeOf(a)).constructor(a.length);d.set(a,b);for(let f=0;f<a.length;f++)b[f]=m_(a[f],f,c,d,e);return b}if(a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);if(a instanceof DataView){let b=new DataView(a.buffer.slice(0),a.byteOffset,a.byteLength);return d.set(a,b),m0(b,a,c,d,e),b}if("u">typeof File&&a instanceof File){let b=new File([a],a.name,{type:a.type});return d.set(a,b),m0(b,a,c,d,e),b}if(a instanceof Blob){let b=new Blob([a],{type:a.type});return d.set(a,b),m0(b,a,c,d,e),b}if(a instanceof Error){let b=new a.constructor;return d.set(a,b),b.message=a.message,b.name=a.name,b.stack=a.stack,b.cause=a.cause,m0(b,a,c,d,e),b}if("object"==typeof a&&function(a){switch(mV(a)){case mZ:case"[object Array]":case"[object ArrayBuffer]":case"[object DataView]":case mY:case"[object Date]":case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Map]":case mX:case"[object Object]":case"[object RegExp]":case"[object Set]":case mW:case"[object Symbol]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return!0;default:return!1}}(a)){let b=Object.create(Object.getPrototypeOf(a));return d.set(a,b),m0(b,a,c,d,e),b}return a}function m0(a,b,c=a,d,e){let f=[...Object.keys(b),...mU(b)];for(let g=0;g<f.length;g++){let h=f[g],i=Object.getOwnPropertyDescriptor(a,h);(null==i||i.writable)&&(a[h]=m_(b[h],h,c,d,e))}}function m1(a){var b;return b=(b,c,d,e)=>{let f;if(null!=f)return f;if("object"==typeof a)switch(Object.prototype.toString.call(a)){case mX:case mW:case mY:{let b=new a.constructor(a?.valueOf());return m0(b,a),b}case mZ:{let b={};return m0(b,a),b.length=a.length,b[Symbol.iterator]=a[Symbol.iterator],b}default:return}},m_(a,void 0,a,new Map,b)}function m2(a){return null!==a&&"object"==typeof a&&"[object Arguments]"===mV(a)}function m3(a){return"object"==typeof a&&null!==a}function m4(){}var m5=Object.defineProperty,m6=Object.defineProperties,m7=Object.getOwnPropertyDescriptors,m8=Object.getOwnPropertySymbols,m9=Object.prototype.hasOwnProperty,na=Object.prototype.propertyIsEnumerable,nb=(a,b,c)=>b in a?m5(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,nc=(a,b)=>{for(var c in b||(b={}))m9.call(b,c)&&nb(a,c,b[c]);if(m8)for(var c of m8(b))na.call(b,c)&&nb(a,c,b[c]);return a},nd=(a,b)=>m6(a,m7(b));function ne(a,b,c){var d;let e=hC(a);return(null==(d=b.rpcMap)?void 0:d[e.reference])||`${mO}?chainId=${e.namespace}:${e.reference}&projectId=${c}`}function nf(a){return a.map(a=>`${a.split(":")[0]}:${a.split(":")[1]}`)}function ng(a){return Object.fromEntries(Object.entries(a).filter(([a,b])=>{var c,d;return(null==(c=b?.chains)?void 0:c.length)&&(null==(d=b?.chains)?void 0:d.length)>0}))}function nh(a={},b={}){return function(a,...b){return function(a,...b){let c=b.slice(0,-1),d=b[b.length-1],e=a;for(let a=0;a<c.length;a++)e=function a(b,c,d,e){if(mT(b)&&(b=Object(b)),null==c||"object"!=typeof c)return b;if(e.has(c))return function(a){if(mT(a))return a;if(Array.isArray(a)||m$(a)||a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);let b=Object.getPrototypeOf(a),c=b.constructor;if(a instanceof Date||a instanceof Map||a instanceof Set)return new c(a);if(a instanceof RegExp){let b=new c(a);return b.lastIndex=a.lastIndex,b}if(a instanceof DataView)return new c(a.buffer.slice(0));if(a instanceof Error){let b=new c(a.message);return b.stack=a.stack,b.name=a.name,b.cause=a.cause,b}return"u">typeof File&&a instanceof File?new c([a],a.name,{type:a.type,lastModified:a.lastModified}):"object"==typeof a?Object.assign(Object.create(b),a):a}(e.get(c));if(e.set(c,b),Array.isArray(c)){c=c.slice();for(let a=0;a<c.length;a++)c[a]=c[a]??void 0}let f=[...Object.keys(c),...mU(c)];for(let g=0;g<f.length;g++){let h=f[g],i=c[h],j=b[h];if(m2(i)&&(i={...i}),m2(j)&&(j={...j}),"u">typeof Buffer&&Buffer.isBuffer(i)&&(i=m1(i)),Array.isArray(i))if("object"==typeof j&&null!=j){let a=[],b=Reflect.ownKeys(j);for(let c=0;c<b.length;c++){let d=b[c];a[d]=j[d]}j=a}else j=[];let k=d(j,i,h,b,c,e);null!=k?b[h]=k:Array.isArray(i)||m3(j)&&m3(i)?b[h]=a(j,i,d,e):null==j&&function(a){if("object"!=typeof a||null==a)return!1;if(null===Object.getPrototypeOf(a))return!0;if("[object Object]"!==Object.prototype.toString.call(a)){let b=a[Symbol.toStringTag];return null!=b&&!!Object.getOwnPropertyDescriptor(a,Symbol.toStringTag)?.writable&&a.toString()===`[object ${b}]`}let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}(i)?b[h]=a({},i,d,e):null==j&&m$(i)?b[h]=m1(i):(void 0===j||void 0!==i)&&(b[h]=i)}return b}(e,c[a],d,new Map);return e}(a,...b,m4)}(ng(ni(a)),ng(ni(b)))}function ni(a){var b,c,d,e,f;let g={};if(!lY(a))return g;for(let[h,i]of Object.entries(a)){let a=lP(h)?[h]:i.chains,j=i.methods||[],k=i.events||[],l=i.rpcMap||{},m=lQ(h);g[m]=nd(nc(nc({},g[m]),i),{chains:hX(a,null==(b=g[m])?void 0:b.chains),methods:hX(j,null==(c=g[m])?void 0:c.methods),events:hX(k,null==(d=g[m])?void 0:d.events)}),(lY(l)||lY((null==(e=g[m])?void 0:e.rpcMap)||{}))&&(g[m].rpcMap=nc(nc({},l),null==(f=g[m])?void 0:f.rpcMap))}return g}function nj(a){return a.includes(":")?a.split(":")[2]:a}function nk(a){let b={};for(let[c,d]of Object.entries(a)){let a=d.methods||[],e=d.events||[],f=d.accounts||[],g=lP(c)?[c]:d.chains?d.chains:nf(d.accounts);b[c]={chains:g,methods:a,events:e,accounts:f}}return b}function nl(a){return"number"==typeof a?a:a.includes("0x")?parseInt(a,16):isNaN(Number(a=a.includes(":")?a.split(":")[1]:a))?a:Number(a)}let nm={},nn=a=>nm[a],no=(a,b)=>{nm[a]=b};var np=Object.defineProperty,nq=Object.getOwnPropertySymbols,nr=Object.prototype.hasOwnProperty,ns=Object.prototype.propertyIsEnumerable,nt=(a,b,c)=>b in a?np(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,nu=(a,b)=>{for(var c in b||(b={}))nr.call(b,c)&&nt(a,c,b[c]);if(nq)for(var c of nq(b))ns.call(b,c)&&nt(a,c,b[c]);return a};let nv="eip155",nw=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],nx=a=>a&&a.startsWith("0x")?BigInt(a).toString(10):a,ny=a=>a&&a.startsWith("0x")?a:`0x${BigInt(a).toString(16)}`,nz=a=>Object.keys(a).filter(a=>nw.includes(a)).reduce((b,c)=>(b[c]=nA(a[c]),b),{}),nA=a=>"string"==typeof a&&function(a){try{let b=JSON.parse(a);return"object"==typeof b&&null!==b&&!Array.isArray(b)}catch{return!1}}(a)?JSON.parse(a):a;var nB=Object.defineProperty;class nC{constructor(a){((a,b,c)=>{let d,e;return e=void 0,(d="symbol"!=typeof b?b+"":b)in a?nB(a,d,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[d]=e})(this,"storage"),this.storage=a}async getItem(a){return await this.storage.getItem(a)}async setItem(a,b){return await this.storage.setItem(a,b)}async removeItem(a){return await this.storage.removeItem(a)}static getStorage(a){return b||(b=new nC(a)),b}}var nD=Object.defineProperty,nE=Object.defineProperties,nF=Object.getOwnPropertyDescriptors,nG=Object.getOwnPropertySymbols,nH=Object.prototype.hasOwnProperty,nI=Object.prototype.propertyIsEnumerable,nJ=(a,b,c)=>b in a?nD(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;async function nK(a,b){let c,d=hC(a.result.capabilities.caip345.caip2),e=a.result.capabilities.caip345.transactionHashes,f=await Promise.allSettled(e.map(a=>nL(d.reference,a,b))),g=f.filter(a=>"fulfilled"===a.status).map(a=>a.value).filter(a=>a);f.filter(a=>"rejected"===a.status).forEach(a=>console.warn("Failed to fetch transaction receipt:",a.reason));let h=!g.length||g.some(a=>!a),i=g.every(a=>a?.status==="0x1"),j=g.every(a=>a?.status==="0x0"),k=g.some(a=>a?.status==="0x0");return h?c=100:i?c=200:j?c=500:k&&(c=600),{id:a.result.id,version:a.request.version,atomic:a.request.atomicRequired,chainId:a.request.chainId,capabilities:a.result.capabilities,receipts:g,status:c}}async function nL(a,b,c){return await c(parseInt(a)).request((0,eu.formatJsonRpcRequest)("eth_getTransactionReceipt",[b]))}async function nM({sendCalls:a,storage:b}){let c=await b.getItem(mR);await b.setItem(mR,nE(((a,b)=>{for(var c in b||(b={}))nH.call(b,c)&&nJ(a,c,b[c]);if(nG)for(var c of nG(b))nI.call(b,c)&&nJ(a,c,b[c]);return a})({},c),nF({[a.result.id]:{request:a.request,result:a.result,expiry:hU(86400)}})))}async function nN({resultId:a,storage:b}){let c=await b.getItem(mR);if(c){for(let d in delete c[a],await b.setItem(mR,c),c)hV(c[d].expiry)&&delete c[d];await b.setItem(mR,c)}}async function nO({resultId:a,storage:b}){let c=await b.getItem(mR),d=c?.[a];if(d&&!hV(d.expiry))return d;await nN({resultId:a,storage:b})}var nP=Object.defineProperty,nQ=Object.defineProperties,nR=Object.getOwnPropertyDescriptors,nS=Object.getOwnPropertySymbols,nT=Object.prototype.hasOwnProperty,nU=Object.prototype.propertyIsEnumerable,nV=(a,b,c)=>b in a?nP(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,nW=(a,b)=>{for(var c in b||(b={}))nT.call(b,c)&&nV(a,c,b[c]);if(nS)for(var c of nS(b))nU.call(b,c)&&nV(a,c,b[c]);return a},nX=(a,b,c)=>nV(a,"symbol"!=typeof b?b+"":b,c);class nY{constructor(a){nX(this,"name","eip155"),nX(this,"client"),nX(this,"chainId"),nX(this,"namespace"),nX(this,"httpProviders"),nX(this,"events"),nX(this,"storage"),this.namespace=a.namespace,this.events=nn("events"),this.client=nn("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=nC.getStorage(this.client.core.storage)}async request(a){switch(a.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(a);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(a);case"wallet_getCallsStatus":return await this.getCallStatus(a);case"wallet_sendCalls":return await this.sendCalls(a)}return this.namespace.methods.includes(a.request.method)?await this.client.request(a):this.getHttpProvider().request(a.request)}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(parseInt(a),b);let c=this.chainId;this.chainId=parseInt(a),this.events.emit(mS,{currentCaipChainId:`${this.name}:${a}`,previousCaipChainId:`${this.name}:${c}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}createHttpProvider(a,b){let c=b||ne(`${this.name}:${a}`,this.namespace,this.client.core.projectId);return new et.JsonRpcProvider(new mL.HttpConnection(c,nn("disableProviderPing")))}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;let d=parseInt(b.includes(":")?b.split(":")[1]:b);a[d]=this.createHttpProvider(d,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}getHttpProvider(a){let b=a||this.chainId;return this.httpProviders[b]||(this.httpProviders=nQ(nW({},this.httpProviders),nR({[b]:this.createHttpProvider(b)})),this.httpProviders[b])}async handleSwitchChain(a){var b,c;let d=a.request.params?null==(b=a.request.params[0])?void 0:b.chainId:"0x0",e=parseInt(d=d.startsWith("0x")?d:`0x${d}`,16);if(this.isChainApproved(e))this.setDefaultChain(`${e}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:a.topic,request:{method:a.request.method,params:[{chainId:d}]},chainId:null==(c=this.namespace.chains)?void 0:c[0]}),this.setDefaultChain(`${e}`);else throw Error(`Failed to switch to chain 'eip155:${e}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(a){return this.namespace.chains.includes(`${this.name}:${a}`)}async getCapabilities(a){var b,c,d,e,f;let g,h=null==(c=null==(b=a.request)?void 0:b.params)?void 0:c[0],i=(null==(e=null==(d=a.request)?void 0:d.params)?void 0:e[1])||[];if(!h)throw Error("Missing address parameter in `wallet_getCapabilities` request");let j=this.client.session.get(a.topic),k=(null==(f=j?.sessionProperties)?void 0:f.capabilities)||{},l=`${h}${i.join(",")}`,m=k?.[l];if(m)return m;try{g=((a,b,c)=>{let{sessionProperties:d={},scopedProperties:e={}}=a,f={};if(!lY(e)&&!lY(d))return;let g=nz(d);for(let a of c){let c=nx(a);if(!c)continue;f[ny(c)]=g;let d=e?.[`${nv}:${c}`];if(d){let a=d?.[`${nv}:${c}:${b}`];f[ny(c)]=nu(nu({},f[ny(c)]),nz(a||d))}}for(let[a,b]of Object.entries(f))0===Object.keys(b).length&&delete f[a];return Object.keys(f).length>0?f:void 0})(j,h,i)}catch(a){console.warn("Failed to extract capabilities from session",a)}if(g)return g;let n=await this.client.request(a);try{let b,c,d,e;await this.client.session.update(a.topic,{sessionProperties:(d=nW({},j.sessionProperties||{}),e={capabilities:(b=nW({},k||{}),c={[l]:n},nQ(b,nR(c)))},nQ(d,nR(e)))})}catch(a){console.warn("Failed to update session with capabilities",a)}return n}async getCallStatus(a){var b,c,d;let e=this.client.session.get(a.topic),f=null==(b=e.sessionProperties)?void 0:b.bundler_name;if(f){let b=this.getBundlerUrl(a.chainId,f);try{return await this.getUserOperationReceipt(b,a)}catch(a){console.warn("Failed to fetch call status from bundler",a,b)}}let g=null==(c=e.sessionProperties)?void 0:c.bundler_url;if(g)try{return await this.getUserOperationReceipt(g,a)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,g)}let h=await nO({resultId:null==(d=a.request.params)?void 0:d[0],storage:this.storage});if(h)try{return await nK(h,this.getHttpProvider.bind(this))}catch(a){console.warn("Failed to fetch call status from stored send calls",a,h)}if(this.namespace.methods.includes(a.request.method))return await this.client.request(a);throw Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(a,b){var c;let d=new URL(a),e=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,eu.formatJsonRpcRequest)("eth_getUserOperationReceipt",[null==(c=b.request.params)?void 0:c[0]]))});if(!e.ok)throw Error(`Failed to fetch user operation receipt - ${e.status}`);return await e.json()}getBundlerUrl(a,b){return`${mQ}?projectId=${this.client.core.projectId}&chainId=${a}&bundler=${b}`}async sendCalls(a){var b,c,d;let e=await this.client.request(a),f=null==(b=a.request.params)?void 0:b[0],g=e?.id,h=e?.capabilities||{},i=null==(c=h?.caip345)?void 0:c.caip2,j=null==(d=h?.caip345)?void 0:d.transactionHashes;return g&&i&&null!=j&&j.length&&await nM({sendCalls:{request:f,result:e},storage:this.storage}),e}}var nZ=Object.defineProperty,n$=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?nZ(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class n_{constructor(a){n$(this,"name",mP),n$(this,"client"),n$(this,"httpProviders"),n$(this,"events"),n$(this,"namespace"),n$(this,"chainId"),this.namespace=a.namespace,this.events=nn("events"),this.client=nn("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(a.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(a.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(a.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(a.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider(a.chainId).request(a.request)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(a,b);let c=this.chainId;this.chainId=a,this.events.emit(mS,{currentCaipChainId:`${this.name}:${a}`,previousCaipChainId:`${this.name}:${c}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}getNamespaceName(){let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return hC(a).namespace}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}createHttpProviders(){var a,b;let c={};return null==(b=null==(a=this.namespace)?void 0:a.accounts)||b.forEach(a=>{var b,d;let e=hC(a),f=null==(d=null==(b=this.namespace)?void 0:b.rpcMap)?void 0:d[`${e.namespace}:${e.reference}`];c[e.reference]=this.createHttpProvider(a,f)}),c}getHttpProvider(a){let b=hC(a).reference,c=this.httpProviders[b];if(typeof c>"u")throw Error(`JSON-RPC provider for ${a} not found`);return c}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||ne(a,this.namespace,this.client.core.projectId);return new et.JsonRpcProvider(new mL.default(c,nn("disableProviderPing")))}}var n0=Object.defineProperty,n1=Object.defineProperties,n2=Object.getOwnPropertyDescriptors,n3=Object.getOwnPropertySymbols,n4=Object.prototype.hasOwnProperty,n5=Object.prototype.propertyIsEnumerable,n6=(a,b,c)=>b in a?n0(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,n7=(a,b)=>{for(var c in b||(b={}))n4.call(b,c)&&n6(a,c,b[c]);if(n3)for(var c of n3(b))n5.call(b,c)&&n6(a,c,b[c]);return a},n8=(a,b,c)=>n6(a,"symbol"!=typeof b?b+"":b,c);class n9{constructor(a){n8(this,"client"),n8(this,"namespaces"),n8(this,"optionalNamespaces"),n8(this,"sessionProperties"),n8(this,"scopedProperties"),n8(this,"events",new s.default),n8(this,"rpcProviders",{}),n8(this,"session"),n8(this,"providerOpts"),n8(this,"logger"),n8(this,"uri"),n8(this,"disableProviderPing",!1),this.providerOpts=a,this.logger="u">typeof a?.logger&&"string"!=typeof a?.logger?a.logger:(0,O.default)(K({level:a?.logger||mM})),this.disableProviderPing=a?.disableProviderPing||!1}static async init(a){let b=new n9(a);return await b.initialize(),b}async request(a,b,c){let[d,e]=this.validateChain(b);if(!this.session)throw Error("Please call connect() before request()");return await this.getProvider(d).request({request:n7({},a),chainId:`${d}:${e}`,topic:this.session.topic,expiry:c})}sendAsync(a,b,c,d){let e=new Date().getTime();this.request(a,c,d).then(a=>b(null,(0,eu.formatJsonRpcResult)(e,a))).catch(a=>b(a,void 0))}async enable(){if(!this.client)throw Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var a;if(!this.session)throw Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(a=this.session)?void 0:a.topic,reason:lW("USER_DISCONNECTED")}),await this.cleanup()}async connect(a){if(!this.client)throw Error("Sign Client not initialized");if(this.setNamespaces(a),this.cleanupPendingPairings(),!a.skipPairing)return await this.pair(a.pairingTopic)}async authenticate(a,b){if(!this.client)throw Error("Sign Client not initialized");this.setNamespaces(a),await this.cleanupPendingPairings();let{uri:c,response:d}=await this.client.authenticate(a,b);c&&(this.uri=c,this.events.emit("display_uri",c));let e=await d();if(this.session=e.session,this.session){let a=nk(this.session.namespaces);this.namespaces=nh(this.namespaces,a),await this.persist("namespaces",this.namespaces),this.onConnect()}return e}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}removeListener(a,b){this.events.removeListener(a,b)}off(a,b){this.events.off(a,b)}get isWalletConnect(){return!0}async pair(a){let{uri:b,approval:c}=await this.client.connect({pairingTopic:a,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});b&&(this.uri=b,this.events.emit("display_uri",b));let d=await c();this.session=d;let e=nk(d.namespaces);return this.namespaces=nh(this.namespaces,e),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(a,b){try{if(!this.session)return;let[c,d]=this.validateChain(a);this.getProvider(c).setDefaultChain(d,b)}catch(a){if(!/Please call connect/.test(a.message))throw a}}async cleanupPendingPairings(a={}){try{this.logger.info("Cleaning up inactive pairings...");let b=this.client.pairing.getAll();if(!lX(b))return;for(let c of b)a.deletePairings?this.client.core.expirer.set(c.topic,0):await this.client.core.relayer.subscriber.unsubscribe(c.topic);this.logger.info(`Inactive pairings cleared: ${b.length}`)}catch(a){this.logger.warn("Failed to cleanup pending pairings",a)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var a,b;if(this.client=this.providerOpts.client||await mK.init({core:this.providerOpts.core,logger:this.providerOpts.logger||mM,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(c){throw this.logger.error("Failed to get session",c),Error(`The provided session: ${null==(b=null==(a=this.providerOpts)?void 0:a.session)?void 0:b.topic} doesn't exist in the Sign client`)}else{let a=this.client.session.getAll();this.session=a[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw Error("Sign Client not initialized");if(!this.session)throw Error("Session not initialized. Please call connect() before enable()");let a=[...new Set(Object.keys(this.session.namespaces).map(a=>lQ(a)))];no("client",this.client),no("events",this.events),no("disableProviderPing",this.disableProviderPing),a.forEach(a=>{if(!this.session)return;let b=function(a,b){let c=Object.keys(b.namespaces).filter(b=>b.includes(a));if(!c.length)return[];let d=[];return c.forEach(a=>{let c=b.namespaces[a].accounts;d.push(...c)}),d}(a,this.session);if(b?.length===0)return;let c=nf(b),d=n1(n7({},nh(this.namespaces,this.optionalNamespaces)[a]),n2({accounts:b,chains:c}));"eip155"===a?this.rpcProviders[a]=new nY({namespace:d}):this.rpcProviders[a]=new n_({namespace:d})})}registerEventListeners(){if(typeof this.client>"u")throw Error("Sign Client is not initialized");this.client.on("session_ping",a=>{var b;let{topic:c}=a;c===(null==(b=this.session)?void 0:b.topic)&&this.events.emit("session_ping",a)}),this.client.on("session_event",a=>{var b;let{params:c,topic:d}=a;if(d!==(null==(b=this.session)?void 0:b.topic))return;let{event:e}=c;if("accountsChanged"===e.name){let a=e.data;a&&lX(a)&&this.events.emit("accountsChanged",a.map(nj))}else if("chainChanged"===e.name){let a=c.chainId,b=c.event.data,d=lQ(a),e=nl(a)!==nl(b)?`${d}:${nl(b)}`:a;this.onChainChanged({currentCaipChainId:e})}else this.events.emit(e.name,e.data);this.events.emit("session_event",a)}),this.client.on("session_update",({topic:a,params:b})=>{var c,d;if(a!==(null==(c=this.session)?void 0:c.topic))return;let{namespaces:e}=b,f=null==(d=this.client)?void 0:d.session.get(a);this.session=n1(n7({},f),n2({namespaces:e})),this.onSessionUpdate(),this.events.emit("session_update",{topic:a,params:b})}),this.client.on("session_delete",async a=>{var b;a.topic===(null==(b=this.session)?void 0:b.topic)&&(await this.cleanup(),this.events.emit("session_delete",a),this.events.emit("disconnect",n1(n7({},lW("USER_DISCONNECTED")),n2({data:a.topic}))))}),this.on(mS,a=>{this.onChainChanged(n1(n7({},a),n2({internal:!0})))})}getProvider(a){return this.rpcProviders[a]||this.rpcProviders[mP]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(a=>{var b;this.getProvider(a).updateNamespace(null==(b=this.session)?void 0:b.namespaces[a])})}setNamespaces(a){let{namespaces:b={},optionalNamespaces:c={},sessionProperties:d,scopedProperties:e}=a;this.optionalNamespaces=nh(b,c),this.sessionProperties=d,this.scopedProperties=e}validateChain(a){let[b,c]=a?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[b,c];if(b&&!Object.keys(this.namespaces||{}).map(a=>lQ(a)).includes(b))throw Error(`Namespace '${b}' is not configured. Please call connect() first with namespace config.`);if(b&&c)return[b,c];let d=lQ(Object.keys(this.namespaces)[0]),e=this.rpcProviders[d].getDefaultChain();return[d,e]}async requestAccounts(){let[a]=this.validateChain();return await this.getProvider(a).requestAccounts()}async onChainChanged({currentCaipChainId:a,previousCaipChainId:b,internal:c=!1}){if(!this.namespaces)return;let[d,e]=this.validateChain(a);e&&(this.updateNamespaceChain(d,e),c?(this.events.emit("chainChanged",e),this.emitAccountsChangedOnChainChange({namespace:d,currentCaipChainId:a,previousCaipChainId:b})):this.getProvider(d).setDefaultChain(e),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:a,currentCaipChainId:b,previousCaipChainId:c}){var d,e;try{if(c===b)return;let f=null==(e=null==(d=this.session)?void 0:d.namespaces[a])?void 0:e.accounts;if(!f)return;let g=f.filter(a=>a.includes(`${b}:`)).map(nj);if(!lX(g))return;this.events.emit("accountsChanged",g)}catch(a){this.logger.warn("Failed to emit accountsChanged on chain change",a)}}updateNamespaceChain(a,b){if(!this.namespaces)return;let c=this.namespaces[a]?a:`${a}:${b}`;this.namespaces[c]?this.namespaces[c]&&(this.namespaces[c].defaultChain=b):this.namespaces[c]={chains:[],methods:[],events:[],defaultChain:b}}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(a,b){var c;let d=(null==(c=this.session)?void 0:c.topic)||"";await this.client.core.storage.setItem(`${mN}/${a}${d}`,b)}async getFromStore(a){var b;let c=(null==(b=this.session)?void 0:b.topic)||"";return await this.client.core.storage.getItem(`${mN}/${a}${c}`)}async deleteFromStore(a){var b;let c=(null==(b=this.session)?void 0:b.topic)||"";await this.client.core.storage.removeItem(`${mN}/${a}${c}`)}async cleanupStorage(){var a;try{if((null==(a=this.client)?void 0:a.session.length)>0)return;for(let a of(await this.client.core.storage.getKeys()))a.startsWith(mN)&&await this.client.core.storage.removeItem(a)}catch(a){this.logger.warn("Failed to cleanup storage",a)}}}a.s(["default",()=>n9],39647)},720214,a=>{"use strict";a.i(39647);var b=a.i(883148),c=a.i(83965),d=a.i(602383),e=a.i(346280),f=a.i(109450),g=a.i(242528),h=a.i(786183),i=a.i(94702),j=a.i(667625),k=a.i(531657),l=a.i(435044),m=a.i(135323);let n=null,o={getSIWX:()=>i.OptionsController.state.siwx,async initializeIfEnabled(a=d.ChainController.getActiveCaipAddress()){let b=i.OptionsController.state.siwx;if(!(b&&a))return;let[c,f,l]=a.split(":");if(d.ChainController.checkIfSupportedNetwork(c,`${c}:${f}`))try{if(i.OptionsController.state.remoteFeatures?.emailCapture){let a=d.ChainController.getAccountData(c)?.user;await h.ModalController.open({view:"DataCapture",data:{email:a?.email??void 0}});return}if(n&&await n,(await b.getSessions(`${c}:${f}`,l)).length)return;await h.ModalController.open({view:"SIWXSignMessage"})}catch(a){console.error("SIWXUtil:initializeIfEnabled",a),g.EventsController.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(a)}),await e.ConnectionController._getClient()?.disconnect().catch(console.error),j.RouterController.reset("Connect"),k.SnackController.showError("A problem occurred while trying initialize authentication")}},async requestSignMessage(){let a=i.OptionsController.state.siwx,c=m.CoreHelperUtil.getPlainAddress(d.ChainController.getActiveCaipAddress()),n=(0,l.getActiveCaipNetwork)(),o=e.ConnectionController._getClient();if(!a)throw Error("SIWX is not enabled");if(!c)throw Error("No ActiveCaipAddress found");if(!n)throw Error("No ActiveCaipNetwork or client found");if(!o)throw Error("No ConnectionController client found");try{let e=await a.createMessage({chainId:n.caipNetworkId,accountAddress:c}),i=e.toString();f.ConnectorController.getConnectorId(n.chainNamespace)===b.ConstantsUtil.CONNECTOR_ID.AUTH&&j.RouterController.pushTransactionStack({});let k=await o.signMessage(i);await a.addSession({data:e,message:i,signature:k}),d.ChainController.setLastConnectedSIWECaipNetwork(n),h.ModalController.close(),g.EventsController.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(a){h.ModalController.state.open&&"ApproveTransaction"!==j.RouterController.state.view||await h.ModalController.open({view:"SIWXSignMessage"}),k.SnackController.showError("Error signing message"),g.EventsController.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(a)}),console.error("SWIXUtil:requestSignMessage",a)}},async cancelSignMessage(){try{let a=this.getSIWX();if(a?.getRequired?.()){let b=d.ChainController.getLastConnectedSIWECaipNetwork();if(b){let c=await a?.getSessions(b?.caipNetworkId,m.CoreHelperUtil.getPlainAddress(d.ChainController.getActiveCaipAddress())||"");c&&c.length>0?await d.ChainController.switchActiveNetwork(b):await e.ConnectionController.disconnect()}else await e.ConnectionController.disconnect()}else h.ModalController.close();h.ModalController.close(),g.EventsController.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(a){console.error("SIWXUtil:cancelSignMessage",a)}},async getAllSessions(){let a=this.getSIWX(),b=d.ChainController.getAllRequestedCaipNetworks(),c=[];return await Promise.all(b.map(async b=>{let e=await a?.getSessions(b.caipNetworkId,m.CoreHelperUtil.getPlainAddress(d.ChainController.getActiveCaipAddress())||"");e&&c.push(...e)})),c},async getSessions(a){let b=i.OptionsController.state.siwx,c=a?.address;if(!c){let a=d.ChainController.getActiveCaipAddress();c=m.CoreHelperUtil.getPlainAddress(a)}let e=a?.caipNetworkId;if(!e){let a=d.ChainController.getActiveCaipNetwork();e=a?.caipNetworkId}return b&&c&&e?b.getSessions(e,c):[]},async isSIWXCloseDisabled(){let a=this.getSIWX();if(a){let b="ApproveTransaction"===j.RouterController.state.view,c="SIWXSignMessage"===j.RouterController.state.view;if(b||c)return a.getRequired?.()&&0===(await this.getSessions()).length}return!1},async authConnectorAuthenticate({authConnector:a,chainId:c,socialUri:e,preferredAccountType:f,chainNamespace:g}){let h=o.getSIWX(),j=(0,l.getActiveCaipNetwork)();if(!h||!g.includes(b.ConstantsUtil.CHAIN.EVM)||i.OptionsController.state.remoteFeatures?.emailCapture){let b=await a.connect({chainId:c,socialUri:e,preferredAccountType:f});return{address:b.address,chainId:b.chainId,accounts:b.accounts}}let k=`${g}:${c}`,m=await h.createMessage({chainId:k,accountAddress:"<<AccountAddress>>"}),n={accountAddress:m.accountAddress,chainId:m.chainId,domain:m.domain,uri:m.uri,version:m.version,nonce:m.nonce,notBefore:m.notBefore,statement:m.statement,resources:m.resources,requestId:m.requestId,issuedAt:m.issuedAt,expirationTime:m.expirationTime,serializedMessage:m.toString()},p=await a.connect({chainId:c,socialUri:e,siwxMessage:n,preferredAccountType:f});if(n.accountAddress=p.address,n.serializedMessage=p.message||"",p.signature&&p.message){let a=o.addEmbeddedWalletSession(n,p.message,p.signature);await a}return d.ChainController.setLastConnectedSIWECaipNetwork(j),{address:p.address,chainId:p.chainId,accounts:p.accounts}},async addEmbeddedWalletSession(a,b,c){if(n)return n;let d=o.getSIWX();return d?n=d.addSession({data:a,message:b,signature:c}).finally(()=>{n=null}):Promise.resolve()},async universalProviderAuthenticate({universalProvider:a,chains:b,methods:c}){let e=o.getSIWX(),f=(0,l.getActiveCaipNetwork)(),h=new Set(b.map(a=>a.split(":")[0]));if(!e||1!==h.size||!h.has("eip155"))return!1;let i=await e.createMessage({chainId:(0,l.getActiveCaipNetwork)()?.caipNetworkId||"",accountAddress:""}),j=await a.authenticate({nonce:i.nonce,domain:i.domain,uri:i.uri,exp:i.expirationTime,iat:i.issuedAt,nbf:i.notBefore,requestId:i.requestId,version:i.version,resources:i.resources,statement:i.statement,chainId:i.chainId,methods:c,chains:[i.chainId,...b.filter(a=>a!==i.chainId)]});k.SnackController.showLoading("Authenticating...",{autoClose:!1});let m={...j.session.peer.metadata,name:j.session.peer.metadata.name,icon:j.session.peer.metadata.icons?.[0],type:"WALLET_CONNECT"};if(d.ChainController.setAccountProp("connectedWalletInfo",m,Array.from(h)[0]),j?.auths?.length){let b=j.auths.map(b=>{let c=a.client.formatAuthMessage({request:b.p,iss:b.p.iss});return{data:{...b.p,accountAddress:b.p.iss.split(":").slice(-1).join(""),chainId:b.p.iss.split(":").slice(2,4).join(":"),uri:b.p.aud,version:b.p.version||i.version,expirationTime:b.p.exp,issuedAt:b.p.iat,notBefore:b.p.nbf},message:c,signature:b.s.s,cacao:b}});try{await e.setSessions(b),f&&d.ChainController.setLastConnectedSIWECaipNetwork(f),g.EventsController.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:o.getSIWXEventProperties()})}catch(b){throw console.error("SIWX:universalProviderAuth - failed to set sessions",b),g.EventsController.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:o.getSIWXEventProperties(b)}),await a.disconnect().catch(console.error),b}finally{k.SnackController.hide()}}return!0},getSIWXEventProperties(a){let b=d.ChainController.state.activeChain;if(!b)throw Error("SIWXUtil:getSIWXEventProperties - namespace is required");return{network:d.ChainController.state.activeCaipNetwork?.caipNetworkId||"",isSmartAccount:(0,l.getPreferredAccountType)(b)===c.W3mFrameRpcConstants.ACCOUNT_TYPES.SMART_ACCOUNT,message:a?m.CoreHelperUtil.parseError(a):void 0}},async clearSessions(){let a=this.getSIWX();a&&await a.setSessions([])}};a.s(["SIWXUtil",0,o])},37252,a=>{"use strict";var b=a.i(583335),c=a.i(316266),d=a.i(929581),e=a.i(94702);let f=(0,b.proxy)({message:"",variant:"info",open:!1}),g=(0,d.withErrorBoundary)({state:f,subscribeKey:(a,b)=>(0,c.subscribeKey)(f,a,b),open(a,b){let{debug:c}=e.OptionsController.state,{code:d,displayMessage:g,debugMessage:h}=a;g&&c&&(f.message=g,f.variant=b,f.open=!0),h&&console.error("function"==typeof h?h():h,d?{code:d}:void 0)},warn(a,b,c){f.open=!0,f.message=a,f.variant="warning",b&&console.warn(b,c)},close(){f.open=!1,f.message="",f.variant="info"}});a.s(["AlertController",0,g])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a57ebe15._.js.map